import{f as l}from"./utils-DM3VuI_N.js";import{I as f,H as c,Q as y,ct as s,a as S}from"./Identifiable-B58w9FD1.js";import{v as R}from"./jsonUtils-rvWrjUVI.js";import{R as g}from"./normalizeUtils-DiYDtdl8.js";import{t as d}from"./query-DlUKcN7V.js";import{i as x}from"./AttributeBinsFeatureSet-CIqd8TL8.js";import J from"./AttributeBinsQuery-CK9PjgMw.js";import"./index-VFfT8Aji.js";import"./normalizeUtilsCommon-BcGwSELE.js";import"./utils-Kw6dbpdX.js";import"./pbfQueryUtils-H9tI0GDN.js";import"./pbf-6MtXQ4A6.js";import"./memoryEstimations-ugfznLe2.js";import"./OptimizedFeature-DFf7-Rrh.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-CxgQnwhw.js";import"./projectionUtils-DsK_8mH5.js";import"./Graphic-sBrqQAPW.js";import"./PopupTemplate-D_WeQBNh.js";import"./fieldUtils-5LubkA3t.js";import"./typeUtils-BD6Rtzmx.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-Du36Z1Jr.js";import"./SimpleMarkerSymbol-B18xir4G.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-CGMzNzJN.js";import"./TextSymbol-C7i9ol-5.js";import"./PictureMarkerSymbol-D6pzvUP4.js";import"./FeatureSet-DrLo5FjM.js";import"./Field-BoWr0HZE.js";import"./fieldType-CgljAswg.js";import"./queryUtils-DGFW-0sq.js";import"./json-Wa8cmqdu.js";import"./FixedIntervalBinParameters-_VwQFo1S.js";import"./NormalizationBinParametersMixin-2d45MFq8.js";import"./Query-B1Zd9wiX.js";import"./Layer-C63inyUN.js";import"./timeZoneUtils-DlgpSZrP.js";function N(r){const i=r.geometry,e=r.toJSON(),t=e;let m,o,n;if(i!=null&&(o=i.spatialReference,n=s(o),t.geometryType=R(i),t.geometry=JSON.stringify(i),t.inSR=n),e.outSR?(t.outSR=s(e.outSR),m=r.outSpatialReference):i&&(t.outSR=t.inSR,m=o),t.bin&&(t.bin=JSON.stringify(t.bin)),t.quantizationParameters&&(t.quantizationParameters=JSON.stringify(t.quantizationParameters)),t.outStatistics&&(t.outStatistics=JSON.stringify(t.outStatistics)),t.outTimeReference&&(t.outTimeReference=JSON.stringify(t.outTimeReference)),e.timeExtent){const a=e.timeExtent,{start:p,end:u}=a;p==null&&u==null||(t.time=p===u?p:`${p??"null"},${u??"null"}`),delete e.timeExtent}return r.defaultSpatialReference&&S(o,m)&&(t.defaultSR=t.inSR,delete t.inSR,delete t.outSR),t}async function O(r,i,e){return i.timeExtent!=null&&i.timeExtent.isEmpty?{data:{features:[]}}:await q(r,i,e)}async function q(r,i,e={}){const t=typeof r=="string"?f(r):r,m=i.geometry?[i.geometry]:[],o=await g(m,null,{signal:e.signal}),n=o==null?void 0:o[0];n!=null&&((i=i.clone()).geometry=n);const a=d({...t.query,f:"json",...N(i)});return c(y(t.path,"queryBins"),{...e,query:{...a,...e.query}})}async function at(r,i,e){const{data:t}=await O(l(r),J.from(i),e);return x.fromJSON(t)}export{at as executeAttributeBinsQuery};
