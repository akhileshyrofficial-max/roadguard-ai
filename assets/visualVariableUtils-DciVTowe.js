import{i as q,d8 as A,aS as C}from"./Identifiable-_3rFZ1o6.js";import O from"./Graphic-q_7OAYHf.js";import{m as P}from"./lengthUtils-CrwfL9_h.js";var S,m;function L(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function y(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Z(e){return e.valueExpression?S.Expression:e.field&&typeof e.field=="string"?S.Field:S.Unknown}function ie(e,i){const t=i||Z(e),n=e.valueUnit||"unknown";return t===S.Unknown?m.Constant:e.stops?m.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?m.ClampedLinear:n==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?m.Proportional:m.Additive:m.Identity:m.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(S||(S={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(m||(m={}));const D=()=>q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),g=e=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),w=()=>D().error("Use of arcade expressions requires an arcade context"),R=new O,z=Math.PI,_=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(e,i,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="color"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void g("ColorVariable");const l=typeof i=="number",r=l?null:i,s=r==null?void 0:r.attributes;let o=l?i:null;const a=n.field,{ipData:d,hasExpression:v}=n.cache;let c=n.cache.compiledFunc;if(!a&&!v){const u=n.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(v){if((t==null?void 0:t.arcade)==null)return void w();const u={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},p=t.arcade.arcadeUtils,V=p.getViewInfo(u),x=p.createExecContext(r,V,t.timeZone);if(!c){const k=p.createSyntaxTree(n.valueExpression);c=p.createFunction(k),n.cache.compiledFunc=c}o=p.executeFunction(c,x)}else s&&(o=s[a]);const f=n.normalizationField,b=s!=null&&f!=null?parseFloat(s[f]):void 0;if(o!=null&&(!f||l||!isNaN(b)&&b!==0)){y(b)&&!l&&(o/=b);const u=E(o,d);if(u){const p=u[0],V=u[1],x=p===V?n.stops[p].color:C.blendColors(n.stops[p].color,n.stops[V].color,u[2],t!=null?t.color:void 0);return new C(x)}}}function U(e,i,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="opacity"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void g("OpacityVariable");const l=typeof i=="number",r=l?null:i,s=r==null?void 0:r.attributes;let o=l?i:null;const a=n.field,{ipData:d,hasExpression:v}=n.cache;let c=n.cache.compiledFunc;if(!a&&!v){const u=n.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(v){if((t==null?void 0:t.arcade)==null)return void w();const u={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},p=t.arcade.arcadeUtils,V=p.getViewInfo(u),x=p.createExecContext(r,V,t.timeZone);if(!c){const k=p.createSyntaxTree(n.valueExpression);c=p.createFunction(k),n.cache.compiledFunc=c}o=p.executeFunction(c,x)}else s&&(o=s[a]);const f=n.normalizationField,b=s!=null&&f!=null?parseFloat(s[f]):void 0;if(o!=null&&(!f||l||!isNaN(b)&&b!==0)){y(b)&&!l&&(o/=b);const u=E(o,d);if(u){const p=u[0],V=u[1];if(p===V)return n.stops[p].opacity;{const x=n.stops[p].opacity;return x+(n.stops[V].opacity-x)*u[2]}}}}function N(e,i,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void g("RotationVariable");const l=n.axis||"heading",r=l==="heading"&&n.rotationType==="arithmetic"?90:0,s=l==="heading"&&n.rotationType==="arithmetic"?-1:1,o=typeof i=="number"?null:i,a=o==null?void 0:o.attributes,d=n.field,{hasExpression:v}=n.cache;let c=n.cache.compiledFunc,f=null;if(!d&&!v)return f;if(v){if((t==null?void 0:t.arcade)==null)return void w();const b={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},u=t.arcade.arcadeUtils,p=u.getViewInfo(b),V=u.createExecContext(o,p,t.timeZone);if(!c){const x=u.createSyntaxTree(n.valueExpression);c=u.createFunction(x),n.cache.compiledFunc=c}f=u.executeFunction(c,V)}else a&&(f=a[d]);return f=typeof f!="number"||isNaN(f)?null:r+s*f,f}function W(e,i,t){const n=typeof i=="number",l=n?null:i,r=l==null?void 0:l.attributes;let s=n?i:null;const{isScaleDriven:o}=e.cache;let a=e.cache.compiledFunc;if(o){const v=t!=null?t.scale:void 0,c=t!=null?t.view:void 0;s=v==null||c==="3d"?j(e):v}else if(!n)switch(e.inputValueType){case S.Expression:{if((t==null?void 0:t.arcade)==null)return void w();const v={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},c=t.arcade.arcadeUtils,f=c.getViewInfo(v),b=c.createExecContext(l,f,t.timeZone);if(!a){const u=c.createSyntaxTree(e.valueExpression);a=c.createFunction(u),e.cache.compiledFunc=a}s=c.executeFunction(a,b);break}case S.Field:r&&(s=r[e.field]);break;case S.Unknown:s=null}if(!y(s))return null;if(n||!e.normalizationField)return s;const d=r?parseFloat(r[e.normalizationField]):null;return y(d)&&d!==0?s/d:null}function j(e){let i=null,t=null;const n=e.stops;return n?(i=n[0].value,t=n[n.length-1].value):(i=e.minDataValue||0,t=e.maxDataValue||0),(i+t)/2}function F(e,i,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(r=>r.type==="size"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void g("SizeVariable");const l=I(W(n,i,t),n,i,t,n.cache.ipData);return l==null||isNaN(l)?void 0:l}function h(e,i,t){return e==null?null:L(e)?F(e,i,t):y(e)?e:null}function T(e,i,t){return y(t)&&e>t?t:y(i)&&e<i?i:e}function B(e,i,t,n){const l=h(i.minSize,t,n)||i.minDataValue;return e==null&&l==null?null:(e??0)+(l??0)}function G(e,i,t){const n=e.stops;let l=(n==null?void 0:n.length)&&n[0].size;return l==null&&(l=e.minSize),h(l,i,t)}function H(e,i,t,n){const l=h(i.minSize,t,n);if(e==null)return l;const{minDataValue:r,maxDataValue:s}=i;if(r==null||s==null)return null;const o=(e-r)/(s-r),a=h(i.maxSize,t,n),d=n!=null?n.shape:void 0;if(e<=r)return l;if(e>=s)return a;if(l==null||a==null)return null;if(i.scaleBy==="area"&&d){const v=d==="circle",c=v?z*(l/2)**2:l*l,f=c+o*((v?z*(a/2)**2:a*a)-c);return v?2*Math.sqrt(f/z):Math.sqrt(f)}return l+o*(a-l)}function J(e,i,t,n){const l=h(i.minSize,t,n);if(e==null||l==null)return l;const r=n!=null?n.shape:void 0,{minDataValue:s}=i;if(s==null)return null;const o=e/s,a=h(i.maxSize,t,n);let d=null;return d=r==="circle"?2*Math.sqrt(o*(l/2)**2):r==="square"||r==="diamond"||r==="image"?Math.sqrt(o*l**2):o*l,T(d,l,a)}function K(e,i,t,n,l){var a,d,v;if(e==null)return null;const[r,s,o]=E(e,l);if(r===s)return h((a=i.stops)==null?void 0:a[r].size,t,n);{const c=h((d=i.stops)==null?void 0:d[r].size,t,n),f=h((v=i.stops)==null?void 0:v[s].size,t,n);return c==null||f==null?null:c+(f-c)*o}}function Q(e,i,t,n){const l=((n==null?void 0:n.resolution)??1)*P[i.valueUnit],r=h(i.minSize,t,n),s=h(i.maxSize,t,n),{valueRepresentation:o}=i;if(e==null)return r;let a=null;return a=o==="area"?2*Math.sqrt(e/z)/l:o==="radius"||o==="distance"?2*e/l:e/l,T(a,r,s)}function I(e,i,t,n,l){switch(i.transformationType){case m.Additive:return B(e,i,t,n);case m.Constant:return G(i,t,n);case m.ClampedLinear:return H(e,i,t,n);case m.Proportional:return J(e,i,t,n);case m.Stops:return K(e,i,t,n,l);case m.RealWorldSize:return Q(e,i,t,n);case m.Identity:return e;case m.Unknown:return null}}function X(e,i,t){const{isScaleDriven:n}=e.cache;if(!(n&&t==="3d"||i))return null;const l={scale:i,view:t};let r=h(e.minSize,R,l),s=h(e.maxSize,R,l);if(r!=null||s!=null){if(r>s){const o=s;s=r,r=o}return{minSize:r,maxSize:s}}}function Y(e,i,t){if(!e.visualVariables)return;const n=[],l=[],r=[],s=[],o=[];for(const a of e.visualVariables)switch(a.type){case"color":l.push(a);break;case"opacity":r.push(a);break;case"rotation":o.push(a);break;case"size":s.push(a)}return l.forEach(a=>{const d=M(a,i,t);n.push({variable:a,value:d})}),r.forEach(a=>{const d=U(a,i,t);n.push({variable:a,value:d})}),o.forEach(a=>{const d=N(a,i,t);n.push({variable:a,value:d})}),s.forEach(a=>{const d=F(a,i,t);n.push({variable:a,value:d})}),n}function E(e,i){if(!i)return;let t=0,n=i.length-1;return i.some((l,r)=>e<l?(n=r,!0):(t=r,!1)),[t,n,(e-i[t])/(i[n]-i[t])]}function $(e,i,t){const n=["proportional","proportional","proportional"];for(const l of e){const r=l.useSymbolValue?"symbol-value":F(l,i,t)??"proportional";switch(l.axis){case"width":n[0]=r;break;case"depth":n[1]=r;break;case"height":n[2]=r;break;case"width-and-depth":n[0]=r,n[1]=r;break;case"all":case void 0:case null:n[0]=r,n[1]=r,n[2]=r;break;default:A(l.axis)}}return n}const le=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:$,getColor:M,getOpacity:U,getRotationAngle:N,getSize:F,getSizeForValue:I,getSizeFromNumberOrVariable:h,getSizeRangeAtScale:X,getVisualVariableValues:Y,viewScaleRE:_},Symbol.toStringTag,{value:"Module"}));export{Y as D,$ as N,ie as a,le as b,L as e,N as h,m as i,Z as t,_ as v};
