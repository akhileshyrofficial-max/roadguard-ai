import{x as E,l as d,a6 as $,f as v,aw as l,cQ as D,c as p,m as n,d as C}from"./Identifiable-B58w9FD1.js";import{t as A}from"./memoize-DmxaQ-k8.js";import{r as I}from"./fieldUtils-5LubkA3t.js";import{y as x}from"./elevationInfoUtils-BpDJq1uD.js";import{y as G}from"./hitTestSelectUtils-ByTX4qSK.js";import{o as q,i as z}from"./queryEngineUtils-C3_JDUQI.js";import{i as w,r as L,n as f}from"./symbologySnappingCandidates-CKDblF5J.js";import"./index-VFfT8Aji.js";import"./ElevationInfo-0ccmO6of.js";import"./lengthUtils-DEvA7X52.js";import"./Cyclical-SUfr0Hlv.js";import"./quantityUtils-CebuAsVX.js";import"./vec2-ChnYg_BJ.js";import"./common-DQOJ18NT.js";import"./vec2f64-Cgb6qxNH.js";import"./vec32-BBi6eWk8.js";import"./projectVectorToVector-_cm4joq-.js";import"./projectionUtils-DsK_8mH5.js";import"./projectPointToVector-DXXhVA1_.js";import"./geodesicUtils-aAgfbhCp.js";import"./Layer-C63inyUN.js";import"./Query-B1Zd9wiX.js";import"./jsonUtils-rvWrjUVI.js";import"./typeUtils-BD6Rtzmx.js";import"./Field-BoWr0HZE.js";import"./fieldType-CgljAswg.js";import"./MapView-xTo1x6Jl.js";import"./CollectionFlattener-DpJZcuE9.js";import"./workers-BRuHQO5o.js";import"./Queue-CM5__kwh.js";import"./intl-BHHnlw1J.js";import"./number-kTr8sdcN.js";import"./TileInfo-D4DTS484.js";import"./TileKey-DZd6gJy7.js";import"./jsxFactory-MlcfH8Vy.js";import"./uuid-Cl5lrJ4c.js";import"./sanitizerUtils-CJlLEeXg.js";import"./UpdatingHandles-Lv1GUel8.js";import"./asyncUtils-C5b0g4Vr.js";import"./signal-Cxu9Z1Kf.js";import"./Map-BQwbVliJ.js";import"./Basemap-BLSYwfav.js";import"./loadAll-CbqpgDCk.js";import"./PortalItem-DLsR4Y2a.js";import"./writeUtils-Bje94ctQ.js";import"./layerUtils-CAMu1s-2.js";import"./persistable-glrbGfu8.js";import"./MD5-C9MwAd2G.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-CXue4rJ6.js";import"./PolygonCollection-DoAtzYfB.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-CggL8WYf.js";import"./TablesMixin-CnCDLfmO.js";import"./GraphicsCollection-CixPPU0K.js";import"./Graphic-sBrqQAPW.js";import"./PopupTemplate-D_WeQBNh.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-Du36Z1Jr.js";import"./SimpleMarkerSymbol-B18xir4G.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-CGMzNzJN.js";import"./TextSymbol-C7i9ol-5.js";import"./PictureMarkerSymbol-D6pzvUP4.js";import"./HeightModelInfo-DBDBaZ2u.js";import"./timeZoneUtils-DlgpSZrP.js";import"./ReactiveMap-D39lG9XE.js";import"./ViewingMode-Chk7YAAL.js";import"./enums-oVqQqnoy.js";import"./TileKey-DZRgo92L.js";import"./quickselect-QQC62dOK.js";import"./normalizeUtils-DiYDtdl8.js";import"./normalizeUtilsCommon-BcGwSELE.js";import"./utils-DM3VuI_N.js";import"./utils-Kw6dbpdX.js";import"./mat3-CruJiiUv.js";import"./vec2f32-CaVKkSa6.js";import"./Scheduler-BH9l6DUT.js";import"./unitBezier-B1N-tmtC.js";import"./definitions-CASyCajO.js";import"./enums-UBzvFP7O.js";import"./Texture-BXXxnW90.js";import"./getDataTypeBytes-D2DiHx_d.js";import"./imageUtils-CcEg-3Il.js";import"./capabilities-Cggz07g5.js";import"./ILyr3DWasmPerSceneView-CIC-HPGZ.js";import"./Version-B0YYd6Ho.js";import"./vec42-CKs01hkn.js";import"./vec4f64-DPb6J-GU.js";import"./plane-C4pzHMdp.js";import"./vectorStacks-BEpDSRxH.js";import"./mat3f64-B5o_lm6j.js";import"./mat4f64-q_b6UJoq.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-BTK9a7ED.js";import"./spatialReferenceEllipsoidUtils-U_tEFhD2.js";import"./RouteLayerInteraction-DhT-tUlj.js";import"./GraphicsLayer-DiGOhhuQ.js";import"./BlendLayer-ZjS29wea.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-DI0kf7Dd.js";import"./parser-NZ6dFu80.js";import"./ScaleRangeLayer-Ci7jgVw5.js";import"./Stop-BWzFXSEc.js";import"./networkEnums-BDHMASSX.js";import"./geodeticLengthOperator-DnIP1hCn.js";import"./geodeticCurveType-CirnHLSB.js";import"./earcut-D9gy186-.js";import"./triangle-BHW4KDad.js";import"./lineSegment-D4GoMluZ.js";import"./VertexSnappingCandidate-C017KVXJ.js";import"./PointSnappingHint-fA1lX8jW.js";import"./LRUCache-eBEVKbNU.js";import"./MemCache-CUhFgUMJ.js";let o=class extends E{get availability(){return 1}get _snappingElevationAligner(){const{view:t}=this,{layer:i}=this.layerSource,r=t!=null&&t.type==="3d";if(!r||i.type==="subtype-group")return w();const e=async(a,m)=>(await D(t.whenLayerView(i),m)).elevationAlignPointsInFeatures(a,m);return w(r,{elevationInfo:i.elevationInfo,alignPointsInFeatures:e})}get _snappingElevationFilter(){const{view:t}=this,i=t!=null&&t.type==="3d"&&this.layerSource.layer.type!=="subtype-group";return L(i)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:i}=this.layerSource;return t!=null&&t.type==="3d"&&i.type!=="subtype-group"?f(this._symbologySnappingSupported,async(r,e)=>{const a=await t.whenLayerView(i);return l(e),a.queryForSymbologySnapping({candidates:r,spatialReference:t.spatialReference},e)}):f()}get _layerView(){const{view:t}=this;if(t==null)return null;const{layer:i}=this.layerSource;return t.allLayerViews.find(r=>r.layer===i)}get _layerView3D(){const{view:t}=this;return t==null||t.type==="2d"?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:i}=this.layerSource;t!=null&&t.type==="3d"&&i.type!=="subtype-group"&&this.addHandles([t.elevationProvider.on("elevation-change",({context:r})=>{const{elevationInfo:e}=i;x(r,e)&&this._snappingElevationAligner.notifyElevationSourceChange()}),d(()=>i.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),v),d(()=>{var r;return this._layerView3D!=null?(r=this._layerView3D.layer)==null?void 0:r.renderer:null},()=>this._symbologySnappingFetcher.notifySymbologyChange(),v),$(()=>{var r;return(r=this._layerView3D)==null?void 0:r.layer},["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(t){super(t),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=A(z)}refresh(){}async fetchCandidates(t,i){var g,h;const{layer:r}=this.layerSource,{source:e}=r;if(!(e!=null&&e.querySnapping))return[];const a=r.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(a.where=I(a.where,(g=this._layerView.effectiveDisplayFilter)==null?void 0:g.where));const m="returnZ"in r?r.returnZ:void 0,y=G({parameters:t,mode:((h=this.view)==null?void 0:h.type)??"2d",returnZ:m,filter:a}),S=await e.querySnapping(y,{signal:i});l(i);const u=t.coordinateHelper.spatialReference,s=await this._snappingElevationAligner.alignCandidates(S.candidates,u,i);l(i);const c=await this._symbologySnappingFetcher.fetch(s,i);l(i);const _=c.length===0?s:[...s,...c],b=this._snappingElevationFilter.filter(y,_),V=this._memoizedMakeGetGroundElevation(this.view,u);return b.map(F=>q(F,V))}};p([n({constructOnly:!0})],o.prototype,"layerSource",void 0),p([n({constructOnly:!0})],o.prototype,"view",void 0),p([n()],o.prototype,"_snappingElevationAligner",null),p([n()],o.prototype,"_snappingElevationFilter",null),p([n()],o.prototype,"_symbologySnappingFetcher",null),p([n()],o.prototype,"_layerView",null),p([n()],o.prototype,"_layerView3D",null),p([n()],o.prototype,"_symbologySnappingSupported",null),o=p([C("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],o);export{o as FeatureCollectionSnappingSource};
