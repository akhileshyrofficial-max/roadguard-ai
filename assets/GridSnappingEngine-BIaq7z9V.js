import{x as V,cm as U,i as X,at as Y,c as n,m as a,d as D}from"./Identifiable-_3rFZ1o6.js";import{w as E}from"./vec32-soPbwaVZ.js";import{U as F,O as j}from"./projectionUtils-BdqPecQc.js";import{P as W}from"./normalizeUtils-BS0bJnzn.js";import{u as H}from"./scaleUtils-B8vcNDUc.js";import{l as I,u as T,t as _}from"./gridUtils-Ctb4KHSB.js";import{f as d,d as k,c as q}from"./hitTestSelectUtils-DuQI-drP.js";import{r as G,a as A}from"./RouteLayerInteraction-DrsWX9Wp.js";import"./index-BEHHhRxI.js";import"./common-DQOJ18NT.js";import"./normalizeUtilsCommon-Ca72SEzL.js";import"./jsonUtils-Cc67rW5Z.js";import"./utils-C73sopP7.js";import"./utils-UVgDzRJn.js";import"./geodesicUtils-5UKmzzQW.js";import"./Cyclical-C1_PpBfH.js";import"./quantityUtils-CfVXs5z9.js";import"./vec2-ChnYg_BJ.js";import"./vec2f64-Cgb6qxNH.js";import"./projectVectorToVector-DAecJS5f.js";import"./projectPointToVector-BeChI4_x.js";import"./fieldUtils-z3GG2R-H.js";import"./Layer--GugXUPW.js";import"./Query-Dp8boimB.js";import"./typeUtils-mxDsOnhk.js";import"./Field-Bopg3Spw.js";import"./fieldType-Pks4G8In.js";import"./MapView-DvC1rydD.js";import"./CollectionFlattener-kjXuGTXg.js";import"./workers-BcCT7nhd.js";import"./Queue-CJjQn74K.js";import"./intl-Beb5GWXc.js";import"./number-7p_O6jwX.js";import"./TileInfo-CvSYzqJL.js";import"./TileKey-DZd6gJy7.js";import"./jsxFactory-BbJVeaDA.js";import"./uuid-Cl5lrJ4c.js";import"./sanitizerUtils-CJlLEeXg.js";import"./UpdatingHandles-BZb3Zh99.js";import"./asyncUtils-CmphLL3n.js";import"./signal-R7pX2aet.js";import"./Map-BfsPAzzq.js";import"./Basemap-xdFWd_Ef.js";import"./loadAll-MI_JOpdU.js";import"./PortalItem-Dn4oT_Gd.js";import"./writeUtils-CFLt5Al1.js";import"./layerUtils-CFmFO8Du.js";import"./persistable-DdbzkEuJ.js";import"./MD5-C9MwAd2G.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-a1-4zqTB.js";import"./PolygonCollection-CMbOuNoO.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-CEszlm-2.js";import"./TablesMixin-DOSIq3qh.js";import"./GraphicsCollection-csXasQht.js";import"./Graphic-q_7OAYHf.js";import"./PopupTemplate-B09IYibB.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-Buir9u-w.js";import"./SimpleMarkerSymbol-Drowg4jp.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-DNlIzH5i.js";import"./TextSymbol-keZwKiPd.js";import"./PictureMarkerSymbol-DlgeV3xL.js";import"./HeightModelInfo-C8sA4bKM.js";import"./timeZoneUtils-Cef7SfoB.js";import"./ReactiveMap-DptZZMoQ.js";import"./ViewingMode-Chk7YAAL.js";import"./enums-NCSMZWP1.js";import"./TileKey-upwcIO5W.js";import"./quickselect-QQC62dOK.js";import"./mat3-CruJiiUv.js";import"./vec2f32-CaVKkSa6.js";import"./Scheduler-DH2YvKGe.js";import"./unitBezier-B1N-tmtC.js";import"./definitions-CASyCajO.js";import"./enums-UBzvFP7O.js";import"./Texture-BILrrMzS.js";import"./getDataTypeBytes-D2DiHx_d.js";import"./imageUtils-DN-q3Lg0.js";import"./capabilities-Cggz07g5.js";import"./ILyr3DWasmPerSceneView-CIC-HPGZ.js";import"./Version-BR-Ucixf.js";import"./vec42-CKs01hkn.js";import"./vec4f64-DPb6J-GU.js";import"./plane-BnjjlcHJ.js";import"./vectorStacks-Cflk7ctu.js";import"./mat3f64-B5o_lm6j.js";import"./mat4f64-q_b6UJoq.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-CxG2piVF.js";import"./elevationInfoUtils-DRGp9Lv0.js";import"./ElevationInfo-7Ug8ElGs.js";import"./lengthUtils-CrwfL9_h.js";import"./spatialReferenceEllipsoidUtils-DTRGV_GU.js";import"./GraphicsLayer-BOJ0yOnh.js";import"./BlendLayer-DNv82dbV.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-CO8m00ps.js";import"./parser-BgHAYnRY.js";import"./ScaleRangeLayer-5c4AXGq9.js";import"./Stop-BpZ8Nuyu.js";import"./networkEnums-BTp20v-Z.js";import"./geodeticLengthOperator-BHayuOJB.js";import"./geodeticCurveType-CirnHLSB.js";import"./earcut-D9gy186-.js";import"./triangle-WIUNF1ZS.js";import"./lineSegment-Bl6I3b1d.js";let p=class extends V{constructor(t){super(t),this.options=null}destroy(){this._set("options",null)}get grid(){return this.view.grid}get effectiveViewRotation(){var t;return(t=this.grid)!=null&&t.rotateWithMap?0:U(this.view.rotation??0)}get gridRotation(){var t;return U(((t=this.grid)==null?void 0:t.rotation)??0)}get gridCenter(){var r;const{spatialReference:t,grid:e}=this;if(!e||!t||!F(e.center.spatialReference,t))return null;try{const i=j(e.center,t),o=t.isWrappable&&((r=this.view)==null?void 0:r.center)!=null?W(i.x,this.view.center.x,t):i.x;return d(o,i.y,i.z)}catch(i){return X.getLogger(this).errorOnce("Grid Snapping - Failed to project grid center.",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:I(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?Y(t.spacing,t.units,"meters"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return t==null?null:t*H(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?T(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return this.grid!=null&&this.spatialReference!=null&&this.viewMetersPerSRUnit==null}async fetchCandidates(t,e,r){var l;const{options:i,view:o}=this;if(!(i!=null&&i.effectiveGridEnabled)||!o.grid||(l=r.feature)!=null&&l.attributes&&k in r.feature.attributes)return[];const s=r.coordinateHelper.arrayToPoint(t),m=i.distance*(r.pointer==="touch"?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(s,m)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:o,gridRotation:s,gridCenter:m,viewMetersPerPixel:l,viewMetersPerSRUnit:f,offsetScaleFactor:S,spatialReference:g,gridMetersPerStride:C,pixelsPerStride:$}=this;if(!(i&&l&&f&&m&&g&&S&&C&&$)||!i.dynamicScaling&&$<_||!F(t.spatialReference,g))return r;const y=j(t,g),z=d(y.x,y.y,y.z),u=h(z,-s,m,-o),P=C/f*S,c=B(u,P,m),{shouldSnapX:w,shouldSnapY:v}=J(c,u,e,l,f);if(!w&&!v)return[];const L=d((w?c:u)[0],(v?c:u)[1]),M=h(L,s,m,o),b=h(c,s,m,o);if(v){const R=O(c,u,P,"y"),x=h(R,s,m,o);r.push(new G({lineStart:b,lineEnd:x,targetPoint:M,isDraped:!1}))}if(w){const R=O(c,u,P,"x"),x=h(R,s,m,o);r.push(new G({lineStart:b,lineEnd:x,targetPoint:M,isDraped:!1}))}return w&&v&&r.push(new A(M,r[0],r[1],!1)),r}};n([a({constructOnly:!0})],p.prototype,"view",void 0),n([a()],p.prototype,"options",void 0),n([a()],p.prototype,"grid",null),n([a()],p.prototype,"effectiveViewRotation",null),n([a()],p.prototype,"gridRotation",null),n([a()],p.prototype,"gridCenter",null),n([a()],p.prototype,"offsetScaleFactor",null),n([a()],p.prototype,"spatialReference",null),n([a()],p.prototype,"gridMetersPerStride",null),n([a()],p.prototype,"viewMetersPerPixel",null),n([a()],p.prototype,"viewMetersPerSRUnit",null),n([a()],p.prototype,"pixelsPerStride",null),n([a()],p.prototype,"updating",null),p=n([D("esri.views.interactive.snapping.GridSnappingEngine")],p);const h=(t,e,r,i)=>{const o=q(t[0],t[1],t[2]);return E(o,E(o,o,r,e),r,i)},B=(t,e,r)=>{const i=(t[0]-r[0])/e,o=(t[1]-r[1])/e,s=Math.trunc(i),m=Math.trunc(o),l=Math.round(i%1),f=Math.round(o%1),S=r[0]+(s+l)*e,g=r[1]+(m+f)*e;return d(S,g)},J=(t,e,r,i,o)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const s=(t[0]-e[0])/i,m=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(s*o)<r,shouldSnapY:Math.abs(m*o)<r}},O=(t,e,r,i)=>{if(i==="y"){const s=e[0]>t[0]?1:-1;return d(t[0]+r*s,t[1])}const o=e[1]>t[1]?1:-1;return d(t[0],t[1]+r*o)};export{p as GridSnappingEngine};
