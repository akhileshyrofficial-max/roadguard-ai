const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/statsWorker-DEhbHreq.js","assets/utils-CvTVbJNb.js","assets/Identifiable-_3rFZ1o6.js","assets/index-BEHHhRxI.js","assets/screenUtils-aQeO9QTD.js","assets/Layer--GugXUPW.js","assets/quantizationUtils-C8uJ5ebt.js","assets/fieldUtils-z3GG2R-H.js","assets/heatmapUtils-D0hGWZT9.js","assets/vec42-CKs01hkn.js","assets/common-DQOJ18NT.js","assets/vec4f64-DPb6J-GU.js","assets/utils-XTVqdLXj.js","assets/mat4f32-Djp3mnm5.js","assets/mat4-CEszlm-2.js","assets/number-7p_O6jwX.js","assets/timeZoneUtils-Cef7SfoB.js","assets/utils-DbQdGEX2.js","assets/ClassBreaksDefinition-BJIhW5Q8.js","assets/geometryEngineWorker-DP5wF4VG.js","assets/geometryEngineJSON-CcgrjWgh.js","assets/geometryEngineBase-DXq9NeSb.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/json-Wa8cmqdu.js","assets/operatorsWorker-BchDYdoe.js","assets/jsonUtils-Cc67rW5Z.js","assets/CSVSourceWorker-DR8ocE7N.js","assets/asyncUtils-CmphLL3n.js","assets/date-Ctp1FiBW.js","assets/projectionUtils-BdqPecQc.js","assets/OptimizedFeature-C57xHwXW.js","assets/memoryEstimations-BG_NSMOj.js","assets/executeQueryForSnapping-B70GSxOt.js","assets/normalizeUtils-BS0bJnzn.js","assets/normalizeUtilsCommon-Ca72SEzL.js","assets/utils-C73sopP7.js","assets/utils-UVgDzRJn.js","assets/queryUtils-Cag0ceeo.js","assets/QueryEngine-ZiVgiJec.js","assets/aaBoundingBox-DNlIzH5i.js","assets/featureConversionUtils-scwmf_ir.js","assets/OptimizedFeatureSet-BR8EEvDc.js","assets/createFeatureId-BiB9j2WD.js","assets/WhereClauseCache-bgzfZccG.js","assets/LRUCache-eBEVKbNU.js","assets/MemCache-CUhFgUMJ.js","assets/WhereClause-GH2HPADl.js","assets/TimeOnly-YXxQ25V6.js","assets/enum-DaKdEk_o.js","assets/UnknownTimeZone-CpPKXuRf.js","assets/fieldType-Pks4G8In.js","assets/timeSupport-Btk7Sbvt.js","assets/QueryEngineCapabilities-CsRUnGk7.js","assets/SnappingCandidate-DGkpYqI6.js","assets/FixedIntervalBinParameters-CqHG-zwl.js","assets/NormalizationBinParametersMixin-DdJue4AE.js","assets/FieldsIndex-BTwzr3dJ.js","assets/Scheduler-DH2YvKGe.js","assets/signal-R7pX2aet.js","assets/FeatureStore-DwLYiBQY.js","assets/BoundsStore-Bh6_x4Ps.js","assets/PooledRBush-2eGRraPp.js","assets/quickselect-QQC62dOK.js","assets/optimizedFeatureQueryEngineAdapter-AkYOo5Gh.js","assets/number-CofdhOJW.js","assets/clientSideDefaults-C0afugGq.js","assets/defaultsJSON-GKolV7NZ.js","assets/EdgeProcessingWorker-MlTgCT0H.js","assets/workerHelper-B1Q3rYNK.js","assets/InterleavedLayout-sBpZXb9C.js","assets/BufferView-eGDukKmQ.js","assets/vec2-ChnYg_BJ.js","assets/vec32-soPbwaVZ.js","assets/vec2f64-Cgb6qxNH.js","assets/types-BKo2foNY.js","assets/edgeProcessing-DyyQHuWE.js","assets/deduplicate-Xkyt2L53.js","assets/Indices-CJx9tykA.js","assets/VertexAttribute-BfkzOMLV.js","assets/glUtil-DRNmC8Up.js","assets/enums-UBzvFP7O.js","assets/VertexElementDescriptor-BLyltQyJ.js","assets/Normals-D5GIqjuf.js","assets/ElevationSamplerWorker-0alVbZp6.js","assets/MeshLocalVertexSpace-DhAtAXfe.js","assets/vertexSpaceConversion-zzk3KXPr.js","assets/mat3-CruJiiUv.js","assets/mat3f64-B5o_lm6j.js","assets/mat4f64-q_b6UJoq.js","assets/spatialReferenceEllipsoidUtils-DTRGV_GU.js","assets/computeTranslationToOriginAndRotation-BC1si6zj.js","assets/projectPointToVector-BeChI4_x.js","assets/meshVertexSpaceUtils-BPkMPmro.js","assets/vec3-BskQ-MRq.js","assets/vec4-D2P2fOM6.js","assets/FeatureServiceSnappingSourceWorker-DjJs4qaz.js","assets/UpdatingHandles-BZb3Zh99.js","assets/TileInfo-CvSYzqJL.js","assets/TileKey-DZd6gJy7.js","assets/Query-Dp8boimB.js","assets/typeUtils-mxDsOnhk.js","assets/Field-Bopg3Spw.js","assets/ElevationInfo-7Ug8ElGs.js","assets/lengthUtils-CrwfL9_h.js","assets/symbologySnappingCandidates-DzOgE8Oy.js","assets/uuid-Cl5lrJ4c.js","assets/pbfQueryUtils-G12Ca3sG.js","assets/pbf-CS5_6Vtc.js","assets/query-BK4ukVuP.js","assets/queryZScale-yLGROW-s.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/GeoJSONSourceWorker-YIiyt5nS.js","assets/geojson-D98aUo3Z.js","assets/sourceUtils-DExfbA9U.js","assets/LercWorker-D3XLWecG.js","assets/MemorySourceWorker-BsIhI_ub.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-EL5wrZBh.js","assets/dehydratedFeatures-D_C0Fb3K.js","assets/FeaturePipelineWorker-e7kEdpyZ.js","assets/definitions-CASyCajO.js","assets/diffUtils-C5CsICXC.js","assets/enums-NCSMZWP1.js","assets/TileKey-upwcIO5W.js","assets/Queue-CJjQn74K.js","assets/ReactiveMap-DptZZMoQ.js","assets/AttributeStore-BDrrFxke.js","assets/Utils-BG5m93IY.js","assets/vec2f32-CaVKkSa6.js","assets/getDataTypeBytes-D2DiHx_d.js","assets/UpdateTracking2D-D5YHt5xb.js","assets/BidiEngine-QXap_35O.js","assets/TextSymbol-keZwKiPd.js","assets/SimpleMarkerSymbol-Drowg4jp.js","assets/GeometryUtils-CiPYWcEQ.js","assets/enums-BPiq_WIC.js","assets/utils-DrbBeUzW.js","assets/defaultCIMValues-BrbaHf9c.js","assets/rasterizingUtils-CdiTAUhT.js","assets/floatRGBA-xT4oRKt0.js","assets/Rect-CUzevAry.js","assets/defaults-CSNv9gRz.js","assets/ArcadeExpression-u2IaIuRW.js","assets/labelUtils-BoctouOq.js","assets/constants-BFLErLYb.js","assets/streamLayerUtils-CKwt2uXH.js","assets/DictionaryScriptEvaluator-B-exTvTE.js","assets/Version-BR-Ucixf.js","assets/MeshWriterRegistry-XUlgEad9.js","assets/TechniqueType-CFPo0AVB.js","assets/PieChartMeshWriter-DnCRRp1U.js","assets/libtess-B86nGuKR.js","assets/earcut-D9gy186-.js","assets/QueueProcessor-BZCvf8_s.js","assets/operatorGeodeticDensify-DBSqZ6Rx.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/geodeticCurveType-CirnHLSB.js","assets/normalizeUtilsSync-2v9P1_zl.js","assets/displayFilterUtils-Cgv563kp.js","assets/ogcFeatureUtils-hzW05Dtf.js","assets/bundle-D2hyHz7d.js","assets/CircularArray-CujHzHWW.js","assets/createConnection-CU0h-ETN.js","assets/intl-Beb5GWXc.js","assets/PointCloudWorker-HaTriGdN.js","assets/quat-9ZYTS2cW.js","assets/quatf64-aQ5IuZRd.js","assets/vec3f32-WCVSSNPR.js","assets/PointCloudUniqueValueRenderer-BfOFAjgM.js","assets/RendererLegendOptions-DWy2dLCX.js","assets/ColorStop-DY3WB4ha.js","assets/I3SBinaryReader-BcB41eUM.js","assets/orientedBoundingBox-hrOoocb4.js","assets/plane-BnjjlcHJ.js","assets/vectorStacks-Cflk7ctu.js","assets/ViewingMode-Chk7YAAL.js","assets/RasterWorker-CxvKwp_o.js","assets/GeographicTransformation-D6izncCS.js","assets/dataUtils-Dr5KRzjN.js","assets/RasterSymbolizer-Dc3ArwNG.js","assets/colorUtils-DQQagumJ.js","assets/rasterFunctionHelper-6S1OmDnr.js","assets/clipUtils-CEFueasy.js","assets/rasterProjectionHelper-BWJ4uK2N.js","assets/colorRamps-BmQEv1lz.js","assets/PolynomialTransform-gGC_3BAQ.js","assets/SceneLayerSnappingSourceWorker-Bz-2LSqY.js","assets/lineSegment-Bl6I3b1d.js","assets/sphere-CxG2piVF.js","assets/Octree-COxfz12D.js","assets/SceneLayerWorker-BowBhUFn.js","assets/projectVectorToVector-DAecJS5f.js","assets/I3SUtil-BmGkJ4zN.js","assets/edgeUtils-BDfyblQw.js","assets/NormalAttribute.glsl-CdDknX4M.js","assets/glsl-Cj7KC756.js","assets/ShaderOutput-Bdd80V3g.js","assets/BindType-BBwFZqyN.js","assets/WFSSourceWorker-cRE5-NiR.js","assets/wfsUtils-CBEjCTqz.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-DojXu4JJ.js","assets/constants-B-jzO-JJ.js","assets/config-DHajyIwB.js","assets/StyleDefinition-C4LQ4gTA.js","assets/SourceLayerData-BJB4U_h7.js","assets/StyleRepository-Q1LEsAh-.js","assets/unitBezier-B1N-tmtC.js","assets/Lyr3DWorker-vR0_GSJU.js","assets/ILyr3DWasmPerSceneView-CIC-HPGZ.js","assets/Feature3DPipelineWorker-BNn8OH7f.js","assets/jsonUtils-CBYo0IFI.js","assets/typeUtils-cqQ4KuGR.js","assets/ClassBreaksRenderer-zodgNWUT.js","assets/commonProperties-CEA2GgpB.js","assets/visualVariableUtils-DciVTowe.js","assets/Graphic-q_7OAYHf.js","assets/PopupTemplate-B09IYibB.js","assets/typeUtils-Buir9u-w.js","assets/PictureMarkerSymbol-DlgeV3xL.js","assets/jsonUtils-MHL9p1Rq.js","assets/layerUtils-CFmFO8Du.js","assets/defaults3D-CE2uGgSa.js","assets/SimpleRenderer-Fz8G_PFF.js","assets/UniqueValueRenderer-CBLY0uWW.js","assets/styleUtils-D7bnZHs6.js","assets/dehydratedFeatureUtils-C8oyt_6N.js","assets/hydratedFeatures-DblK-9Cb.js","assets/OutputColorHighlightOID.glsl-8UHClkSU.js","assets/videoUtils-DPV6BAnp.js","assets/requestImageUtils-BHk_87m3.js","assets/basicInterfaces-CZwQPxTp.js","assets/TextureFormat-1mYWTFa-.js","assets/Texture-BILrrMzS.js","assets/triangle-WIUNF1ZS.js","assets/renderState-vHoqBeQT.js","assets/boundedPlane-2Hh3t6Go.js","assets/HUDMaterial.glsl-DpvvNYwo.js","assets/ShaderBuilder-CT-EKmsJ.js","assets/DefaultMaterial-32pTQzqS.js","assets/HUDMaterial-CxZ1r1hd.js","assets/primitiveObjectSymbolUtils-CtAuwq9r.js","assets/IntersectorType-gQim6TH1.js","assets/TextureCompressionWorker-i3sASV66.js"])))=>i.map(i=>d[i]);
import{b5 as l,b as C,fx as ee,s as j,dS as ce,aB as w,A as ue,B as v,e as he,aC as W,dc as de,aA as pe,cS as _e,aw as R,fy as fe,H as ge,e0 as H,i as te,ao as I,c1 as b,bL as V,cV as me,az as be}from"./Identifiable-_3rFZ1o6.js";import{s as x}from"./Queue-CJjQn74K.js";import{_ as u}from"./index-BEHHhRxI.js";import"./intl-Beb5GWXc.js";const re="20250917",se="2136612b0849a0d597a86ff9f672ef9f9b4016c4",oe=new FinalizationRegistry(r=>{r.close()});function ye(r,e){oe.register(r,e,e)}function ke(r){oe.unregister(r)}function ne(r,e){return new Proxy({},{get:(s,t,o)=>(...n)=>{let i,a;const c=n[n.length-1];return we(c)&&(i=c.signal,a=c.transferList,n.pop()),r.apply(e?`${e}.${t.toString()}`:t.toString(),n,{transferList:a,signal:i})}})}function we(r){return typeof r=="object"&&!Array.isArray(r)&&r!=null&&("signal"in r||"transferList"in r||Object.keys(r).length===0)}const ve={statsWorker:()=>u(()=>import("./statsWorker-DEhbHreq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])),geometryEngineWorker:()=>u(()=>import("./geometryEngineWorker-DP5wF4VG.js"),__vite__mapDeps([19,20,21,22,23])),arcadeGeometryOperatorsWorker:()=>u(()=>import("./operatorsWorker-BchDYdoe.js"),__vite__mapDeps([24,3,25,2])),CSVSourceWorker:()=>u(()=>import("./CSVSourceWorker-DR8ocE7N.js"),__vite__mapDeps([26,2,3,27,28,29,23,30,31,32,25,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,7,50,51,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,59,60,61,62,63,64,65,66])),EdgeProcessingWorker:()=>u(()=>import("./EdgeProcessingWorker-MlTgCT0H.js"),__vite__mapDeps([67,68,69,70,71,10,72,2,3,9,73,11,74,75,76,77,78,79,80,81,82])),ElevationSamplerWorker:()=>u(()=>import("./ElevationSamplerWorker-0alVbZp6.js"),__vite__mapDeps([83,2,3,61,62,84,85,86,10,87,14,88,72,89,90,29,91,92,93,70,71,9,73,11,94])),FeatureServiceSnappingSourceWorker:()=>u(()=>import("./FeatureServiceSnappingSourceWorker-DjJs4qaz.js"),__vite__mapDeps([95,2,3,96,25,32,33,34,35,36,37,29,23,38,39,40,30,31,41,42,43,44,45,46,47,48,49,7,50,51,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,59,60,61,62,63,97,98,99,100,101,102,103,104,27,105,106,107,108,109,110])),GeoJSONSourceWorker:()=>u(()=>import("./GeoJSONSourceWorker-YIiyt5nS.js"),__vite__mapDeps([111,2,3,27,25,40,39,30,31,41,42,32,33,34,35,36,37,29,23,38,43,44,45,46,47,48,49,7,50,51,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,59,60,61,62,63,112,28,65,66,113])),LercWorker:()=>u(()=>import("./LercWorker-D3XLWecG.js"),__vite__mapDeps([114,2,3])),MemorySourceWorker:()=>u(()=>import("./MemorySourceWorker-BsIhI_ub.js"),__vite__mapDeps([115,2,3,25,40,39,30,31,41,42,116,32,33,34,35,36,37,29,23,38,43,44,45,46,47,48,49,7,50,51,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,59,60,61,62,63,65,66,113,28])),PBFDecoderWorker:()=>u(()=>import("./PBFDecoderWorker-EL5wrZBh.js"),__vite__mapDeps([117,2,3,29,118,31,39,100,101,50,40,25,30,41,42,106,107])),FeaturePipelineWorker:()=>u(()=>import("./FeaturePipelineWorker-e7kEdpyZ.js"),__vite__mapDeps([119,2,3,4,97,98,120,121,122,10,123,71,124,125,58,62,99,25,100,101,50,5,126,127,80,128,129,81,39,130,131,132,133,30,31,134,135,136,137,138,139,140,141,66,96,142,47,48,49,56,7,16,15,143,144,37,29,33,34,35,36,23,51,40,41,42,6,145,146,147,148,149,150,151,152,73,153,63,38,43,44,45,46,52,1,8,9,11,12,13,14,17,18,53,54,55,57,154,155,156,157,108,106,107,109,158,105,159,112,28,65,113,160,161,162,163])),PointCloudWorker:()=>u(()=>import("./PointCloudWorker-HaTriGdN.js"),__vite__mapDeps([164,2,3,165,87,166,10,72,9,167,29,168,169,170,171,78,172,86,88,11,89,90,14,173,174,73,175])),RasterWorker:()=>u(()=>import("./RasterWorker-CxvKwp_o.js"),__vite__mapDeps([176,2,3,177,178,179,22,180,9,10,11,181,25,100,182,183,29,184,101,50,185])),SceneLayerSnappingSourceWorker:()=>u(()=>import("./SceneLayerSnappingSourceWorker-Bz-2LSqY.js"),__vite__mapDeps([186,2,3,72,10,187,188,14,9,11,86,87,174,88,166,73,189,173,70,71,75,76,77,69,74,78,79,80,81,82])),SceneLayerWorker:()=>u(()=>import("./SceneLayerWorker-BowBhUFn.js"),__vite__mapDeps([190,3,2,84,93,29,191,91,11,188,14,10,72,9,86,87,174,88,166,73,192,7,99,25,100,101,50,5,171,78,193,4,139,194,195,196,197,172,165,89,90,173,175,124,163,15])),WFSSourceWorker:()=>u(()=>import("./WFSSourceWorker-cRE5-NiR.js"),__vite__mapDeps([198,27,2,3,40,39,25,30,31,41,42,32,33,34,35,36,37,29,23,38,43,44,45,46,47,48,49,7,50,51,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,59,60,61,62,63,112,28,113,199,100,200,101])),WorkerTileHandler:()=>u(()=>import("./WorkerTileHandler-DojXu4JJ.js"),__vite__mapDeps([201,2,3,202,134,140,203,204,135,107,31,151,120,205,206,80,81,180,9,10,11,207,152,131])),Lyr3DWorker:()=>u(()=>import("./Lyr3DWorker-vR0_GSJU.js"),__vite__mapDeps([208,209,3,2])),Feature3DPipelineWorker:()=>u(()=>import("./Feature3DPipelineWorker-BNn8OH7f.js"),__vite__mapDeps([210,2,3,29,38,39,25,40,30,31,41,42,43,44,45,46,47,48,49,7,50,51,37,33,34,35,36,23,52,6,1,4,5,8,9,10,11,12,13,14,15,16,17,18,53,54,55,56,57,58,99,100,101,211,212,213,214,184,170,215,216,217,218,133,132,219,103,220,221,222,141,66,169,146,147,142,136,137,135,223,224,121,225,88,226,195,92,72,84,191,91,227,167,228,229,230,231,232,80,233,129,70,71,73,77,234,188,86,87,174,166,187,78,197,196,235,175,172,165,89,90,173,236,237,238,239,69,74,194,240,139,241,242,27,125,61,62,108,106,107,109])),TextureCompressionWorker:()=>u(()=>import("./TextureCompressionWorker-i3sASV66.js"),__vite__mapDeps([243,3,2,232,80]))},ie="worker:port-closed";var h;(function(r){r[r.HANDSHAKE=0]="HANDSHAKE",r[r.OPEN=1]="OPEN",r[r.OPENED=2]="OPENED",r[r.RESPONSE=3]="RESPONSE",r[r.INVOKE=4]="INVOKE",r[r.ABORT=5]="ABORT",r[r.CLOSE=6]="CLOSE",r[r.OPEN_PORT=7]="OPEN_PORT",r[r.ON=8]="ON"})(h||(h={}));let Ee=0;function ae(){return Ee++}function Pe(r){return r&&typeof r=="object"&&("result"in r||"transferList"in r)}function E(r){return r?typeof r=="string"?JSON.stringify({name:"message",message:r}):r.toJSON?JSON.stringify(r):JSON.stringify({name:r.name,message:r.message,details:r.details||{stack:r.stack}}):null}function D(r,e,s,t){if(e.type===h.OPEN_PORT)return void r.postMessage(e,[e.port]);if(e.type!==h.INVOKE&&e.type!==h.RESPONSE)return void r.postMessage(e);let o;if(Pe(s)?(o=q(s.transferList),e.data=s.result):(o=q(t),e.data=s),o){if(l("ff")){for(const n of o)if("byteLength"in n&&n.byteLength>267386880){const i="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case h.INVOKE:throw i;case h.RESPONSE:return void D(r,{type:h.RESPONSE,jobId:e.jobId,error:E(i)})}}}r.postMessage(e,o)}else r.postMessage(e)}function P(r){if(!r)return null;const e=r.data;return e?typeof e=="string"?JSON.parse(e):e:null}function q(r){if(!(r!=null&&r.length))return null;if(l("esri-workers-arraybuffer-transfer"))return r;const e=r.filter(s=>!Oe(s));return e.length?e:null}function Oe(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function Ue(r){try{return await r}catch(e){const s=(e==null?void 0:e.name)===ie;if(!(C(e)||s))throw e;return}}const{CLOSE:Q,ABORT:U,INVOKE:F,RESPONSE:y,OPEN_PORT:B,ON:Ie}=h,Le=2;class Se{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===h.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}const f=class f{static connect(e,s){const t=new MessageChannel;let o;o=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new f(t.port1,{channel:t,client:o,schedule:s});return typeof o=="object"&&"remoteClient"in o&&(o.remoteClient=n),f.clients.set(n,o),t.port2}static loadWorker(e){const s=ve[e];return s?s():Promise.resolve(null)}constructor(e,s,t,o){this._port=e,this._jobQueue=t,this._lowPriorityJobQueue=o,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new Se(n=>this._onInvokeMessage(n)),this._client=s.client,this._onMessage=this._onMessage.bind(this),this._channel=s.channel,this._schedule=s.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Q}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,s,t){return this.apply(e,[s],t)}apply(e,s,t){const o=t==null?void 0:t.signal,n=t==null?void 0:t.transferList;if(!this._port)return Promise.reject(new j(ie,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:s}));const i=ae();return new Promise((a,c)=>{if(ce(o))return this._processWork(),void c(w());const d=ue(o,()=>{const _=this._outJobs.get(i);_&&(this._outJobs.delete(i),this._processWork(),v(_.abortHandle),this._post({type:U,jobId:i}),c(w()))}),p={resolve:a,reject:c,abortHandle:d,debugInfo:e};this._outJobs.set(i,p),this._post({type:F,jobId:i,methodName:e,abortable:o!=null},s,n)})}createInvokeProxy(e){return ne(this,e)}on(e,s){const t=new MessageChannel;function o(n){s(n.data)}return this._port.postMessage({type:h.ON,eventType:e,port:t.port2},[t.port2]),t.port1.addEventListener("message",o),t.port1.start(),he(()=>{t.port1.postMessage({type:h.CLOSE}),t.port1.close(),t.port1.removeEventListener("message",o)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:B,port:e.port2}),e.port1}_processWork(){var i,a;if(this._outJobs.size>=Le)return;const e=((i=this._jobQueue)==null?void 0:i.pop())??((a=this._lowPriorityJobQueue)==null?void 0:a.pop());if(!e)return;const{methodName:s,data:t,invokeOptions:o,resolver:n}=e;this.apply(s,t,o).then(c=>n.resolve(c)).catch(c=>n.reject(c))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{v(e.abortHandle),e.reject(w(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,s){const t=P(e);if(t)switch(t.type){case y:this._onResponseMessage(t);break;case F:s?this._onInvokeMessage(t):this._invokeQueue.push(t);break;case U:this._onAbortMessage(t);break;case Q:this._onCloseMessage();break;case B:this._onOpenPortMessage(t);break;case Ie:this._onOnMessage(t)}}_onAbortMessage(e){const s=this._inJobs,t=e.jobId,o=s.get(t);this._invokeQueue.push(e),o&&(o.controller&&o.controller.abort(),s.delete(t))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&f.clients.get(this)===e&&e.destroy(),f.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:s,jobId:t,data:o=[],abortable:n}=e,i=n?new AbortController:null,a=this._inJobs;let c,d=this._client,p=d[s];try{if(!p&&s&&s.includes(".")){const _=s.split(".");for(let O=0;O<_.length-1;O++)d=d[_[O]],p=d[_[O+1]]}if(typeof p!="function")throw new TypeError(`${s} is not a function`);o.push({client:this,signal:i?i.signal:null}),c=p.apply(d,o)}catch(_){return void this._post({type:y,jobId:t,error:E(_)})}W(c)?(a.set(t,{controller:i,promise:c}),c.then(_=>{a.has(t)&&(a.delete(t),this._post({type:y,jobId:t},_))},_=>{a.has(t)&&(a.delete(t),C(_)||this._post({type:y,jobId:t,error:E(_||{message:`Error encountered at method ${s}`})}))})):this._post({type:y,jobId:t},c)}_onOpenPortMessage(e){new f(e.port,{client:this._client})}_onOnMessage(e){const{port:s}=e,t=this._client.on(e.eventType,n=>{s.postMessage(n)}),o=de(e.port,"message",n=>{const i=P(n);(i==null?void 0:i.type)===h.CLOSE&&(o.remove(),t.remove(),s.close())})}_onResponseMessage(e){const{jobId:s,error:t,data:o}=e,n=this._outJobs;if(!n.has(s))return;const i=n.get(s);n.delete(s),this._processWork(),v(i.abortHandle),t?i.reject(j.fromJSON(JSON.parse(t))):i.resolve(o)}_post(e,s,t){return D(this._port,e,s,t)}};f.kernelInfo={buildDate:re,fullVersion:ee,revision:se},f.clients=new Map;let g=f,Ae=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new x,this._ongoingLowPriorityJobsQueue=new x}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,s){return new Promise((t,o)=>{let n=!0;const i=a=>{R(s.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const c=e[a];W(c)?this._clientPromises[a]=c.then(d=>(this._clients[a]=new g(d,s,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),i(t),this._clients[a]),()=>(i(o),null)):(this._clients[a]=new g(c,s,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),i(t))}})}broadcast(e,s,t){const o=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const i=this._clientPromises[n];o[n]=i.then(a=>a==null?void 0:a.invoke(e,s,t))}return o}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(w(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(w(`Worker closing, aborting job calling '${e.methodName}'`));for(const s of this._clientPromises)s.then(t=>t==null?void 0:t.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,ke(this)}invoke(e,s,t){return this.apply(e,[s],t)}apply(e,s,t){const o=pe();((t==null?void 0:t.priority)==="low"?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:s,invokeOptions:t,resolver:o});for(let n=0;n<this._clientPromises.length;n++){const i=this._clients[n];i?i.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return o.promise}createInvokeProxy(e){return ne(this,e)}on(e,s){return Promise.all(this._clientPromises).then(()=>_e(this._clients.map(t=>t.on(e,s))))}openPorts(){return new Promise(e=>{const s=new Array(this._clientPromises.length);let t=s.length;for(let o=0;o<this._clientPromises.length;++o)this._clientPromises[o].then(n=>{n&&(s[o]=n.openPort()),--t===0&&e(s)})})}get test(){}};const Me={async request(r,e){var i,a;const s=r.options,t=s.responseType;s.signal=e==null?void 0:e.signal,s.responseType=t==="native"||t==="native-request-init"?"native-request-init":t&&["blob","json","text"].includes(t)&&((i=fe(r.url))!=null&&i.after)?t:"array-buffer";const o=await ge(r.url,s),n={data:o.data,httpStatus:o.httpStatus,ssl:o.ssl};switch((a=o.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},K={};function Ne(r){var s;const e={async:r.async,isDebug:r.isDebug,locale:r.locale,baseUrl:r.baseUrl,has:{...r.has},map:{...r.map},packages:((s=r.packages)==null?void 0:s.slice())||[],paths:{...K.paths,...r.paths}};return r.hasOwnProperty("async")||(e.async=!0),r.hasOwnProperty("isDebug")||(e.isDebug=!1),r.baseUrl||(e.baseUrl=K.baseUrl),e}class $e{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(s=>{this[s]=(...t)=>e[s](...t)})}}let N=class{constructor(){this._dispatcher=new $e,this._workerPostMessage({type:h.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){H(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,s,t){this._dispatcher.addEventListener(e,s,t)}removeEventListener(e,s,t){this._dispatcher.removeEventListener(e,s,t)}_workerPostMessage(e){H(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const s=P(e);if(s&&s.type===h.OPEN){const{modulePath:t,jobId:o}=s;let n=await g.loadWorker(t);n||(n=await import(t));const i=g.connect(n);this._workerPostMessage({type:h.OPENED,jobId:o,data:i})}}};const J=()=>te.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:je}=h,Re='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let L,S;const z="Failed to create Worker. Fallback to execute module in main thread";async function Je(){if(!l("esri-workers"))return G(new N);if(!L&&!S)try{const e=Re.split("{CONFIGURATION}").join(Ce());L=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){S=e||{}}let r;if(L)try{r=new Worker(L,{name:"esri-worker-"+We++})}catch{J().warn(z,S),r=new N}else J().warn(z,S),r=new N;return G(r)}async function G(r){return new Promise(e=>{function s(o){const n=P(o);n&&n.type===je&&(r.removeEventListener("message",s),r.removeEventListener("error",t),e(r))}function t(o){o.preventDefault(),r.removeEventListener("message",s),r.removeEventListener("error",t),J().warn("Failed to create Worker. Fallback to execute module in main thread",o),(r=new N).addEventListener("message",s),r.addEventListener("error",t)}r.addEventListener("message",s),r.addEventListener("error",t)})}function Ce(){let r;if(I.default!=null){const o={...I};delete o.default,r=JSON.parse(JSON.stringify(o))}else r=JSON.parse(JSON.stringify(I));r.assetsPath=b(r.assetsPath),r.defaultAssetsPath=r.defaultAssetsPath?b(r.defaultAssetsPath):void 0,r.request.interceptors=[],r.log.interceptors=[],r.locale=V(),r.has={"esri-csp-restrictions":l("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":l("esri-2d-update-debug"),"esri-2d-log-updating":l("esri-2d-log-updating"),"featurelayer-pbf":l("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":l("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":l("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":l("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":l("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":l("featurelayer-query-max-depth"),"featurelayer-query-tile-max-features":l("featurelayer-query-tile-max-features"),"featurelayer-query-tile-concurrency":l("featurelayer-query-tile-concurrency"),"featurelayer-query-pausing-enabled":l("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-concurrency":l("featurelayer-snapshot-concurrency"),"featurelayer-snapshot-enabled":l("featurelayer-snapshot-enabled"),"esri-atomics":l("esri-atomics"),"esri-shared-array-buffer":l("esri-shared-array-buffer"),"esri-tiles-debug":l("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":l("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":l("feature-polyline-generalization-factor"),"host-webworker":1},r.workers.loaderUrl&&(r.workers.loaderUrl=b(r.workers.loaderUrl)),r.workers.workerPath?r.workers.workerPath=b(r.workers.workerPath):r.workers.workerPath=b(me("esri/core/workers/RemoteClient.js")),r.workers.useDynamicImport=!1;const e=I.workers.loaderConfig,s=Ne({baseUrl:e==null?void 0:e.baseUrl,locale:V(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:r,loaderConfig:s,kernelInfo:{buildDate:re,fullVersion:ee,revision:se}})}let We=0;const{ABORT:X,INVOKE:De,OPEN:Te,OPENED:He,RESPONSE:k}=h;class T{static async create(e){const s=await Je();return new T(s,e)}constructor(e,s){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=s,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",t=>{t.preventDefault(),te.getLogger("esri.core.workers.WorkerOwner").error(t)})}terminate(){this.worker.terminate()}async open(e,s={}){const{signal:t}=s,o=ae();return new Promise((n,i)=>{const a={resolve:n,reject:i,abortHandle:be(t,()=>{this._outJobs.delete(o),this._post({type:X,jobId:o})})};this._outJobs.set(o,a),this._post({type:Te,jobId:o,modulePath:e})})}_onMessage(e){const s=P(e);if(s)switch(s.type){case He:this._onOpenedMessage(s);break;case k:this._onResponseMessage(s);break;case X:this._onAbortMessage(s);break;case De:this._onInvokeMessage(s)}}_onAbortMessage(e){const s=this._inJobs,t=e.jobId,o=s.get(t);o&&(o.controller&&o.controller.abort(),s.delete(t))}_onInvokeMessage(e){const{methodName:s,jobId:t,data:o,abortable:n}=e,i=n?new AbortController:null,a=this._inJobs,c=Me[s];let d;try{if(typeof c!="function")throw new TypeError(`${s} is not a function`);d=c.call(null,o,{signal:i?i.signal:null})}catch(p){return void this._post({type:k,jobId:t,error:E(p)})}W(d)?(a.set(t,{controller:i,promise:d}),d.then(p=>{a.has(t)&&(a.delete(t),this._post({type:k,jobId:t},p))},p=>{a.has(t)&&(a.delete(t),p||(p={message:"Error encountered at method"+s}),C(p)||this._post({type:k,jobId:t,error:E(p||{message:`Error encountered at method ${s}`})}))})):this._post({type:k,jobId:t},d)}_onOpenedMessage(e){const{jobId:s,data:t}=e,o=this._outJobs.get(s);o&&(this._outJobs.delete(s),v(o.abortHandle),o.resolve(t))}_onResponseMessage(e){const{jobId:s,error:t,data:o}=e,n=this._outJobs.get(s);n&&(this._outJobs.delete(s),v(n.abortHandle),t?n.reject(j.fromJSON(JSON.parse(t))):n.resolve(o))}_post(e,s,t){return D(this.worker,e,s,t)}}const Y=l("host-browser")?Math.min(navigator.hardwareConcurrency-1,l("workers-pool-size")??8):0;let m=l("esri-mobile")?Math.min(Y,3):Y;m||(m=l("safari")&&l("mac")?7:2);let Z=0;const $=[];function Ke(){le()}async function A(r,e){const s=new Ae,{registryTarget:t,...o}=e;return await s.open(r,o),t&&ye(t,s),s}async function ze(r,e={}){if(typeof r!="string")throw new j("workers:undefined-module","modulePath is missing");let s=e.strategy||"distributed";if(l("host-webworker")&&!l("esri-workers")&&(s="local"),s==="local"){let t=await g.loadWorker(r);t||(t=await import(r)),R(e.signal);const o=e.client||t;return A([g.connect(t,e.schedule)],{...e,client:o})}if(await le(),R(e.signal),s==="dedicated"){const t=Z++%m;return A([await $[t].open(r,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const t=Math.min(e.maxNumWorkers,m);if(t<m){const o=new Array(t);for(let n=0;n<t;++n){const i=Z++%m;o[n]=$[i].open(r,e)}return A(o,e)}}return A($.map(t=>t.open(r,e)),e)}let M=null;async function le(){if(M)return M;new AbortController;const r=[];for(let e=0;e<m;e++){const s=T.create(e).then(t=>($[e]=t,t));r.push(s)}return M=Promise.all(r),M}export{g as E,Ue as O,Ae as c,Ke as m,ze as p};
