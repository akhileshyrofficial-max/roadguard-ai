import{x as E,l as d,a6 as $,f as v,aw as l,cQ as D,c as p,m as n,d as C}from"./Identifiable-BjM0PfdN.js";import{t as A}from"./memoize-DmxaQ-k8.js";import{r as I}from"./fieldUtils-Br-fPSxS.js";import{y as x}from"./elevationInfoUtils-BM_SdJ-M.js";import{y as G}from"./hitTestSelectUtils-CCAzSamd.js";import{o as q,i as z}from"./queryEngineUtils-BpMEWJuL.js";import{i as w,r as L,n as f}from"./symbologySnappingCandidates-DwWCDKTb.js";import"./index-CVvIVqY1.js";import"./ElevationInfo-B2ksLwBj.js";import"./lengthUtils-BDJ7rNGW.js";import"./Cyclical-B0bcmwRe.js";import"./quantityUtils-63xE9umB.js";import"./vec2-ChnYg_BJ.js";import"./common-DQOJ18NT.js";import"./vec2f64-Cgb6qxNH.js";import"./vec32-rHWgUfNj.js";import"./projectVectorToVector-yd877UiC.js";import"./projectionUtils-D3_kHwH-.js";import"./projectPointToVector-yyeyeVyg.js";import"./geodesicUtils-Cr-plA6M.js";import"./Layer-CUjb8Y3m.js";import"./Query-duJofNa2.js";import"./jsonUtils-DBuABSQZ.js";import"./typeUtils-U-Zf11cK.js";import"./Field-FVkerAtx.js";import"./fieldType-ClovGbuQ.js";import"./MapView-XXhq0wAO.js";import"./CollectionFlattener-CiW0r4Pq.js";import"./workers-BNUpPbJD.js";import"./Queue-DILFUEQB.js";import"./intl-ByqrfC_d.js";import"./number-CsIuR4Me.js";import"./TileInfo-gIGeOzNG.js";import"./TileKey-DZd6gJy7.js";import"./jsxFactory-D4gVuCa_.js";import"./uuid-Cl5lrJ4c.js";import"./sanitizerUtils-CJlLEeXg.js";import"./UpdatingHandles-DdU5IX8L.js";import"./asyncUtils-zc5DpkIL.js";import"./signal-CHoLd7Dm.js";import"./Map-C7AlwcQg.js";import"./Basemap-DEy_TBwO.js";import"./loadAll-tu8QdrIx.js";import"./PortalItem-5OKFVWCx.js";import"./writeUtils-DJnvrJq1.js";import"./layerUtils-CmDKJw7q.js";import"./persistable-Dy9UTZKT.js";import"./MD5-C9MwAd2G.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-B5tMzp3X.js";import"./PolygonCollection-CkOPuE2h.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-C8ai-EIY.js";import"./TablesMixin-N_koq_xq.js";import"./GraphicsCollection-B9Sj62PJ.js";import"./Graphic-C2Bnzy89.js";import"./PopupTemplate-CF36_3mn.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-CP9PJ8Sp.js";import"./SimpleMarkerSymbol-D-X_CJ8B.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-BrXqvn3i.js";import"./TextSymbol-DPyc43q3.js";import"./PictureMarkerSymbol-DOPylmLK.js";import"./HeightModelInfo-BaIW4m76.js";import"./timeZoneUtils-DMYcWBGI.js";import"./ReactiveMap-sVzP5DGX.js";import"./ViewingMode-Chk7YAAL.js";import"./enums-BuAlJCBy.js";import"./TileKey-DR2srngJ.js";import"./quickselect-QQC62dOK.js";import"./normalizeUtils-DfEBCyY7.js";import"./normalizeUtilsCommon-Bp_cDVNc.js";import"./utils-C83x6Enz.js";import"./utils-CFSOSud-.js";import"./mat3-CruJiiUv.js";import"./vec2f32-CaVKkSa6.js";import"./Scheduler-COHy2lsX.js";import"./unitBezier-B1N-tmtC.js";import"./definitions-CASyCajO.js";import"./enums-UBzvFP7O.js";import"./Texture-I7zBxmlP.js";import"./getDataTypeBytes-D2DiHx_d.js";import"./imageUtils-CKvAsRxn.js";import"./capabilities-Cggz07g5.js";import"./ILyr3DWasmPerSceneView-CIC-HPGZ.js";import"./Version-CWer4Z2d.js";import"./vec42-CKs01hkn.js";import"./vec4f64-DPb6J-GU.js";import"./plane-D3quJIjf.js";import"./vectorStacks-DgNdV_6b.js";import"./mat3f64-B5o_lm6j.js";import"./mat4f64-q_b6UJoq.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-mLO_dKdC.js";import"./spatialReferenceEllipsoidUtils-BYFAq5u2.js";import"./RouteLayerInteraction-DD57Onr-.js";import"./GraphicsLayer-B5Y1O4UM.js";import"./BlendLayer-DF9cB_oM.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-DU1z6yLO.js";import"./parser-BAKViB6V.js";import"./ScaleRangeLayer-YHoThhHM.js";import"./Stop-CYiQeHox.js";import"./networkEnums-BEjCt5UC.js";import"./geodeticLengthOperator-BlQK6vk8.js";import"./geodeticCurveType-CirnHLSB.js";import"./earcut-D9gy186-.js";import"./triangle-DlAvmH7a.js";import"./lineSegment-CP3RFx1A.js";import"./VertexSnappingCandidate-0HKHxUB5.js";import"./PointSnappingHint-D6UoW0ie.js";import"./LRUCache-eBEVKbNU.js";import"./MemCache-CUhFgUMJ.js";let o=class extends E{get availability(){return 1}get _snappingElevationAligner(){const{view:t}=this,{layer:i}=this.layerSource,r=t!=null&&t.type==="3d";if(!r||i.type==="subtype-group")return w();const e=async(a,m)=>(await D(t.whenLayerView(i),m)).elevationAlignPointsInFeatures(a,m);return w(r,{elevationInfo:i.elevationInfo,alignPointsInFeatures:e})}get _snappingElevationFilter(){const{view:t}=this,i=t!=null&&t.type==="3d"&&this.layerSource.layer.type!=="subtype-group";return L(i)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:i}=this.layerSource;return t!=null&&t.type==="3d"&&i.type!=="subtype-group"?f(this._symbologySnappingSupported,async(r,e)=>{const a=await t.whenLayerView(i);return l(e),a.queryForSymbologySnapping({candidates:r,spatialReference:t.spatialReference},e)}):f()}get _layerView(){const{view:t}=this;if(t==null)return null;const{layer:i}=this.layerSource;return t.allLayerViews.find(r=>r.layer===i)}get _layerView3D(){const{view:t}=this;return t==null||t.type==="2d"?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:i}=this.layerSource;t!=null&&t.type==="3d"&&i.type!=="subtype-group"&&this.addHandles([t.elevationProvider.on("elevation-change",({context:r})=>{const{elevationInfo:e}=i;x(r,e)&&this._snappingElevationAligner.notifyElevationSourceChange()}),d(()=>i.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),v),d(()=>{var r;return this._layerView3D!=null?(r=this._layerView3D.layer)==null?void 0:r.renderer:null},()=>this._symbologySnappingFetcher.notifySymbologyChange(),v),$(()=>{var r;return(r=this._layerView3D)==null?void 0:r.layer},["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(t){super(t),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=A(z)}refresh(){}async fetchCandidates(t,i){var g,h;const{layer:r}=this.layerSource,{source:e}=r;if(!(e!=null&&e.querySnapping))return[];const a=r.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(a.where=I(a.where,(g=this._layerView.effectiveDisplayFilter)==null?void 0:g.where));const m="returnZ"in r?r.returnZ:void 0,y=G({parameters:t,mode:((h=this.view)==null?void 0:h.type)??"2d",returnZ:m,filter:a}),S=await e.querySnapping(y,{signal:i});l(i);const u=t.coordinateHelper.spatialReference,s=await this._snappingElevationAligner.alignCandidates(S.candidates,u,i);l(i);const c=await this._symbologySnappingFetcher.fetch(s,i);l(i);const _=c.length===0?s:[...s,...c],b=this._snappingElevationFilter.filter(y,_),V=this._memoizedMakeGetGroundElevation(this.view,u);return b.map(F=>q(F,V))}};p([n({constructOnly:!0})],o.prototype,"layerSource",void 0),p([n({constructOnly:!0})],o.prototype,"view",void 0),p([n()],o.prototype,"_snappingElevationAligner",null),p([n()],o.prototype,"_snappingElevationFilter",null),p([n()],o.prototype,"_symbologySnappingFetcher",null),p([n()],o.prototype,"_layerView",null),p([n()],o.prototype,"_layerView3D",null),p([n()],o.prototype,"_symbologySnappingSupported",null),o=p([C("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],o);export{o as FeatureCollectionSnappingSource};
