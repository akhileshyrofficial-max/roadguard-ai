import{T as c,c as e,m as o,d as p,ar as Jt,ad as O,n as I,bn as Ot,g1 as Xt,bi as j,ab as T,x as Lt,aS as Ht,a5 as Yt,ac as qt,dv as Qt,fn as Zt,aC as te,i as ee,V as k,cz as ie}from"./Identifiable-_3rFZ1o6.js";import{y as oe,E as se,X as re}from"./fieldUtils-z3GG2R-H.js";let Z=class extends c{constructor(i){super(i),this.type=null}};e([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],Z.prototype,"type",void 0),Z=e([p("esri.popup.content.Content")],Z);const g=Z,Q=new Jt({asc:"ascending",desc:"descending"});let J=class extends O.ClonableMixin(c){constructor(i){super(i),this.field=null,this.order="ascending"}};e([o({type:String,json:{write:!0}})],J.prototype,"field",void 0),e([o({type:Q.apiValues,json:{type:Q.jsonValues,read:Q.read,write:Q.write}})],J.prototype,"order",void 0),J=e([p("esri.popup.support.AttachmentsOrderByInfo")],J);const ne=J;let b=class extends O.ClonableMixin(g){constructor(i){super(i),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};e([o({type:String,json:{write:!0}})],b.prototype,"description",void 0),e([o({type:["auto","preview","list"],json:{write:!0}})],b.prototype,"displayType",void 0),e([o({type:[ne],json:{write:!0}})],b.prototype,"orderByFields",void 0),e([o({type:String,json:{write:!0}})],b.prototype,"title",void 0),e([o({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],b.prototype,"type",void 0),b=e([p("esri.popup.content.AttachmentsContent")],b);const G=b;var at;let S=at=class extends g{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new at({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?I(this.outFields):null})}};e([o()],S.prototype,"creator",void 0),e([o()],S.prototype,"destroyer",void 0),e([o()],S.prototype,"outFields",void 0),e([o({type:["custom"],readOnly:!0})],S.prototype,"type",void 0),S=at=e([p("esri.popup.content.CustomContent")],S);const pe=S;var dt;let A=dt=class extends c{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new dt({title:this.title,expression:this.expression})}};e([o({type:String,json:{write:!0}})],A.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],A.prototype,"expression",void 0),e([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],A.prototype,"returnType",void 0),A=dt=e([p("esri.popup.ElementExpressionInfo")],A);const le=A;var ct;let L=ct=class extends g{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new ct({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};e([o({type:le,json:{write:!0}})],L.prototype,"expressionInfo",void 0),e([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],L.prototype,"type",void 0),L=ct=e([p("esri.popup.content.ExpressionContent")],L);const rt=L;let M=class extends O.ClonableMixin(c){constructor(i){super(i),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};e([Ot(Xt)],M.prototype,"dateFormat",void 0),e([o({type:Boolean,json:{write:!0}})],M.prototype,"digitSeparator",void 0),e([o({type:j,json:{write:!0}})],M.prototype,"places",void 0),M=e([p("esri.popup.support.FieldInfoFormat")],M);const ae=M;var ut;let y=ut=class extends c{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new ut({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};e([o({type:String,json:{write:!0}})],y.prototype,"fieldName",void 0),e([o({type:ae,json:{write:!0}})],y.prototype,"format",void 0),e([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],y.prototype,"isEditable",void 0),e([o({type:String,json:{write:!0}})],y.prototype,"label",void 0),e([Ot(new Jt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],y.prototype,"stringFieldOption",void 0),e([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],y.prototype,"statisticType",void 0),e([o({type:String,json:{write:!0}})],y.prototype,"tooltip",void 0),e([o({type:Boolean,json:{write:!0}})],y.prototype,"visible",void 0),y=ut=e([p("esri.popup.FieldInfo")],y);const Ut=y;var yt;let w=yt=class extends g{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,i){i.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new yt(I({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};e([o({type:Object,json:{write:!0}})],w.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],w.prototype,"description",void 0),e([o({type:[Ut]})],w.prototype,"fieldInfos",void 0),e([T("fieldInfos")],w.prototype,"writeFieldInfos",null),e([o({type:String,json:{write:!0}})],w.prototype,"title",void 0),e([o({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),w=yt=e([p("esri.popup.content.FieldsContent")],w);const K=w;let R=class extends c{constructor(i){super(i),this.altText=null,this.caption="",this.title="",this.type=null}};e([o({type:String,json:{write:!0}})],R.prototype,"altText",void 0),e([o({type:String,json:{write:!0}})],R.prototype,"caption",void 0),e([o({type:String,json:{write:!0}})],R.prototype,"title",void 0),e([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],R.prototype,"type",void 0),R=e([p("esri.popup.content.mixins.MediaInfo")],R);const At=R;var ht;let C=ht=class extends Lt{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new ht({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};e([o()],C.prototype,"color",void 0),e([o()],C.prototype,"fieldName",void 0),e([o()],C.prototype,"tooltip",void 0),e([o()],C.prototype,"value",void 0),C=ht=e([p("esri.popup.content.support.ChartMediaInfoValueSeries")],C);const de=C;var ft;let $=ft=class extends c{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new ft({colors:I(this.colors),fields:I(this.fields),normalizeField:this.normalizeField,series:I(this.series),tooltipField:this.tooltipField})}};e([o({type:[Ht],json:{type:[[j]],write:!0}})],$.prototype,"colors",void 0),e([o({type:[String],json:{write:{isRequired:!0}}})],$.prototype,"fields",void 0),e([o({type:String,json:{write:!0}})],$.prototype,"normalizeField",void 0),e([o({type:[de],json:{read:!1}})],$.prototype,"series",void 0),e([o({type:String,json:{write:!0}})],$.prototype,"tooltipField",void 0),$=ft=e([p("esri.popup.content.support.ChartMediaInfoValue")],$);const ce=$;let q=class extends At{constructor(i){super(i),this.type=null,this.value=void 0}};e([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],q.prototype,"type",void 0),e([o({type:ce,json:{write:{isRequired:!0}}})],q.prototype,"value",void 0),q=e([p("esri.popup.content.mixins.ChartMediaInfo")],q);const nt=q,pt=Yt()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var mt;let tt=mt=class extends nt{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new mt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:pt.write,isRequired:!0}}})],tt.prototype,"type",void 0),tt=mt=e([p("esri.popup.content.BarChartMediaInfo")],tt);const Pt=tt;var vt;let et=vt=class extends nt{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new vt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:pt.write,isRequired:!0}}})],et.prototype,"type",void 0),et=vt=e([p("esri.popup.content.ColumnChartMediaInfo")],et);const Wt=et;var wt;let U=wt=class extends c{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new wt({linkURL:this.linkURL,sourceURL:this.sourceURL})}};e([o({type:String,json:{write:!0}})],U.prototype,"linkURL",void 0),e([o({type:String,json:{write:{isRequired:!0}}})],U.prototype,"sourceURL",void 0),U=wt=e([p("esri.popup.content.support.ImageMediaInfoValue")],U);const ue=U;var xt;let E=xt=class extends At{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new xt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};e([o({type:Number,json:{write:!0}})],E.prototype,"refreshInterval",void 0),e([o({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],E.prototype,"type",void 0),e([o({type:ue,json:{write:{isRequired:!0}}})],E.prototype,"value",void 0),E=xt=e([p("esri.popup.content.ImageMediaInfo")],E);const Vt=E;var It;let it=It=class extends nt{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new It({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:pt.write,isRequired:!0}}})],it.prototype,"type",void 0),it=It=e([p("esri.popup.content.LineChartMediaInfo")],it);const zt=it;var gt;let ot=gt=class extends nt{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new gt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:pt.write,isRequired:!0}}})],ot.prototype,"type",void 0),ot=gt=e([p("esri.popup.content.PieChartMediaInfo")],ot);const Dt=ot,bt={base:At,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Pt,"column-chart":Wt,"line-chart":zt,"pie-chart":Dt,image:Vt}};var $t;let h=$t=class extends g{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(i=>i.type==="image"?Vt.fromJSON(i):i.type==="barchart"?Pt.fromJSON(i):i.type==="columnchart"?Wt.fromJSON(i):i.type==="linechart"?zt.fromJSON(i):i.type==="piechart"?Dt.fromJSON(i):void 0).filter(Boolean)}writeMediaInfos(t,i){i.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new $t(I({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};e([o()],h.prototype,"activeMediaInfoIndex",void 0),e([o({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],h.prototype,"description",void 0),e([o({types:[bt]})],h.prototype,"mediaInfos",void 0),e([qt("mediaInfos")],h.prototype,"readMediaInfos",null),e([T("mediaInfos")],h.prototype,"writeMediaInfos",null),e([o({type:String,json:{write:!0}})],h.prototype,"title",void 0),e([o({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],h.prototype,"type",void 0),h=$t=e([p("esri.popup.content.MediaContent")],h);const X=h;var Ft;let P=Ft=class extends c{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Ft({field:this.field,order:this.order})}};e([o({type:String,json:{write:!0}})],P.prototype,"field",void 0),e([o({type:["asc","desc"],json:{write:!0}})],P.prototype,"order",void 0),P=Ft=e([p("esri.popup.support.RelatedRecordsInfoFieldOrder")],P);const Gt=P;let m=class extends O.ClonableMixin(g){constructor(t){super(t),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};e([o({type:String,json:{write:!0}})],m.prototype,"description",void 0),e([o({type:Number,json:{type:j,write:!0}})],m.prototype,"displayCount",void 0),e([o({type:["list"],json:{write:{isRequired:!0}}})],m.prototype,"displayType",void 0),e([o({type:[Gt],json:{write:!0}})],m.prototype,"orderByFields",void 0),e([o({type:Number,json:{type:j,write:{isRequired:!0}}})],m.prototype,"relationshipId",void 0),e([o({type:String,json:{write:!0}})],m.prototype,"title",void 0),e([o({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],m.prototype,"type",void 0),m=e([p("esri.popup.content.RelationshipContent")],m);const H=m;var jt;let W=jt=class extends g{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new jt({text:this.text})}};e([o({type:String,json:{write:!0}})],W.prototype,"text",void 0),e([o({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],W.prototype,"type",void 0),W=jt=e([p("esri.popup.content.TextContent")],W);const Y=W;let x=class extends O.ClonableMixin(c){constructor(i){super(i),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};e([o({type:String,json:{write:!0}})],x.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],x.prototype,"description",void 0),e([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],x.prototype,"type",void 0),e([o({type:Number,json:{type:j,write:!0}})],x.prototype,"associatedNetworkSourceId",void 0),e([o({type:Number,json:{type:j,write:!0}})],x.prototype,"associatedAssetGroup",void 0),e([o({type:Number,json:{type:j,write:!0}})],x.prototype,"associatedAssetType",void 0),x=e([p("esri.popup.support.UtilityNetworkAssociationType")],x);const ye=x;let F=class extends O.ClonableMixin(g){constructor(i){super(i),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};e([o({type:String,json:{write:!0}})],F.prototype,"description",void 0),e([o({type:Number,json:{type:j,write:!0}})],F.prototype,"displayCount",void 0),e([o({type:String,json:{write:!0}})],F.prototype,"title",void 0),e([o({type:[ye],json:{write:!0}})],F.prototype,"associationTypes",void 0),e([Ot({utilityNetworkAssociations:"utility-network-associations"})],F.prototype,"type",void 0),F=e([p("esri.popup.content.UtilityNetworkAssociationsContent")],F);const Mt=F,he={base:null,key:"type",typeMap:{attachment:G,media:X,text:Y,expression:rt,field:K,relationship:H,utilityNetworkAssociations:Mt}},fe={base:null,key:"type",typeMap:{attachment:G,media:X,text:Y,expression:rt,field:K,relationship:H}};var Nt;let _=Nt=class extends c{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Nt({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([o({type:String,json:{write:!0}})],_.prototype,"name",void 0),e([o({type:String,json:{write:!0}})],_.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],_.prototype,"expression",void 0),e([o({type:["string","number"],json:{write:!0}})],_.prototype,"returnType",void 0),_=Nt=e([p("esri.popup.ExpressionInfo")],_);const me=_;var St;let V=St=class extends c{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new St({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};e([o({type:Boolean,json:{write:!0}})],V.prototype,"returnTopmostRaster",void 0),e([o({type:Boolean,json:{write:!0}})],V.prototype,"showNoDataRecords",void 0),V=St=e([p("esri.popup.LayerOptions")],V);const ve=V;var Rt;let z=Rt=class extends c{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Rt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?I(this.orderByFields):null})}};e([o({type:Boolean,json:{write:!0}})],z.prototype,"showRelatedRecords",void 0),e([o({type:[Gt],json:{write:!0}})],z.prototype,"orderByFields",void 0),z=Rt=e([p("esri.popup.RelatedRecordsInfo")],z);const Bt=z;var Ct;let u=Ct=class extends Qt.IdentifiableMixin(Lt){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Ct({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};e([o()],u.prototype,"active",void 0),e([o()],u.prototype,"className",void 0),e([o()],u.prototype,"disabled",void 0),e([o()],u.prototype,"icon",void 0),e([o()],u.prototype,"id",void 0),e([o()],u.prototype,"indicator",void 0),e([o()],u.prototype,"title",void 0),e([o()],u.prototype,"type",void 0),e([o()],u.prototype,"visible",void 0),u=Ct=e([p("esri.support.actions.ActionBase")],u);const Et=u;var _t;let st=_t=class extends Et{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new _t({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};e([o()],st.prototype,"image",void 0),st=_t=e([p("esri.support.actions.ActionButton")],st);const we=st;var Tt;let D=Tt=class extends Et{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Tt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};e([o()],D.prototype,"image",void 0),e([o()],D.prototype,"value",void 0),D=Tt=e([p("esri.support.actions.ActionToggle")],D);const xe=D,B="relationships/",kt="expression/",Ie=k.ofType({key:"type",defaultKeyValue:"button",base:Et,typeMap:{button:we,toggle:xe}}),ge={base:g,key:"type",typeMap:{media:X,custom:pe,text:Y,attachments:G,fields:K,expression:rt,relationship:H,utilityNetworkAssociations:Mt}},Kt=new Set(["attachments","fields","media","text","expression","relationship"]),be=new Set([...Kt,"utility-network-associations"]);let l=class extends O.ClonableMixin(c){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map(i=>Zt(ge,i)):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||te(t)?t:(ee.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(t,i,r,s){this._writePopupTemplateContent(t,i,s)}writeWebMapContent(t,i,r,s){this._writePopupTemplateContent(t,i,s)}writeFieldInfos(t,i,r,s){const{content:n}=this,d=Array.isArray(n)?n:null;if(t){const a=d?d.filter(f=>f.type==="fields"):[],v=a.length&&a.every(f=>{var N;return(N=f.fieldInfos)==null?void 0:N.length});i.fieldInfos=t.filter(Boolean).map(f=>{const N=f.toJSON(s);return v&&(N.visible=!1),N})}if(d)for(const a of d)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(t,i,r,s){i[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(s)}writeTitle(t,i){i.title=t||""}async collectRequiredFields(t,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(t,i,[...r,...this._getContentExpressionInfos(this.content,r)]),oe(t,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const i=new Set;return await this.collectRequiredFields(i,t),[...i].sort()}_writePopupTemplateContent(t,i,r){typeof t!="string"?Array.isArray(t)&&(i.popupElements=t.filter(s=>(r==null?void 0:r.origin)==="web-scene"?Kt.has(s.type):be.has(s.type)).map(s=>s==null?void 0:s.toJSON(r)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=t}_writeFieldsContent(t,i){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const r=I(t.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(d=>{var a,v;return((a=d.fieldName)==null?void 0:a.toLowerCase())===((v=s.fieldName)==null?void 0:v.toLowerCase())});n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,i){var n,d;const r=((n=t.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,t.relationshipId)))||[],s=[...((d=i.relatedRecordsInfo)==null?void 0:d.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(t,i){!i.description&&t.text&&(i.description=t.text)}_writeMediaContent(t,i){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=I(t.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(t,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),X.fromJSON(n)):n.type==="text"?(n.text||!t||s.description||(n.text=t,s.description=!0),Y.fromJSON(n)):n.type==="attachments"?G.fromJSON(n):n.type==="fields"?K.fromJSON(n):n.type==="expression"?rt.fromJSON(n):n.type==="relationship"?H.fromJSON(n):n.type==="utilityNetworkAssociations"?Mt.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(t){const{field:i,order:r}=t;if(!(i!=null&&i.startsWith(B)))return null;const s=i.replace(B,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),d=s[1];return!Number.isNaN(n)&&d?H.fromJSON({relationshipId:n,orderByFields:[{field:d,order:r}]}):null}_toFieldOrderJSON(t,i){const{order:r,field:s}=t;return{field:`${B}${i}/${s}`,order:r}}_readPopupInfo({description:t,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];t?n.push(new Y({text:t})):n.push(new K),Array.isArray(i)&&i.length&&n.push(X.fromJSON({mediaInfos:i})),r&&n.push(G.fromJSON({displayType:"auto"}));const{showRelatedRecords:d,orderByFields:a}=s;return d&&(a!=null&&a.length)&&a.forEach(v=>{const f=this._toRelationshipContent(v);f&&n.push(f)}),n.length?n:t}_getContentElementFields(t){const i=t==null?void 0:t.type;if(i==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(i==="custom")return t.outFields||[];if(i==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(i==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(t.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)]:[]}_getMediaInfoFields(t){const{caption:i,title:r,value:s}=t,n=s||{},{fields:d,normalizeField:a,tooltipField:v,sourceURL:f,linkURL:N}=n,lt=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(f),...this._extractFieldNames(N),...d??[]];return a&&lt.push(a),v&&lt.push(v),lt}_getContentExpressionInfos(t,i){return Array.isArray(t)?t.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(t,i,r){r&&await Promise.all(r.map(s=>se(t,i,s.expression)))}_getFieldInfoFields(t){return t?t.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(B)||i.startsWith(kt))).map(i=>i.fieldName):[]}_getActionsFields(t){return t?t.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(t){const{className:i,title:r,type:s}=t,n=s==="button"||s==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){return re(t).filter(i=>!(i.indexOf(B)===0||i.indexOf(kt)===0))}};e([o({type:Ie})],l.prototype,"actions",void 0),e([o()],l.prototype,"content",void 0),e([ie("content")],l.prototype,"castContent",null),e([qt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),e([T("web-scene","content",{popupElements:{type:k.ofType(fe)},showAttachments:{type:Boolean},mediaInfos:{type:k.ofType(bt)},description:{type:String},relatedRecordsInfo:{type:Bt}})],l.prototype,"writeWebSceneContent",null),e([T("content",{popupElements:{type:k.ofType(he)},showAttachments:{type:Boolean},mediaInfos:{type:k.ofType(bt)},description:{type:String},relatedRecordsInfo:{type:Bt}})],l.prototype,"writeWebMapContent",null),e([o({type:[me],json:{write:!0}})],l.prototype,"expressionInfos",void 0),e([o({type:[Ut]})],l.prototype,"fieldInfos",void 0),e([T("fieldInfos")],l.prototype,"writeFieldInfos",null),e([o({type:ve})],l.prototype,"layerOptions",void 0),e([T("layerOptions")],l.prototype,"writeLayerOptions",null),e([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),e([o()],l.prototype,"outFields",void 0),e([o()],l.prototype,"overwriteActions",void 0),e([o()],l.prototype,"returnGeometry",void 0),e([o({json:{type:String}})],l.prototype,"title",void 0),e([T("title")],l.prototype,"writeTitle",null),l=e([p("esri.PopupTemplate")],l);const Ae=l;export{X as I,G as a,Gt as b,ye as c,K as d,ne as e,Y as f,le as g,we as h,me as i,xe as j,Et as k,ae as m,Ut as n,de as p,Ae as q};
