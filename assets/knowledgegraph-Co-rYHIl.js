const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-CyCXuM9N.js","assets/Identifiable-_3rFZ1o6.js","assets/index-BEHHhRxI.js","assets/normalizeUtils-BS0bJnzn.js","assets/normalizeUtilsCommon-Ca72SEzL.js","assets/jsonUtils-Cc67rW5Z.js","assets/utils-C73sopP7.js","assets/utils-UVgDzRJn.js","assets/Field-Bopg3Spw.js","assets/fieldType-Pks4G8In.js","assets/networkEnums-BTp20v-Z.js","assets/FeatureSet-CZLo56w_.js","assets/Graphic-q_7OAYHf.js","assets/PopupTemplate-B09IYibB.js","assets/fieldUtils-z3GG2R-H.js","assets/typeUtils-mxDsOnhk.js","assets/createFeatureId-BiB9j2WD.js","assets/typeUtils-Buir9u-w.js","assets/SimpleMarkerSymbol-Drowg4jp.js","assets/screenUtils-aQeO9QTD.js","assets/aaBoundingBox-DNlIzH5i.js","assets/TextSymbol-keZwKiPd.js","assets/PictureMarkerSymbol-DlgeV3xL.js","assets/GPMessage-Ulmh_eIt.js","assets/GraphQueryStreaming-5OAzXB09.js"])))=>i.map(i=>d[i]);
import{_ as K}from"./index-BEHHhRxI.js";import{ax as k,a4 as P,ay as O,ao as V,al as T,cK as J}from"./Identifiable-_3rFZ1o6.js";import{t as M}from"./arcade-B0yac0nY.js";import{a as W,p as b,x as Q,q as D,j as A,i as B,y as E,z as C,A as L,E as z,H as q}from"./aiServices-C9Z_66ql.js";import{a as l,r as u}from"./enum-DaKdEk_o.js";import{l as H}from"./portalUtils-BVVdZdCx.js";import{k as U,K as X,O as Y}from"./projectionUtils-BdqPecQc.js";import Z from"./PortalItem-Dn4oT_Gd.js";import{p as $,n as tt}from"./project-_gWcbImb.js";import{s as rt,p as et,e as nt,i as at,a as it}from"./GraphQueryStreaming-5OAzXB09.js";import{l as y,o as x,i as F,m as ot}from"./fieldUtils-z3GG2R-H.js";import"./TimeOnly-YXxQ25V6.js";import"./UnknownTimeZone-CpPKXuRf.js";import"./jsonUtils-Cc67rW5Z.js";import"./featureConversionUtils-scwmf_ir.js";import"./aaBoundingBox-DNlIzH5i.js";import"./OptimizedFeature-C57xHwXW.js";import"./memoryEstimations-BG_NSMOj.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./createFeatureId-BiB9j2WD.js";import"./FieldsIndex-BTwzr3dJ.js";import"./timeZoneUtils-Cef7SfoB.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-CaVpMDBF.js";import"./Field-Bopg3Spw.js";import"./fieldType-Pks4G8In.js";import"./WhereClause-GH2HPADl.js";import"./unitConversion-C3XOdf9F.js";import"./number-CofdhOJW.js";import"./uuid-Cl5lrJ4c.js";import"./commonProperties-DHiB1uzW.js";import"./utils-C73sopP7.js";import"./utils-UVgDzRJn.js";let f=null;async function st(t){const r=V.geometryServiceUrl??"";if(!r){U()||await X();for(const e of t)e.container[e.indexer]=Y(e.container[e.indexer],T.WGS84);return}const n=t.map(e=>e.container[e.indexer]),i=new $({geometries:n,outSpatialReference:T.WGS84}),s=await tt(r,i);for(let e=0;e<s.length;e++){const a=t[e];a.container[a.indexer]=s[e]}}async function G(t,r){const n=new Z({portal:t,id:r});return await n.load(),f===null&&(f=await K(()=>import("./knowledgeGraphService-CyCXuM9N.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),await f.fetchKnowledgeGraph(n.url)}function R(t,r,n,i,s){if(t===null)return null;if(y(t)||F(t))return t;if(E(t)||E(t))return t.toJSDate();if(C(t))return t.toStorageFormat();if(L(t))return t.toStorageString();if(z(t)){const e={};for(const a of t.keys())e[a]=R(t.field(a),r,n,i,s),e[a]instanceof P&&s.push({container:e,indexer:a});return e}if(x(t)){const e=t.map(a=>R(a,r,n,i,s));for(let a=0;a<e.length;a++)e[a]instanceof P&&s.push({container:e,indexer:a});return e}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?O(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return J(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new l(r,u.WrongSpatialReference,null)}function v(t,r){if(!t)return null;const n={};for(const i in t)n[i]=h(t[i],r);return n}function h(t,r){return t===null?null:x(t)?t.map(n=>h(n,r)):t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,r)}:t instanceof nt?{graphType:"object",properties:v(t.properties,r)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,r)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(n=>h(n,r)):null}:q(t)?pt(t,r):y(t)||F(t)||ot(t)?t:null}function Mt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,n){return t.standardFunctionAsync(r,n,(i,s,e)=>{var m,d;if(W(e,2,2,r,n),e[0]===null)throw new l(r,u.PortalRequired,n);if(e[0]instanceof M){const c=b(e[1]);let g;return g=(m=r.services)!=null&&m.portal?r.services.portal:k.getDefault(),G(H(e[0],g),c)}if(y(e[0])===!1)throw new l(r,u.InvalidParameter,n);const a=b(e[0]);return G(((d=r.services)==null?void 0:d.portal)??k.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,n){return t.standardFunctionAsync(r,n,async(i,s,e)=>{var I;W(e,2,4,r,n);const a=e[0];if(!Q(a))throw new l(r,u.InvalidParameter,n);const m=e[1];if(!y(m))throw new l(r,u.InvalidParameter,n);f===null&&(f=await K(()=>import("./knowledgeGraphService-CyCXuM9N.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])));let d=null;const c=D(e[2],null);if(!(c instanceof A||c===null))throw new l(r,u.InvalidParameter,n);if(c){let o=[];d=R(c,!0,!1,r,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await st(o)}const g=D(e[3],!1),_=new rt({openCypherQuery:m,bindParameters:d,provenanceBehavior:g?"include":"exclude"});(((I=a==null?void 0:a.serviceDefinition)==null?void 0:I.currentVersion)??11.3)>11.2&&(_.outputSpatialReference=r.spatialReference);const N=(await f.executeQueryStreaming(a,_)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:o,value:p}=await N.read();if(o)break;if(x(p))for(const w of p)S.push(h(w,r));else{const w=[];for(const j of p)w.push(h(p[j],r));S.push(w)}}}catch(o){throw o}return A.convertJsonToArcade(S,B(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Mt as registerFunctions};
