import{x as E,l as d,a6 as $,f as v,aw as l,cQ as D,c as p,m as n,d as C}from"./Identifiable-_3rFZ1o6.js";import{t as A}from"./memoize-DmxaQ-k8.js";import{r as I}from"./fieldUtils-z3GG2R-H.js";import{y as x}from"./elevationInfoUtils-DRGp9Lv0.js";import{y as G}from"./hitTestSelectUtils-DuQI-drP.js";import{o as q,i as z}from"./queryEngineUtils-B2KqERg6.js";import{i as w,r as L,n as f}from"./symbologySnappingCandidates-DzOgE8Oy.js";import"./index-BEHHhRxI.js";import"./ElevationInfo-7Ug8ElGs.js";import"./lengthUtils-CrwfL9_h.js";import"./Cyclical-C1_PpBfH.js";import"./quantityUtils-CfVXs5z9.js";import"./vec2-ChnYg_BJ.js";import"./common-DQOJ18NT.js";import"./vec2f64-Cgb6qxNH.js";import"./vec32-soPbwaVZ.js";import"./projectVectorToVector-DAecJS5f.js";import"./projectionUtils-BdqPecQc.js";import"./projectPointToVector-BeChI4_x.js";import"./geodesicUtils-5UKmzzQW.js";import"./Layer--GugXUPW.js";import"./Query-Dp8boimB.js";import"./jsonUtils-Cc67rW5Z.js";import"./typeUtils-mxDsOnhk.js";import"./Field-Bopg3Spw.js";import"./fieldType-Pks4G8In.js";import"./MapView-DvC1rydD.js";import"./CollectionFlattener-kjXuGTXg.js";import"./workers-BcCT7nhd.js";import"./Queue-CJjQn74K.js";import"./intl-Beb5GWXc.js";import"./number-7p_O6jwX.js";import"./TileInfo-CvSYzqJL.js";import"./TileKey-DZd6gJy7.js";import"./jsxFactory-BbJVeaDA.js";import"./uuid-Cl5lrJ4c.js";import"./sanitizerUtils-CJlLEeXg.js";import"./UpdatingHandles-BZb3Zh99.js";import"./asyncUtils-CmphLL3n.js";import"./signal-R7pX2aet.js";import"./Map-BfsPAzzq.js";import"./Basemap-xdFWd_Ef.js";import"./loadAll-MI_JOpdU.js";import"./PortalItem-Dn4oT_Gd.js";import"./writeUtils-CFLt5Al1.js";import"./layerUtils-CFmFO8Du.js";import"./persistable-DdbzkEuJ.js";import"./MD5-C9MwAd2G.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-a1-4zqTB.js";import"./PolygonCollection-CMbOuNoO.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-CEszlm-2.js";import"./TablesMixin-DOSIq3qh.js";import"./GraphicsCollection-csXasQht.js";import"./Graphic-q_7OAYHf.js";import"./PopupTemplate-B09IYibB.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-Buir9u-w.js";import"./SimpleMarkerSymbol-Drowg4jp.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-DNlIzH5i.js";import"./TextSymbol-keZwKiPd.js";import"./PictureMarkerSymbol-DlgeV3xL.js";import"./HeightModelInfo-C8sA4bKM.js";import"./timeZoneUtils-Cef7SfoB.js";import"./ReactiveMap-DptZZMoQ.js";import"./ViewingMode-Chk7YAAL.js";import"./enums-NCSMZWP1.js";import"./TileKey-upwcIO5W.js";import"./quickselect-QQC62dOK.js";import"./normalizeUtils-BS0bJnzn.js";import"./normalizeUtilsCommon-Ca72SEzL.js";import"./utils-C73sopP7.js";import"./utils-UVgDzRJn.js";import"./mat3-CruJiiUv.js";import"./vec2f32-CaVKkSa6.js";import"./Scheduler-DH2YvKGe.js";import"./unitBezier-B1N-tmtC.js";import"./definitions-CASyCajO.js";import"./enums-UBzvFP7O.js";import"./Texture-BILrrMzS.js";import"./getDataTypeBytes-D2DiHx_d.js";import"./imageUtils-DN-q3Lg0.js";import"./capabilities-Cggz07g5.js";import"./ILyr3DWasmPerSceneView-CIC-HPGZ.js";import"./Version-BR-Ucixf.js";import"./vec42-CKs01hkn.js";import"./vec4f64-DPb6J-GU.js";import"./plane-BnjjlcHJ.js";import"./vectorStacks-Cflk7ctu.js";import"./mat3f64-B5o_lm6j.js";import"./mat4f64-q_b6UJoq.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-CxG2piVF.js";import"./spatialReferenceEllipsoidUtils-DTRGV_GU.js";import"./RouteLayerInteraction-DrsWX9Wp.js";import"./GraphicsLayer-BOJ0yOnh.js";import"./BlendLayer-DNv82dbV.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-CO8m00ps.js";import"./parser-BgHAYnRY.js";import"./ScaleRangeLayer-5c4AXGq9.js";import"./Stop-BpZ8Nuyu.js";import"./networkEnums-BTp20v-Z.js";import"./geodeticLengthOperator-BHayuOJB.js";import"./geodeticCurveType-CirnHLSB.js";import"./earcut-D9gy186-.js";import"./triangle-WIUNF1ZS.js";import"./lineSegment-Bl6I3b1d.js";import"./VertexSnappingCandidate-DFU1rXOs.js";import"./PointSnappingHint-B5UG77eq.js";import"./LRUCache-eBEVKbNU.js";import"./MemCache-CUhFgUMJ.js";let o=class extends E{get availability(){return 1}get _snappingElevationAligner(){const{view:t}=this,{layer:i}=this.layerSource,r=t!=null&&t.type==="3d";if(!r||i.type==="subtype-group")return w();const e=async(a,m)=>(await D(t.whenLayerView(i),m)).elevationAlignPointsInFeatures(a,m);return w(r,{elevationInfo:i.elevationInfo,alignPointsInFeatures:e})}get _snappingElevationFilter(){const{view:t}=this,i=t!=null&&t.type==="3d"&&this.layerSource.layer.type!=="subtype-group";return L(i)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:i}=this.layerSource;return t!=null&&t.type==="3d"&&i.type!=="subtype-group"?f(this._symbologySnappingSupported,async(r,e)=>{const a=await t.whenLayerView(i);return l(e),a.queryForSymbologySnapping({candidates:r,spatialReference:t.spatialReference},e)}):f()}get _layerView(){const{view:t}=this;if(t==null)return null;const{layer:i}=this.layerSource;return t.allLayerViews.find(r=>r.layer===i)}get _layerView3D(){const{view:t}=this;return t==null||t.type==="2d"?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:i}=this.layerSource;t!=null&&t.type==="3d"&&i.type!=="subtype-group"&&this.addHandles([t.elevationProvider.on("elevation-change",({context:r})=>{const{elevationInfo:e}=i;x(r,e)&&this._snappingElevationAligner.notifyElevationSourceChange()}),d(()=>i.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),v),d(()=>{var r;return this._layerView3D!=null?(r=this._layerView3D.layer)==null?void 0:r.renderer:null},()=>this._symbologySnappingFetcher.notifySymbologyChange(),v),$(()=>{var r;return(r=this._layerView3D)==null?void 0:r.layer},["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(t){super(t),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=A(z)}refresh(){}async fetchCandidates(t,i){var g,h;const{layer:r}=this.layerSource,{source:e}=r;if(!(e!=null&&e.querySnapping))return[];const a=r.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(a.where=I(a.where,(g=this._layerView.effectiveDisplayFilter)==null?void 0:g.where));const m="returnZ"in r?r.returnZ:void 0,y=G({parameters:t,mode:((h=this.view)==null?void 0:h.type)??"2d",returnZ:m,filter:a}),S=await e.querySnapping(y,{signal:i});l(i);const u=t.coordinateHelper.spatialReference,s=await this._snappingElevationAligner.alignCandidates(S.candidates,u,i);l(i);const c=await this._symbologySnappingFetcher.fetch(s,i);l(i);const _=c.length===0?s:[...s,...c],b=this._snappingElevationFilter.filter(y,_),V=this._memoizedMakeGetGroundElevation(this.view,u);return b.map(F=>q(F,V))}};p([n({constructOnly:!0})],o.prototype,"layerSource",void 0),p([n({constructOnly:!0})],o.prototype,"view",void 0),p([n()],o.prototype,"_snappingElevationAligner",null),p([n()],o.prototype,"_snappingElevationFilter",null),p([n()],o.prototype,"_symbologySnappingFetcher",null),p([n()],o.prototype,"_layerView",null),p([n()],o.prototype,"_layerView3D",null),p([n()],o.prototype,"_symbologySnappingSupported",null),o=p([C("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],o);export{o as FeatureCollectionSnappingSource};
