const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationQuery-DztAwnsA.js","assets/asyncUtils-zc5DpkIL.js","assets/Identifiable-BjM0PfdN.js","assets/index-CVvIVqY1.js","assets/projectionUtils-D3_kHwH-.js","assets/TileKey-DZd6gJy7.js","assets/layersCreator-DaJ77aWg.js","assets/loadUtils-CPYmfcOH.js","assets/fetchService-XJ2Pem8t.js","assets/layerUtils-CmDKJw7q.js","assets/associatedFeatureServiceUtils-Cmek22yM.js","assets/PortalItem-5OKFVWCx.js","assets/lazyLayerLoader-DJ-eBUUS.js","assets/portalLayers-BzlCS_J9.js","assets/portalItemUtils-CwGcUdPw.js","assets/styleUtils-DlzW0Ek2.js"])))=>i.map(i=>d[i]);
import{l as z,e as V,bC as H,c as o,bn as W,m as a,d as y,T as f,k as Q,V as $,b as K,i as _,u as L,bA as X,fr as Y,s as Z,aw as I,n as N,ab as ee,f4 as te,bi as C,em as re,aS as D,ad as x,cq as se,H as oe,ac as ae,fs as ie,bs as B,bJ as ne,x as le,cz as M}from"./Identifiable-BjM0PfdN.js";import{a as F,O as b}from"./Basemap-DEy_TBwO.js";import{_ as O}from"./index-CVvIVqY1.js";import{t as pe}from"./loadAll-tu8QdrIx.js";import{l as G}from"./CollectionFlattener-CiW0r4Pq.js";import{n as ue}from"./uuid-Cl5lrJ4c.js";import{v as de}from"./persistable-Dy9UTZKT.js";import{l as m}from"./PolygonCollection-CkOPuE2h.js";import{D as ye,N as ce}from"./layerUtils-CmDKJw7q.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-C8ai-EIY.js";import{l as he,a as me,t as fe}from"./TablesMixin-N_koq_xq.js";const g=new WeakMap;function U(e){return!e.destroyed&&(g.has(e)||e.addHandles([z(()=>{const t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||U(t))},t=>g.set(e,t),H),V(()=>g.delete(e))]),g.get(e))}var E;let v=E=class extends f{constructor(e){super(e),this.type="none"}clone(){return new E({type:this.type})}};o([W({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],v.prototype,"type",void 0),v=E=o([y("esri.ground.NavigationConstraint")],v);const ge=Symbol("GroundInstance");var R,j,J;let p=j=(J=class extends f.JSONSupportMixin(Q){constructor(e){super(e),this[R]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new $;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&_.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{K(e)||_.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)L(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",X(e,this._get("layers")))}writeLayers(e,t,s,r){const i=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(l=>{if("write"in l){const d={};Y(l)().write(d,r)&&i.push(d)}else r!=null&&r.messages&&r.messages.push(new Z("layer:unsupported",`Layers (${l.title}, ${l.id}) of type '${l.declaredClass}' cannot be persisted in the ground`,{layer:l}))})),t.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return pe(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await O(()=>import("./ElevationQuery-DztAwnsA.js"),__vite__mapDeps([0,1,2,3,4,5]));I(t);const r=new s,i=this.layers.filter(P).toArray();return r.queryAll(i,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await O(()=>import("./ElevationQuery-DztAwnsA.js"),__vite__mapDeps([0,1,2,3,4,5]));I(t);const r=new s,i=this.layers.filter(P).toArray();return r.createSamplerAll(i,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:N(this.surfaceColor),navigationConstraint:N(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new j({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const r=(t==null?void 0:t.origin)||"web-scene",i=(t==null?void 0:t.portal)||null,l=(t==null?void 0:t.url)||null,{populateOperationalLayers:d}=await O(async()=>{const{populateOperationalLayers:A}=await import("./layersCreator-DaJ77aWg.js");return{populateOperationalLayers:A}},__vite__mapDeps([6,2,3,7,8,9,10,11,12,13,14,4,15,1]));I(s);const c=[];if(e.layers&&Array.isArray(e.layers)){const A={context:{origin:r,url:l,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};c.push(d(this.layers,e.layers,A))}await Promise.allSettled(c)}},R=ge,J);function be(e){return e&&"createElevationSampler"in e}function P(e){return e.type==="elevation"||be(e)}o([a({json:{read:!1,write:{isRequired:!0}}})],p.prototype,"layers",null),o([ee("layers")],p.prototype,"writeLayers",null),o([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:C,read:{reader:te,source:"transparency"},write:{writer:(e,t)=>{t.transparency=re(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),o([a({type:D,json:{type:[C],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),o([a({type:v,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=j=o([y("esri.Ground")],p);const S=p;let w=class extends x.ClonableMixin(f){constructor(t){super(t),this.color=null}};o([a({type:D,json:{type:[C],write:!0}})],w.prototype,"color",void 0),w=o([y("esri.effects.FocusAreaOutline")],w);const ve=w;let u=class extends f.JSONSupportMixin(x){constructor(e){super(e),this.id=`focusarea-${ue()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new m}readGeometries(e,t,s){var r,i;Array.isArray(e)?this.geometries=m.fromJSON(e,s):(i=(r=s.hooks)==null?void 0:r.onAfterLoad)==null||i.call(r,()=>this._loadGeometries(se(e,s),s))}async _loadGeometries(e,t){const s=await oe(e,{responseType:"json"});this.geometries=m.fromJSON(s.data,t)}};o([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],u.prototype,"id",void 0),o([a({type:String,json:{write:!0}})],u.prototype,"title",void 0),o([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],u.prototype,"enabled",void 0),o([a({type:ve,json:{write:!0}})],u.prototype,"outline",void 0),o([a({type:m,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new m(e.items.map(t=>t.clone()))}),de({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],u.prototype,"geometries",void 0),o([ae(["web-scene","portal-item"],"geometries")],u.prototype,"readGeometries",null),u=o([y("esri.effects.FocusArea")],u);const we=u;let h=class extends f.JSONSupportMixin(x){constructor(e){super(e),this.areas=new $,this.style="bright"}};o([a({type:$.ofType(we),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new $(e.items.map(t=>t.clone()))})],h.prototype,"areas",void 0),o([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],h.prototype,"style",void 0),h=o([y("esri.effects.FocusAreas")],h);const k=h;function $e(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function _e(e){var t,s;return!(!$e(e)||!((s=(t=ye(e))==null?void 0:t.operations)!=null&&s.supportsEditing)||"editingEnabled"in e&&!ce(e)||U(e))}const T=()=>_.getLogger("esri.support.basemapUtils");function Le(){return{}}function Se(e){for(const t in e){const s=e[t];L(s),delete e[t]}}function Ae(e,t){let s;if(typeof e=="string"){const r=e in F,i=!r&&e.includes("/");if(!r&&!i){if(ie())T().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(F).filter(([d,c])=>c.classic||c.is3d).map(([d])=>`"${d}"`).sort().join(", ");T().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}t&&(s=t[e]),s||(s=r?b.fromId(e):new b({style:{id:e}}),t&&(t[e]=s))}else s=B(b,e);return s!=null&&s.destroyed&&(T().warn("The provided basemap is already destroyed",{basemap:s}),s=null),s}const q={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Ie(e){let t=null;if(typeof e=="string")if(e in q){const s=q[e];t=new S({resourceInfo:{data:{layers:[s]}}})}else _.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=B(S,e);return t}let n=class extends he(me(ne.EventedMixin(le))){constructor(e){super(e),this.allLayers=new G({getCollections:()=>{var t,s,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(s=this.ground)==null?void 0:s.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new k,this.allTables=fe(this),this.basemap=null,this.editableLayers=new G({getCollections:()=>[this.allLayers],itemFilterFunction:_e}),this.ground=new S,this._basemapCache=Le()}destroy(){Se(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=L(this.basemap),L(this.ground),this._set("ground",null)}castBasemap(e){return Ae(e,this._basemapCache)}castGround(e){return Ie(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};o([a({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),o([a({type:k,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],n.prototype,"focusAreas",void 0),o([a({readOnly:!0})],n.prototype,"allTables",void 0),o([a({type:b,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),o([M("basemap")],n.prototype,"castBasemap",null),o([a({readOnly:!0})],n.prototype,"editableLayers",void 0),o([a({type:S,nonNullable:!0})],n.prototype,"ground",void 0),o([M("ground")],n.prototype,"castGround",null),o([a()],n.prototype,"undoRedo",void 0),n=o([y("esri.Map")],n);const Oe=n,De=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{Oe as L,De as M,_e as e};
