import{f as l}from"./utils-C83x6Enz.js";import{I as f,H as c,Q as y,ct as s,a as S}from"./Identifiable-BjM0PfdN.js";import{v as R}from"./jsonUtils-DBuABSQZ.js";import{R as g}from"./normalizeUtils-DfEBCyY7.js";import{t as d}from"./query-DotrZ5xP.js";import{i as x}from"./AttributeBinsFeatureSet-CLHSYl_J.js";import J from"./AttributeBinsQuery-D8eeIdVU.js";import"./index-CVvIVqY1.js";import"./normalizeUtilsCommon-Bp_cDVNc.js";import"./utils-CFSOSud-.js";import"./pbfQueryUtils-h97YwSQw.js";import"./pbf-nAs1algh.js";import"./memoryEstimations-m6Z1UQ7X.js";import"./OptimizedFeature-DwEGrxrA.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-4dT8HLv_.js";import"./projectionUtils-D3_kHwH-.js";import"./Graphic-C2Bnzy89.js";import"./PopupTemplate-CF36_3mn.js";import"./fieldUtils-Br-fPSxS.js";import"./typeUtils-U-Zf11cK.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-CP9PJ8Sp.js";import"./SimpleMarkerSymbol-D-X_CJ8B.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-BrXqvn3i.js";import"./TextSymbol-DPyc43q3.js";import"./PictureMarkerSymbol-DOPylmLK.js";import"./FeatureSet-CfhGyZLm.js";import"./Field-FVkerAtx.js";import"./fieldType-ClovGbuQ.js";import"./queryUtils-BLXKDnEb.js";import"./json-Wa8cmqdu.js";import"./FixedIntervalBinParameters-DVaRdC5O.js";import"./NormalizationBinParametersMixin-Crnd6wMH.js";import"./Query-duJofNa2.js";import"./Layer-CUjb8Y3m.js";import"./timeZoneUtils-DMYcWBGI.js";function N(r){const i=r.geometry,e=r.toJSON(),t=e;let m,o,n;if(i!=null&&(o=i.spatialReference,n=s(o),t.geometryType=R(i),t.geometry=JSON.stringify(i),t.inSR=n),e.outSR?(t.outSR=s(e.outSR),m=r.outSpatialReference):i&&(t.outSR=t.inSR,m=o),t.bin&&(t.bin=JSON.stringify(t.bin)),t.quantizationParameters&&(t.quantizationParameters=JSON.stringify(t.quantizationParameters)),t.outStatistics&&(t.outStatistics=JSON.stringify(t.outStatistics)),t.outTimeReference&&(t.outTimeReference=JSON.stringify(t.outTimeReference)),e.timeExtent){const a=e.timeExtent,{start:p,end:u}=a;p==null&&u==null||(t.time=p===u?p:`${p??"null"},${u??"null"}`),delete e.timeExtent}return r.defaultSpatialReference&&S(o,m)&&(t.defaultSR=t.inSR,delete t.inSR,delete t.outSR),t}async function O(r,i,e){return i.timeExtent!=null&&i.timeExtent.isEmpty?{data:{features:[]}}:await q(r,i,e)}async function q(r,i,e={}){const t=typeof r=="string"?f(r):r,m=i.geometry?[i.geometry]:[],o=await g(m,null,{signal:e.signal}),n=o==null?void 0:o[0];n!=null&&((i=i.clone()).geometry=n);const a=d({...t.query,f:"json",...N(i)});return c(y(t.path,"queryBins"),{...e,query:{...a,...e.query}})}async function at(r,i,e){const{data:t}=await O(l(r),J.from(i),e);return x.fromJSON(t)}export{at as executeAttributeBinsQuery};
