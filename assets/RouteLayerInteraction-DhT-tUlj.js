const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-DvKjucvP.js","assets/Identifiable-B58w9FD1.js","assets/index-VFfT8Aji.js","assets/Cyclical-SUfr0Hlv.js","assets/quantityUtils-CebuAsVX.js","assets/elevationInfoUtils-BpDJq1uD.js","assets/ElevationInfo-0ccmO6of.js","assets/fieldUtils-5LubkA3t.js","assets/lengthUtils-DEvA7X52.js","assets/hitTestSelectUtils-ByTX4qSK.js","assets/vec2-ChnYg_BJ.js","assets/common-DQOJ18NT.js","assets/vec2f64-Cgb6qxNH.js","assets/vec32-BBi6eWk8.js","assets/projectVectorToVector-_cm4joq-.js","assets/projectionUtils-DsK_8mH5.js","assets/projectPointToVector-DXXhVA1_.js","assets/geodesicUtils-aAgfbhCp.js","assets/Layer-C63inyUN.js","assets/Query-B1Zd9wiX.js","assets/jsonUtils-rvWrjUVI.js","assets/typeUtils-BD6Rtzmx.js","assets/Field-BoWr0HZE.js","assets/fieldType-CgljAswg.js","assets/MapView-xTo1x6Jl.js","assets/CollectionFlattener-DpJZcuE9.js","assets/workers-BRuHQO5o.js","assets/Queue-CM5__kwh.js","assets/intl-BHHnlw1J.js","assets/number-kTr8sdcN.js","assets/TileInfo-D4DTS484.js","assets/TileKey-DZd6gJy7.js","assets/jsxFactory-MlcfH8Vy.js","assets/uuid-Cl5lrJ4c.js","assets/sanitizerUtils-CJlLEeXg.js","assets/jsxFactory-CQED0rIl.css","assets/UpdatingHandles-Lv1GUel8.js","assets/asyncUtils-C5b0g4Vr.js","assets/signal-Cxu9Z1Kf.js","assets/Map-BQwbVliJ.js","assets/Basemap-BLSYwfav.js","assets/loadAll-CbqpgDCk.js","assets/PortalItem-DLsR4Y2a.js","assets/writeUtils-Bje94ctQ.js","assets/layerUtils-CAMu1s-2.js","assets/persistable-glrbGfu8.js","assets/MD5-C9MwAd2G.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-CXue4rJ6.js","assets/PolygonCollection-DoAtzYfB.js","assets/mat4f32-Djp3mnm5.js","assets/mat4-CggL8WYf.js","assets/TablesMixin-CnCDLfmO.js","assets/GraphicsCollection-CixPPU0K.js","assets/Graphic-sBrqQAPW.js","assets/PopupTemplate-D_WeQBNh.js","assets/createFeatureId-BiB9j2WD.js","assets/typeUtils-Du36Z1Jr.js","assets/SimpleMarkerSymbol-B18xir4G.js","assets/screenUtils-aQeO9QTD.js","assets/aaBoundingBox-CGMzNzJN.js","assets/TextSymbol-C7i9ol-5.js","assets/PictureMarkerSymbol-D6pzvUP4.js","assets/HeightModelInfo-DBDBaZ2u.js","assets/timeZoneUtils-DlgpSZrP.js","assets/ReactiveMap-D39lG9XE.js","assets/ViewingMode-Chk7YAAL.js","assets/enums-oVqQqnoy.js","assets/TileKey-DZRgo92L.js","assets/quickselect-QQC62dOK.js","assets/normalizeUtils-DiYDtdl8.js","assets/normalizeUtilsCommon-BcGwSELE.js","assets/utils-DM3VuI_N.js","assets/utils-Kw6dbpdX.js","assets/mat3-CruJiiUv.js","assets/vec2f32-CaVKkSa6.js","assets/Scheduler-BH9l6DUT.js","assets/unitBezier-B1N-tmtC.js","assets/definitions-CASyCajO.js","assets/enums-UBzvFP7O.js","assets/Texture-BXXxnW90.js","assets/getDataTypeBytes-D2DiHx_d.js","assets/imageUtils-CcEg-3Il.js","assets/capabilities-Cggz07g5.js","assets/ILyr3DWasmPerSceneView-CIC-HPGZ.js","assets/Version-B0YYd6Ho.js","assets/vec42-CKs01hkn.js","assets/vec4f64-DPb6J-GU.js","assets/plane-C4pzHMdp.js","assets/vectorStacks-BEpDSRxH.js","assets/mat3f64-B5o_lm6j.js","assets/mat4f64-q_b6UJoq.js","assets/quatf64-aQ5IuZRd.js","assets/sphere-BTK9a7ED.js","assets/spatialReferenceEllipsoidUtils-U_tEFhD2.js","assets/GraphicsLayer-DiGOhhuQ.js","assets/BlendLayer-ZjS29wea.js","assets/layerContainerType-C5CzMsLd.js","assets/jsonUtils-DI0kf7Dd.js","assets/parser-NZ6dFu80.js","assets/ScaleRangeLayer-Ci7jgVw5.js","assets/Stop-BWzFXSEc.js","assets/networkEnums-BDHMASSX.js","assets/geodeticLengthOperator-DnIP1hCn.js","assets/geodeticCurveType-CirnHLSB.js","assets/earcut-D9gy186-.js","assets/triangle-BHW4KDad.js","assets/lineSegment-D4GoMluZ.js","assets/GridSnappingEngine-Bb3UpLk4.js","assets/scaleUtils-BWXUbMYz.js","assets/gridUtils-B4hG5oiH.js","assets/FeatureSnappingEngine-CJsXO0mQ.js","assets/FeatureFilter-7aTMY5PN.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/layerViewUtils-CVH0822Q.js","assets/geometryEngine-DmLTep7B.js","assets/geometryEngineBase-DXq9NeSb.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-DXPL5Iyu.js","assets/editingTools-B_CyEeXV.js","assets/SnappingVisualizer2D-CoTqNVcH.js","assets/enums-BPiq_WIC.js","assets/SnappingContext-nxy88D0G.js","assets/PointSnappingHint-fA1lX8jW.js","assets/SketchTooltipInfo-CHM4MolH.js","assets/MeshTransform-BB1siwsS.js","assets/quat-6eAYSpU3.js","assets/axisAngleDegrees-y-eEOVzV.js","assets/meshVertexSpaceUtils-Cr-dLKND.js","assets/MeshLocalVertexSpace-B7tSfOf6.js","assets/memoize-DmxaQ-k8.js","assets/unitFormatUtils-Dyl74NGg.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/editPlaneUtils-CoRWaKrT.js","assets/distanceOperator-ZFGMA3Wm.js","assets/Point2D-CvBsPtPg.js","assets/ProjectionTransformation-BD4yTSAC.js","assets/Envelope2D-Cq0k1qIA.js","assets/Transformation2D-BcN_JJet.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/apiConverter-BQ7vWD8W.js","assets/jsonConverter-RQ4yjUwR.js","assets/simplifyOperator-C_SpDb9t.js","assets/operatorSimplify-BQs_XLDL.js","assets/ReactiveSet-CP1VW2Yf.js","assets/diffUtils-jeIEfUBl.js","assets/hydratedFeatures-CorISFyG.js","assets/boundedPlane-Dr-8aQ9z.js","assets/cimSymbolUtils-CeKBuNur.js","assets/utils-BM8mKO1R.js","assets/defaultCIMValues-BrbaHf9c.js","assets/GraphicManipulator-F22WyD-Q.js","assets/defaults-CXADZSqg.js","assets/defaultsJSON-GKolV7NZ.js","assets/drapedUtils-DNFlom92.js","assets/colorUtils-eX73JdBW.js","assets/drawUtils-TP9BLkcf.js","assets/ImageMaterial.glsl-CYWjz5kI.js","assets/Octree-CU-i3hQj.js","assets/BufferView-w_XupivX.js","assets/RibbonLine.glsl-BLak7pjJ.js","assets/orientedBoundingBox-Cg5UnVHV.js","assets/computeTranslationToOriginAndRotation-DVvtmIB6.js","assets/OutputColorHighlightOID.glsl-B8E0aqsv.js","assets/videoUtils-DjYcH7eo.js","assets/requestImageUtils-BC5YUXYY.js","assets/basicInterfaces-CZwQPxTp.js","assets/TextureFormat-1mYWTFa-.js","assets/Indices-iFwTN7mA.js","assets/VertexAttribute-BfkzOMLV.js","assets/glsl-Cj7KC756.js","assets/BindType-BBwFZqyN.js","assets/ShaderOutput-Bdd80V3g.js","assets/renderState-vHoqBeQT.js","assets/InterleavedLayout-qXNTCLQ8.js","assets/types-BKo2foNY.js","assets/dehydratedFeatureUtils-6zrpJg_p.js","assets/vec3f32-WCVSSNPR.js","assets/floatRGBA-BQ7jCumf.js","assets/ShaderBuilder-Zhirjag-.js","assets/DefaultLayouts-DJyN_DIA.js","assets/triangulationUtils-BHAxaY85.js","assets/deduplicate-B3fK7HmU.js","assets/VertexElementDescriptor-BLyltQyJ.js","assets/ProgramTemplate-Aje1Ud3y.js","assets/memoryEstimations-ugfznLe2.js","assets/NestedMap-C3hRTnZR.js","assets/glUtil-DRNmC8Up.js","assets/HUDMaterial-BC_5MZsm.js","assets/SelectedVertexTooltipInfo-DOp2e3D7.js","assets/IntersectorType-gQim6TH1.js","assets/TranslateTooltipInfo-CyLNOuOZ.js","assets/utils-VkC7NvOP.js","assets/LRUCache-eBEVKbNU.js","assets/MemCache-CUhFgUMJ.js","assets/ExtentScaleTooltipInfo-vWgxC8Nn.js","assets/LineCallout.glsl-piK4PouU.js","assets/visualVariableUtils-CiMe3o6k.js","assets/dehydratedFeatures-0ecwCeN_.js","assets/UniqueValueRenderer-C3cUyoso.js","assets/commonProperties-CL8iWgtU.js","assets/colorRamps-BwV5NB8A.js","assets/ColorStop-DBTLRnqQ.js","assets/jsonUtils-BhRkbivh.js","assets/defaults3D-DzIVO-Cs.js","assets/RendererLegendOptions-Bp93r_aZ.js","assets/styleUtils-CnCv1b7N.js","assets/primitiveObjectSymbolUtils-CPQVfoGY.js","assets/edgeUtils-Brf9-Zxb.js","assets/NormalAttribute.glsl-DGftIWFY.js","assets/DefaultMaterial-CfaT9ngX.js","assets/OptimizedFeature-DFf7-Rrh.js","assets/optimizedFeatureQueryEngineAdapter-FcX9MQSS.js","assets/featureConversionUtils-De1fR0uF.js","assets/OptimizedFeatureSet-BR8EEvDc.js","assets/PooledRBush-BtNajwWz.js","assets/popupUtils-DRI08sKd.js","assets/LayerView-CflW_wQo.js","assets/Container-BtHpY2XJ.js","assets/GraphicMover-Y9COZpJw.js","assets/Box-DKvK7fV3.js","assets/settings-DzOE8_s6.js","assets/Reshape-4KsmODae.js","assets/symbolUtils-BEK-BE9H.js"])))=>i.map(i=>d[i]);
import{x as ye,V as j,c as l,m as h,d as N,i as Ke,cD as ht,c4 as dt,v as C,a as Xe,a1 as ut,bJ as Ge,l as V,bC as ne,U as yt,aw as me,dS as gt,fO as mt,d8 as vt,a6 as ke,u as q,g as ft,z as ve,aB as De,d$ as _t,fP as A,cN as Ie,s as bt,dw as $e,cQ as Et,cT as He,cE as wt,f as St}from"./Identifiable-B58w9FD1.js";import{h as Qe}from"./UpdatingHandles-Lv1GUel8.js";import Je from"./GraphicsLayer-DiGOhhuQ.js";import{h as Tt,d as Ot,S as Gt,b as Mt}from"./Stop-BWzFXSEc.js";import{_ as R}from"./index-VFfT8Aji.js";import{O as Te,Q as Rt,L as Pt,k as Ct,K as At}from"./projectionUtils-DsK_8mH5.js";import{g as kt,o as Dt,l as It,w as $t}from"./layerUtils-CAMu1s-2.js";import{a as Ht,d as Lt,x as Z}from"./typeUtils-Du36Z1Jr.js";import{u as Le,a as Ut,m as xt}from"./SimpleMarkerSymbol-B18xir4G.js";import{v as et,l as Vt,f as Nt,x as Ft,j as Oe}from"./elevationInfoUtils-BpDJq1uD.js";import{e as jt}from"./Map-BQwbVliJ.js";import{c as qt,_ as O,n as Ue,a as w}from"./MapView-xTo1x6Jl.js";import{p as ce,i as k,U as Bt,w as D,G as I,L as Yt,g as Zt,v as Wt,H as tt,m as at,x as zt,z as it,K as Kt,s as xe,O as Me,P as X,b as fe,Q as Ve,E as Xt,n as Qt,S as Jt,Z as ea,T as ta,V as aa,l as ot,W as ia,u as oa,X as sa,Y as ra,_ as na}from"./hitTestSelectUtils-ByTX4qSK.js";import{d as pa}from"./asyncUtils-C5b0g4Vr.js";import{c as la,u as ca,H as Q,I as ha,s as da,o as Ne,q as ua,j as ya}from"./vec32-BBi6eWk8.js";import{m as ga}from"./vec2-ChnYg_BJ.js";import{c as ma,f as va}from"./screenUtils-aQeO9QTD.js";import{e as fa,n as _a}from"./projectVectorToVector-_cm4joq-.js";import{a as ge,l as Re}from"./quantityUtils-CebuAsVX.js";import{m as ba,l as st}from"./geodeticLengthOperator-DnIP1hCn.js";import{q as Ea,b as wa,R as Sa,v as Ta}from"./geodesicUtils-aAgfbhCp.js";import{e as Oa}from"./earcut-D9gy186-.js";import{p as Ga,D as Ma,O as Ra,J as Pa}from"./plane-C4pzHMdp.js";import{v as Ca}from"./triangle-BHW4KDad.js";function Fe(e){switch(e){case _.SUPPORTED:break;case _.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case _.GEOMETRY_MISSING:return"no geometry";case _.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case _.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case _.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var _;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(_||(_={}));function Aa(e){var i,o;if(e.graphic&&((i=e.graphic.layer)==null?void 0:i.type)!=="graphics")return _.GRAPHICS_LAYER_MISSING;const t=(o=e.operations)==null?void 0:o.data.type;if(!t)return _.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const a=e.elevationInfo;return et(a)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function ka(e){return Da(e).result}function Da(e){var i;if(e.graphic&&((i=e.graphic.layer)==null?void 0:i.type)!=="graphics")return{result:_.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:_.GEOMETRY_MISSING};if(et(e.elevationInfo))return{result:_.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,a=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:_.SUPPORTED,geometry:a}:{result:_.GEOMETRY_TYPE_UNSUPPORTED}}function Ia(e){var a;if(((a=e.layer)==null?void 0:a.type)!=="graphics")return _.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return _.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return _.SUPPORTED;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(i=>i.type==="object")?_.SYMBOL_TYPE_UNSUPPORTED:Vt(e)!=="on-the-ground"&&Nt(e)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function je(e,t,a){if(!t||!(e!=null&&e.map))return;const{map:i}=e;i.layers.find(s=>s===t)||i.add(t,a)}function Wi(e,t){const a=(t==null?void 0:t.type)==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===a||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(a)})}function zi(e){return jt(e)||kt(e)||Dt(e)||It(e)}let $=class extends ye{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new j}};l([h({constructOnly:!0})],$.prototype,"layer",void 0),l([h()],$.prototype,"enabled",void 0),l([h()],$.prototype,"updating",void 0),l([h()],$.prototype,"availability",void 0),l([h()],$.prototype,"sublayerSources",void 0),$=l([N("esri.views.interactive.snapping.FeatureSnappingLayerSource")],$);let T=class extends ye{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new j,this.distance=ce.distance,this.touchSensitivityMultiplier=ce.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var c;const t=this.featureSources;t.some(qe)&&Ke.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const a=t.filter(Ha),i=((c=this._get("_effectiveFeatureSources"))==null?void 0:c.filter(qe))??new j;for(const n of a){const y=i.find(d=>d.layer===n.layer.parent);if(y)y.sublayerSources.includes(n)||y.sublayerSources.add(n);else if(n.layer.parent){const d=new $({layer:n.layer.parent});d.sublayerSources.add(n),i.add(d)}}for(const n of i){const y=n.sublayerSources.filter(d=>!a.includes(d));n.sublayerSources.removeMany(y)}i.removeMany(i.filter(n=>n.sublayerSources.length===0));const o=t.filter($a),s=this._get("_effectiveFeatureSources")??new j,{added:p,removed:r}=ht(s.toArray(),[...o,...i]);return s.removeMany(r),s.addMany(p),s}};function qe(e){return e.layer.type==="subtype-group"}function $a(e){return e.layer.type!=="subtype-group"}function Ha(e){return e.layer.type==="subtype-sublayer"}l([h()],T.prototype,"enabled",void 0),l([h()],T.prototype,"enabledToggled",void 0),l([h()],T.prototype,"forceDisabled",void 0),l([h()],T.prototype,"selfEnabled",void 0),l([h()],T.prototype,"featureEnabled",void 0),l([h()],T.prototype,"gridEnabled",void 0),l([h()],T.prototype,"attributeRulesEnabled",void 0),l([h({type:j.ofType($)})],T.prototype,"featureSources",void 0),l([h()],T.prototype,"distance",void 0),l([h()],T.prototype,"touchSensitivityMultiplier",void 0),l([h({readOnly:!0})],T.prototype,"effectiveEnabled",null),l([h({readOnly:!0})],T.prototype,"effectiveGridEnabled",null),l([h({readOnly:!0})],T.prototype,"effectiveSelfEnabled",null),l([h({readOnly:!0})],T.prototype,"effectiveFeatureEnabled",null),l([h({readOnly:!0})],T.prototype,"_effectiveFeatureSources",null),T=l([N("esri.views.interactive.snapping.SnappingOptions")],T);class Y{constructor(t,a,i,o){this.targetPoint=t,this.constraint=a,this.isDraped=i,this.domain=o}}let rt=class extends Y{constructor({targetPoint:t,objectId:a,constraint:i,isDraped:o}){super(t,i,o,k.FEATURE),this.objectId=a}},La=class extends rt{constructor(t){super({...t,isDraped:!0,constraint:new Bt(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new D(I.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ua=class extends rt{constructor(t){super({...t,constraint:new Yt(t.edgeStart,t.edgeEnd)})}get hints(){return[new D(I.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},pe=class extends Y{constructor(t,a,i,o){super(t,new Zt(t),o,k.ALL),this.first=a,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Wt(this.targetPoint,this.isDraped,this.domain)]}},xa=class extends Y{constructor({lineStart:t,lineEnd:a,targetPoint:i,isDraped:o}){super(i,new tt(t,a),o,k.SELF),this._referenceLineHint=new D(I.REFERENCE_EXTENSION,t,a,o,this.domain)}get hints(){return[this._referenceLineHint,new D(I.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Va=class extends Y{constructor({referenceLine:t,lineStart:a,targetPoint:i,isDraped:o}){const s=dt(a),{left:p,right:r}=t;la(s,ca(s,s,r),p),super(i,new tt(a,at(s)),o,k.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new D(I.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new zt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new D(I.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const a={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{Q(t.right,i.edge.left)&&(i.fadeLeft=!1,a.fadeRight=!1),Q(t.right,i.edge.right)&&(i.fadeRight=!1,a.fadeRight=!1),Q(t.left,i.edge.right)&&(i.fadeRight=!1,a.fadeLeft=!1),Q(t.left,i.edge.left)&&(i.fadeLeft=!1,a.fadeLeft=!1)}),this._referenceLines.push(a)}},Na=class extends Y{constructor({targetPoint:t,constraint:a,previousVertex:i,otherVertex:o,otherVertexType:s,isDraped:p,selfSnappingType:r,objectId:c,domain:n}){super(t,a,p,n??k.SELF),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=s,this.selfSnappingType=r??de.None,this.objectId=c??null}get hints(){const t=this.previousVertex,a=this.otherVertexType===he.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===he.CENTER?this.targetPoint:this.otherVertex;return[new D(I.TARGET,a,i,this.isDraped,this.domain),new D(I.REFERENCE,t,a,this.isDraped,this.domain),new it(this.previousVertex,a,i,this.isDraped,this.domain)]}};var he,de;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(he||(he={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(de||(de={}));let Fa=class extends Y{constructor({targetPoint:t,point1:a,point2:i,isDraped:o}){super(t,new Kt(at(ha(C(),a,i,.5)),.5*ga(xe(a),xe(i))),o,k.SELF),this._p1=a,this._p2=i}get hints(){return[new D(I.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new D(I.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new it(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function ja(e,t,a,i,o=C()){const s=da(qa,e);return s[2]=Ft(i,s,t,a)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const qa=C();function Ba(e,t,a,i){return i.type==="2d"?(J.x=e[0],J.y=e[1],J.spatialReference=t,i.toScreen(J)):(ja(e,t,a,i,Be),i.state.camera.projectToScreen(Be,_e),ma(_e[0],_e[1]))}const J=fa(0,0,0,null),Be=C(),_e=va();function Ya(e){const{spatialReference:t}=e;return Me(t,Xa,Qa,e)}function Za(e,t){if(!Xe(e.spatialReference,t.spatialReference))return null;const{spatialReference:a}=e;return ee[0]=e.x,ee[1]=e.y,ee[2]=e.hasZ?e.z:0,te[0]=t.x,te[1]=t.y,te[2]=t.hasZ?t.z:0,nt(ee,te,a)}function nt(e,t,a){return Me(a,za,Ka,e,t,a)}const Wa={geodesicLength:Ya,geodesicDistanceBetweenPoints:Za,geodesicDistance:nt};async function pt(){return await ba(),Wa}function za(e,t,a){return ge(Ea(ei,e,t,a).distance,"meters")}function Ka(e,t,a){return ge(st(Ja(e,t,a),{unit:"meters"}),"meters")}function Xa(e){return ge(Sa([e],"meters")[0],"meters")}function Qa(e){return ge(st(e,{unit:"meters"}),"meters")}function Ja(e,t,a){return new ut({spatialReference:a,paths:[[[...e],[...t]]]})}const ei=new wa,ee=C(),te=C();let P=class extends Ge.EventedMixin(ye){constructor(e){super(e),this.options=new T,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=H.MAIN}initialize(){this.addHandles([V(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:a,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:a,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{var a;t&&(this.doneSnapping(),this.emit("changed")),(a=this._loadTask)==null||a.abort(),this._loadTask=pa(i=>this._updateEngines(e,t,i))},ne),V(()=>this.options,e=>{for(const t of this._engines)t.options=e},yt)])}destroy(){var e;(e=this._loadTask)==null||e.abort(),this._destroyEngines()}get updating(){var e;return this._engines.some(t=>t.updating)||!((e=this._loadTask)!=null&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,a){var s;if(!e.viewReady)return void this._destroyEngines();(t==null?void 0:t.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(a):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(a):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(a):void 0]);if(a.aborted)for(const p of o)p.status==="fulfilled"&&((s=p.value)==null||s.engine.destroy());else{for(const p of o)p.status==="fulfilled"&&p.value&&i.set(p.value.type,p.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},a]=await Promise.all([R(()=>import("./SelfSnappingEngine-DvKjucvP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107])),pt()]);return me(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:a})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:a}=await R(()=>import("./GridSnappingEngine-Bb3UpLk4.js"),__vite__mapDeps([108,1,2,13,11,15,70,71,20,72,73,109,110,17,9,3,4,10,12,14,16,7,18,19,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,5,6,8,94,95,96,97,98,99,100,101,102,103,104,105,106,107]));return me(e),{type:"grid",engine:new a({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await R(()=>import("./FeatureSnappingEngine-CJsXO0mQ.js"),__vite__mapDeps([111,2,1,37,10,11,13,36,5,6,7,8,9,3,4,12,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,112,113,114,95,96,97,98,99,100,101,102,103,104,105,106,107]));me(e);const{view:a,options:i}=this,{spatialReference:o}=a;return{type:"feature",engine:new t({view:a,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,a=e*t;return a*a}snap(e){return ii(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:a}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=a,p=Te(o,s);if(p==null)return t;const{view:r}=this,{elevationInfo:c,visualizer:n}=a,y=[],d=X(p,r,c),u=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,u,a)||!Ee(i,a.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=fe(u),y.push(...i.hints);for(const m of this._currentOtherActiveCandidates)Ee(m,a.drawConstraints)&&(m.targetPoint=fe(u),y.push(...m.hints));return n!=null&&this.addHandles(n.draw(y,{spatialReference:s,elevationInfo:oi(a),view:r,selfSnappingZ:a.selfSnappingZ}),be),Ve(u,r,t,a)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case H.MAIN:return e;case H.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=H.MAIN}_removeVisualization(){this.removeHandles(be)}async _snapSinglePoint({point:e,context:t,signal:a}){const{view:i}=this,{elevationInfo:o}=t,s=X(e,i,o),p=await this._fetchCandidates(s,k.ALL,t,a);return this._createSnapResult(s,H.MAIN,p,i,e,t,a)}async _snapMultiPoint({point:e,scenePoint:t,context:a,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:p,spatialReference:r}=a;await Rt(t.spatialReference,r);const c=Te(t,r),n=X(c,o,p),y=await this._fetchCandidates(n,k.FEATURE,a,i);if(y.length>0){const m=await this._fetchCandidates(n,k.SELF,a,i);return this._createSnapResult(n,H.SCENE,[...y,...m],o,c,a,i)}const d=X(e,o,p),u=await this._fetchCandidates(d,k.SELF,a,i);return this._createSnapResult(d,H.MAIN,u,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},a,i)}async _fetchCandidates(e,t,a,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,a,i)))).flat()}_createSnapResult(e,t,a,i,o,s,p){return{get valid(){return!gt(p)},apply:()=>{const{spatialReference:r}=s,{snappedPoint:c,hints:n}=this._processCandidates(e,t,a,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(n,{spatialReference:r,elevationInfo:Oe,view:i,selfSnappingZ:s.selfSnappingZ}),be),Ve(c,i,o,s)}}}_processCandidates(e,t,a,i){if(a.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Xt(e,a);const o=this._currentMainCandidate;if(o!=null){const s=ai(o,a);if(s>=0){if(!(a[s]instanceof pe))return this._intersectWithOtherCandidates(s,a,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,a,i)}}return this._intersectWithOtherCandidates(0,a,e,t,i)}_intersectWithOtherCandidates(e,t,a,i,o){const{coordinateHelper:s}=o,p=t[e],r=[];for(let c=0;c<t.length;++c){if(c===e)continue;const n=t[c],y=p.constraint.intersect(n.constraint);if(y)for(const d of y.closestPoints(p.targetPoint))r.push([new pe(fe(d),p,n,n.isDraped),this._squaredScreenDistance(a,d,s)])}return r.length>0&&(r.sort((c,n)=>c[1]-n[1]),r[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(r[0][0],i,t,o):Ee(p,o.drawConstraints)?this._updateSnappingCandidate(p,i,t,o):{snappedPoint:a,hints:[]}}_updateSnappingCandidate(e,t,a,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const p of a){if(e instanceof pe){if(p.constraint.equals(e.first.constraint)||p.constraint.equals(e.second.constraint))continue}else if(p.constraint.equals(e.constraint))continue;const r=p.constraint.closestTo(o);this._squaredScreenDistance(r,o,i.coordinateHelper)<ti()&&(p.targetPoint=o,this._currentOtherActiveCandidates.push(p),s.push(...p.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,a){return this._squaredScreenDistance(e,t,a.coordinateHelper)<this._squaredPointProximityThreshold(a.pointer)}_squaredScreenDistance(e,t,a){return Qt(this._toScreen(e,a),this._toScreen(t,a))}_toScreen(e,t){return Ba(e,t.spatialReference,Oe,this.view)}get test(){}};var H;l([h({constructOnly:!0})],P.prototype,"view",void 0),l([h()],P.prototype,"options",void 0),l([h({readOnly:!0})],P.prototype,"updating",null),l([h()],P.prototype,"_loadTask",void 0),l([h()],P.prototype,"_engines",void 0),l([h()],P.prototype,"_squaredMouseProximityThreshold",null),l([h()],P.prototype,"_squaredTouchProximityThreshold",null),P=l([N("esri.views.interactive.snapping.SnappingManager")],P),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(H||(H={}));const be="visualization-handle";function ti(){return ce.satisfiesConstraintScreenThreshold*ce.satisfiesConstraintScreenThreshold}function Ee(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof La||e instanceof Ua||e instanceof xa||e instanceof Va||e instanceof Fa)&&(!(e instanceof Na)||t.direction==null&&e.selfSnappingType===de.LastVertex)}function ai(e,t){return e instanceof pe?we(t,e.first)>=0&&we(t,e.second)>=0?0:-1:we(t,e)}function we(e,t){let a=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){a=i;break}return a}function ii(e){return e.scenePoint!=null}function oi({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Oe:t}function si(e,t=ue()){return lt(e,t)}function ri(e,t=ue()){return lt(e,t,!1)}function lt(e,t,a=e.hasZ){const i=Jt(e.spatialReference),o=mt(i);if(o==null)return null;const s=(r,c)=>!(c.length<2)&&(Ne(r,c[0],c[1],a&&c[2]||0),!0);let p=0;for(const r of e.rings){const c=r.length;if(c<3)continue;const{positionsWorldCoords:n}=t;for(;n.length<c;)n.push(C());const y=ni,d=Ne(pi,0,0,0),u=1/c;for(let g=0;g<c;g++){if(!s(y,r[g])||!_a(y,e.spatialReference,n[g],i))return null;ua(d,d,n[g],u)}const m=Ga(n[0],n[1],d,Ma());if(ya(Ra(m))===0)continue;for(let g=0;g<c;g++)Pa(m,d,n[g],n[g]);const v=li(n);for(let g=0;g<v.length;g+=3)p+=Ca(n[v[g]],n[v[g+1]],n[v[g+2]])}return Re(p,o)}const ni=C(),pi=C();function ue(){return{positionsWorldCoords:[]}}function li(e){return Oa(ci(e),[],2)}function ci(e){const t=new Float64Array(2*e.length);for(let a=0;a<e.length;++a){const i=e[a],o=2*a;t[o]=i[0],t[o+1]=i[1]}return t}const hi=e=>({geodesicArea(t){const{spatialReference:a}=t;return Me(a,ui,i=>yi(e,i),t)}});async function di(){const e=await R(()=>import("./geometryEngine-DmLTep7B.js"),__vite__mapDeps([115,1,2,116,117,118]));return hi(e)}function ui(e){return Re(Math.abs(Ta([e],"square-meters")[0]),"square-meters")}function yi(e,t){try{return Re(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}const gi=e=>({autoAreaByElevationMode(t,a,i=ue()){if(a==="on-the-ground"){const o=e.geodesicArea(t);return o??ri(t,i)}return si(t,i)},autoArea2D(t,a=ue()){return this.autoAreaByElevationMode(t,"on-the-ground",a)}});let Se=null;async function ae(){return Se||(Se=gi(await di())),Se}function mi(e){return{autoLength2D:t=>e.geodesicLength(t)??aa(t),autoDistanceBetweenPoints2D:(t,a)=>e.geodesicDistanceBetweenPoints(t,a)??ta(t,a),autoDistance2D:(t,a,i)=>(W[0]=t[0],W[1]=t[1],W[2]=t.length===3?t[2]:0,z[0]=a[0],z[1]=a[1],z[2]=a.length===3?a[2]:0,e.geodesicDistance(W,z,i)??ea(W,z,i))}}async function F(){return mi(await pt())}const W=C(),z=C();let G=class extends Ge.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:vt(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var t;(t=this.activeComponent)==null||t.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};l([h()],G.prototype,"activeComponent",void 0),l([h()],G.prototype,"cancelled",void 0),l([h()],G.prototype,"history",void 0),l([h()],G.prototype,"tool",null),l([h()],G.prototype,"type",void 0),l([h()],G.prototype,"canUndo",null),l([h()],G.prototype,"canRedo",null),l([h()],G.prototype,"onEnd",void 0),l([h()],G.prototype,"undo",null),l([h()],G.prototype,"redo",null),l([h()],G.prototype,"toggleTool",void 0),l([h()],G.prototype,"addToSelection",void 0),l([h()],G.prototype,"removeFromSelection",void 0),G=l([N("esri.widgets.Sketch.support.OperationHandle")],G);let le=class extends G{};l([h()],le.prototype,"activeComponent",void 0),le=l([N("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],le);let L=class extends G{};l([h()],L.prototype,"activeComponent",void 0),L=l([N("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],L);function vi(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function fi(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var Ye;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(Ye||(Ye={}));const Ze={defaultZ:0},K={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:qt},tool:"transform"};let f=class extends Ge.EventedAccessor{constructor(e){var t;super(e),this._defaultSnappingManager=null,this._updatingHandles=new Qe,this._internalGraphicsLayer=new Je({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Le({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Ut({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new xt({color:[130,130,130,1],width:2}),this.meshSymbol=new Ht({symbolLayers:new j([new Lt])}),this.updateGraphics=new j,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Le({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new ot,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Ze,this.defaultUpdateOptions=K,this.snappingOptions=((t=e==null?void 0:e.snappingManager)==null?void 0:t.options)??(e==null?void 0:e.snappingOptions)??new T}initialize(){this.addHandles([ke(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.layers},"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),ke(()=>{var e;return(e=this.layer)==null?void 0:e.graphics},"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),V(()=>{var e;return((e=this.layer)==null?void 0:e.elevationInfo)??null},e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},ne),V(()=>this.view,e=>{this._defaultSnappingManager=q(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new P({view:e,options:this.snappingOptions})),e.type==="2d"?R(()=>import("./editingTools-B_CyEeXV.js"),__vite__mapDeps([119,1,2,54,55,7,20,21,56,57,58,59,60,61,62,120,10,11,12,121,9,3,4,13,14,15,16,17,18,19,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,5,6,8,94,122,123,124,125,126,127,128,129,130,131,132,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,107,149,150,151,152,153,154,155,156,157])):e.type==="3d"&&(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(t=>t.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155])),R(()=>import("./LineCallout.glsl-piK4PouU.js").then(t=>t.G),__vite__mapDeps([197,1,2,24,3,20,21,25,26,27,28,29,15,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,11,52,18,53,54,55,7,56,57,58,59,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,13,77,78,79,80,81,82,83,84,85,16,14,5,6,8,161,91,86,87,159,93,90,89,92,88,160,162,126,94,163,164,165,166,167,168,169,106,107,170,171,172,173,174,148,175,176,177,128,129,147,178,179,180,146,198,195,199,186,200,201,202,203,204,205,153,154,206,207,208,191,209,210,211,212,213,214,215,216,217,114,218,219,99]))))},ne),V(()=>{var e;return(e=this.view)==null?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ia(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=q(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){var e;return((e=this._operationHandle)==null?void 0:e.tool)??null}get activeCreateToolDrawMode(){var e;return((e=this._operationHandle)==null?void 0:e.type)==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,a=!t&&e&&"tooltip"in e?e.tooltip:null;return a!=null&&a.visible?a:null}get activeComponent(){var e;return((e=this._operationHandle)==null?void 0:e.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ze,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...K,...e,reshapeOptions:{...K.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...K.highlightOptions,...e==null?void 0:e.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e;return((e=this.snappingManager)==null?void 0:e.options)??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=q(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new P({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){var a;const e=!(!((a=this.view)!=null&&a.ready)||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&(t.cursor=null),o==null||o.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),e&&this.addHandles(ft(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},ne),a),this._set("view",e)}cancel(){this._moduleLoaderAbortController=ve(this._moduleLoaderAbortController),this._viewReadyAbortController=ve(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:a,layer:i}=this;if(!a||this.state==="disabled")throw i||this._logMissingLayer(),De();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");je(a,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void a.map.remove(this._internalGraphicsLayer);const s=()=>{var p;if(o===this._operationHandle){const r=this.createGraphic,c=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),(p=this.view)!=null&&p.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||r==null||i.add(r),this._sketchContinuationFlag=!1,this.emit("create",{graphic:r,state:c?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),c||this._sketchContinuationFlag)return;const{creationMode:n}=this;if(n==="continuous"){if(t!=null&&t.geometryToPlace)return;this._updatingHandles.addPromise(He(this.create(e,t)))}else n==="update"&&r&&this._updatingHandles.addPromise(He(this.update([r])))}};o.on("complete",s),this._operationHandle=o,a.ready&&a.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:i,state:o}=this;if(!i||o==="disabled")throw a||this._logMissingLayer(),De();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!(s!=null&&s.length))return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(r=>r.layer!==a?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const p=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||p==null||S(p)||(je(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(p,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:p.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||Xe(a.geometry.spatialReference,t.spatialReference)||(Pt(a.geometry.spatialReference,t.spatialReference)||Ct()||await At(),a.geometry=Te(a.geometry,t.spatialReference))}else this._logMissingView()}undo(){var e;this.canUndo()&&((e=this._operationHandle)==null||e.undo())}redo(){var e;this.canRedo()&&((e=this._operationHandle)==null||e.redo())}canUndo(){var e;return!!((e=this._operationHandle)!=null&&e.canUndo())}canRedo(){var e;return!!((e=this._operationHandle)!=null&&e.canRedo())}toggleUpdateTool(){var e;(e=this._operationHandle)==null||e.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(p=>{p.type!=="vector-tile"&&p.type!=="imagery"||o.push(p)});const s=await t.hitTest(e,{exclude:o});return oa(s.results)}const a=[t.map.ground];t.map.allLayers.forEach(o=>{$t(o.type)&&a.push(o)});const i=await t.hitTest(e,{exclude:a});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?_t(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{var i;const a=this.state==="active"&&((i=this._operationHandle)==null?void 0:i.type)==="create";this.state!=="disabled"&&!a&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},O.WIDGET)]}async _handleImmediateClick(e){var i;const t=await e.defer(()=>this._getFirstHit(Ue(e)));let a=null;if(t!=null){const o=t.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),a=o):((i=this.view)==null?void 0:i.type)!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const i={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,a,i);return o==null?null:(a.tools.add(o),a.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,a){var g;if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:p,graphicProperties:r,mode:c,preserveAspectRatio:n}=a,y=vi(c,e),d=fi(e),u=(g=a==null?void 0:a.optionsPerTool)!=null&&g.has(e)?a.optionsPerTool.get(e):{},m=(u==null?void 0:u.preserveAspectRatio)??n??e!=="rectangle",v={centered:e!=="rectangle"&&!(e==="circle"&&!m),cursor:i,defaultZ:o,forceUniformSize:m,graphicProperties:{...r,attributes:{...r==null?void 0:r.attributes}},geometryToPlace:p,geometryType:d,mode:y,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...u};return t.type==="2d"?this._makeDrawGraphicTool2D(v):this._makeDrawGraphicTool3D(v)}async _makeDrawGraphicTool2D(e){const[t,a,i]=await Promise.all([this._requireModule(R(()=>import("./editingTools-B_CyEeXV.js"),__vite__mapDeps([119,1,2,54,55,7,20,21,56,57,58,59,60,61,62,120,10,11,12,121,9,3,4,13,14,15,16,17,18,19,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,5,6,8,94,122,123,124,125,126,127,128,129,130,131,132,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,107,149,150,151,152,153,154,155,156,157]))),ae(),F()]);return S(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:bi(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(e){const[t,a,i]=await Promise.all([this._requireModule(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(s=>s.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155]))),ae(),F()]);if(S(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let a=null;const i=e.forceUniformSize,o=e.centered,s=[t.on("key-down",r=>{if(r.key===w.pan)r.stopPropagation(),r.repeat||(e.enabled=!1);else if(r.key===w.complete)r.stopPropagation(),e.completeCreateOperation();else if(r.key!==w.vertexAdd||r.repeat)r.key===w.undo?(r.stopPropagation(),p.undo()):r.key===w.redo?(r.stopPropagation(),p.redo()):r.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||r.repeat?r.key===w.center&&(r.repeat||(e.centered=!o,r.stopPropagation())):(e.forceUniformSize=!i,r.stopPropagation());else{const c=e.drawOperation.geometryType;c!=="polyline"&&c!=="polygon"&&c!=="multipoint"||(r.stopPropagation(),e.drawOperation.commitStagedVertex())}},O.WIDGET),t.on("key-up",r=>{r.key===w.pan?e.enabled=!0:r.key!==w.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?r.key===w.center&&(e.centered=o,r.stopPropagation()):(e.forceUniformSize=i,r.stopPropagation())},O.WIDGET),e.on("vertex-add",r=>{switch(a=a==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:a,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",r=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",r=>{this._set("createGraphic",r.graphic),a="complete",r.aborted?p&&p.cancel():p&&p.complete()}),V(()=>this._getGraphicSymbolFromTool(e.geometryType),r=>{e.graphicSymbol=r})],p=new le({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var r;A(s),(r=t.tools)==null||r.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){var p;const{layer:a,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t==null?void 0:t.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t==null?void 0:t.highlightOptions}};let s=o.tool??K.tool;for(const r of e)a.remove(r),a.add(r);if(i.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,o,i,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(s){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,o,i);case"transform":if(e.length===1){const r=(p=e[0].geometry)==null?void 0:p.type;r!=="point"&&r!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,o,i)}}async _setupMove3DOperation(e,t,a,i,o=!1){const[s,p]=await Promise.all([this._requireModule(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(v=>v.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155]))),F()]);if(S(s))return s;const{ManipulatedObject3DGraphic:r,MoveTool3D:c}=s.module,n=new Map,y=()=>{n.forEach(v=>v.destroy()),n.clear()};for(const v of e){const g=new r({view:a,graphic:v}),b=Aa(g);if(b!==_.SUPPORTED)return y(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Fe(b)}).`),null;n.set(v,g)}const d=new c({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:p});a.tools.add(d),d.objects.addMany(Array.from(n.values())),o||this.updateGraphics.addMany(e);const u=[],m=new L({activeComponent:d,tool:i,type:"update",onEnd:()=>{A(u),se(a,d),y()},undo:()=>{ze(this.view,d),ie(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:v=>{this.updateGraphics.push(v);const g=new r({view:a,graphic:v});n.set(v,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:v=>{const g=this.updateGraphics.indexOf(v);if(m.history.undo.forEach(M=>M.updates.splice(g,1)),m.history.redo.forEach(M=>M.updates.splice(g,1)),this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void m.complete();const b=n.get(v);b&&(d.objects.remove(b),b.destroy(),n.delete(v))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const v=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(v,t,a,!0);g&&!S(g)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(g,t))}});return u.push(...this._getHandlesForComponent(m,t),a.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(m,v,t),O.WIDGET),a.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(m,v)},O.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,a,i=!1){if(e.length===1&&Ia(e[0])===_.SUPPORTED){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,a);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,a,i)}return this._setupMove3DOperation(e,t,a,"transform",i)}async _setupPointTransform3DOperation(e,t,a){const i="transform",{enableRotation:o,enableScaling:s,enableZ:p}=t,r=await this._requireModule(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(v=>v.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155])));if(S(r))return r;const{TransformTool3D:c,ManipulatedObject3DGraphic:n}=r.module,y=new n({graphic:e,view:a}),d=new c({object:y,view:a,enableRotation:o,enableScaling:s,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(d),this.updateGraphics.add(e);const u=[],m=new L({activeComponent:d,tool:i,type:"update",onEnd:()=>{A(u),se(a,d),y.destroy()},undo:()=>{ze(this.view,d),ie(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async v=>{this.updateGraphics.add(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(g)||this._setUpdateOperationHandle(g,t)},removeFromSelection:v=>{this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),m.complete()},toggleTool:()=>{}});return u.push(...this._getHandlesForComponent(m,t),a.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(m,v,t),O.WIDGET),a.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(m,v)},O.WIDGET)),m}async _setupPolyTransform3DOperation(e,t,a,i=!1){var Pe,Ce;const o="transform",{enableRotation:s,enableScaling:p,enableZ:r,preserveAspectRatio:c}=t,[n,y]=await Promise.all([this._requireModule(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(E=>E.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155]))),F()]);if(S(n))return n;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:u}=n.module,m=(Ce=(Pe=this.view)==null?void 0:Pe.inputManager)==null?void 0:Ce.isModifierKeyDown(w.constraint),v=new d({view:a,graphic:e}),g=new u({object:v,view:a,enableRotation:s,enableScaling:p,enableZ:r,preserveAspectRatio:!!c!=!!m,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:y});a.tools.add(g),i||this.updateGraphics.add(e);const b=[],M=new L({activeComponent:g,tool:o,type:"update",onEnd:()=>{A(b),se(a,g),v.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async E=>{this.updateGraphics.add(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();const Ae=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(Ae)||this._setUpdateOperationHandle(Ae,t)},removeFromSelection:E=>{this.updateGraphics.remove(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[E],type:"selection-change"},type:"update"}),M.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const E=await this._setupReshape3DOperation(e,t,a,!0);E&&!S(E)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(E,t))}});return b.push(...this._getHandlesForComponent(M,t),a.on("immediate-click",E=>this._getCommonUpdateOperationClickHandlers(M,E,t),O.WIDGET),a.on("key-down",E=>this._getCommonUpdateOperationKeyDownHandlers(M,E),O.WIDGET),a.on("key-down",E=>{E.key!==w.constraint||E.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},O.WIDGET),a.on("key-up",E=>{E.key===w.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},O.WIDGET)),M}async _setupMove2DOperation(e,t,a){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,a);if(S(o))return o;const s=new L({activeComponent:o,tool:i,type:"update",onEnd:()=>{var n;this._displayDefaultCursor(),A(c),A(r),o.destroy(),(n=this._internalGraphicsLayer)==null||n.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();ie(s,n),s.refreshComponent(),this._emitUndoEvent({graphics:n,tool:i})},redo:()=>{const n=this.updateGraphics.toArray();oe(s,n),s.refreshComponent(),this._emitRedoEvent({graphics:n,tool:i})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const y=this.updateGraphics.indexOf(n);s.history.undo.forEach(u=>u.updates.splice(y,1)),s.history.redo.forEach(u=>u.updates.splice(y,1)),this.updateGraphics.remove(n);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=d:s.complete()}});let p=!1;const r=[a.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(s,n,t),O.WIDGET),a.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(s,n),n.key!==w.constraint||n.repeat||(p=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},O.WIDGET),a.on("key-up",n=>{n.key===w.constraint&&p&&(p=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},O.WIDGET)],c=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,a,i=!1){const o="reshape",[s,p,r]=await Promise.all([this._requireModule(R(()=>import("./ImageMaterial.glsl-CYWjz5kI.js").then(b=>b.e),__vite__mapDeps([158,1,2,156,86,11,87,13,5,6,7,8,59,28,29,37,124,4,125,51,91,126,90,92,127,128,129,24,3,20,21,25,26,27,15,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,50,52,18,53,54,55,56,57,58,60,61,62,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,130,131,132,9,14,16,17,88,89,93,94,159,160,107,161,162,163,164,165,166,167,168,169,106,170,171,172,173,174,148,175,176,177,147,178,179,180,181,182,105,183,184,185,186,187,188,189,122,123,190,133,95,96,97,98,99,100,134,135,136,137,138,139,140,141,142,143,144,145,146,191,192,193,149,150,151,121,194,195,196,152,153,154,155]))),ae(),F()]);if(S(s))return s;const{ManipulatedObject3DGraphic:c,ReshapeTool3D:n}=s.module,y=new c({view:a,graphic:e}),d=ka(y);if(d!==_.SUPPORTED)return y.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Fe(d)}).`),null;const u=t.reshapeOptions,m=new n({view:a,object:y,enableZVertex:t.enableZ&&(u==null?void 0:u.vertexOperation)==="move",enableZShape:t.enableZ&&(u==null?void 0:u.shapeOperation)==="move",enableMoveObject:(u==null?void 0:u.shapeOperation)==="move"||(u==null?void 0:u.shapeOperation)==="move-xy",enableMidpoints:(u==null?void 0:u.edgeOperation)==="split",enableEdgeOffset:(u==null?void 0:u.edgeOperation)==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:r});a.tools.add(m),i||this.updateGraphics.add(y.graphic);const v=[],g=new L({activeComponent:m,tool:o,type:"update",onEnd:()=>{A(v),se(a,m),y.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async b=>{this.updateGraphics.add(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[b],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const M=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);S(M)||this._setUpdateOperationHandle(M,t)},removeFromSelection:b=>{this.updateGraphics.remove(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[b],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;g.onEnd(),g.destroy();const b=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);S(b)||this._setUpdateOperationHandle(b,t)}});return v.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",b=>this._getCommonUpdateOperationClickHandlers(g,b,t),O.WIDGET),a.on("key-down",b=>{this._getCommonUpdateOperationKeyDownHandlers(g,b)},O.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,a,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,a,i):await this._getReshape(e,a,i);if(S(o))return o;const s=new L({activeComponent:o,type:"update",onEnd:()=>{A(r),A(p),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ie(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{oe(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async c=>{let n=s.activeComponent;if((n==null?void 0:n.type)==="reshape"){const y=[...this.updateGraphics,c];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const d=await this._setupTransformOrReshape2DOperation(y,"transform",a,i);if(S(d))return;this._setUpdateOperationHandle(d,a)}else this.updateGraphics.add(c),n.graphics=this.updateGraphics.toArray(),n.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async c=>{const n=this.updateGraphics.indexOf(c);s.history.undo.forEach(d=>d.updates.splice(n,1)),s.history.redo.forEach(d=>d.updates.splice(n,1)),this.updateGraphics.remove(c);const y=this.updateGraphics.toArray();if(y.length===0)s.complete();else{const d=y[0].geometry;y.length!==1||d==null||d.type!=="point"&&d.type!=="multipoint"?s.activeComponent.graphics=y:s.toggleTool()}this.emit("update",{graphics:y,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"})},toggleTool:async()=>{var d;if(this.updateGraphics.length>1)return;const c=this.updateGraphics.at(0),n=c.geometry;if(n!=null&&(s.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||s.tool==="transform"&&n.type==="extent"))return;let y=null;s.tool==="transform"?y=await this._getReshape([c],a,i):s.tool==="reshape"&&(y=await this._getBox([c],a,i)),S(y)||((d=s.activeComponent)==null||d.destroy(),s.activeComponent=y,s.activeComponent&&(A(r),r=this._getHandlesForComponent(s,a)))}}),p=[i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(s,c,a),O.WIDGET),i.on("key-down",c=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,c),c.key===w.constraint&&!c.repeat&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},O.WIDGET),i.on("key-up",c=>{if(c.key===w.constraint&&s){const n=s.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},O.WIDGET)];let r=this._getHandlesForComponent(s,a);return s}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(R(()=>import("./GraphicMover-Y9COZpJw.js").then(p=>p.G),__vite__mapDeps([220,1,2,95,53,54,55,7,20,21,56,57,58,59,60,61,62,18,96,97,98,99,50,51,11,100,6,8,157,24,3,25,26,27,28,29,15,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,13,77,78,79,80,81,82,83,84,85,114,152,16,5,153,154,155])));return S(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightName:o==null?void 0:o.name,highlightsEnabled:!!(o!=null&&o.enabled),indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:p,dy:r,graphic:c})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:c,type:"move-start"},type:"update"})},onGraphicMove:({dx:p,dy:r,graphic:c})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:c,type:"move"},type:"update"}),onGraphicMoveStop:({dx:p,dy:r,graphic:c})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:r,mover:c,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){var y,d;const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:p}=t,[r,c]=await Promise.all([this._requireModule(R(()=>import("./Box-DKvK7fV3.js"),__vite__mapDeps([221,1,2,54,55,7,20,21,56,57,58,59,60,61,62,4,157,220,95,53,18,96,97,98,99,50,51,11,100,6,8,24,3,25,26,27,28,29,15,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,63,64,65,19,22,23,66,10,12,67,68,69,70,71,72,73,74,75,76,13,77,78,79,80,81,82,83,84,85,114,152,16,5,153,154,155,222,9,14,17,86,87,88,89,90,91,92,93,94,124,125,126,127,128,129,130,131,132,196,192,101,102,103,104,105,106,107]))),F()]);if(S(r))return r;const n=(d=(y=this.view)==null?void 0:y.inputManager)==null?void 0:d.isModifierKeyDown(w.constraint);return new r.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightName:s==null?void 0:s.name,highlightsEnabled:!!(s!=null&&s.enabled),preserveAspectRatio:!!p!=!!n,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:c,callbacks:{onMoveStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:i,reshapeOptions:o}=t,s=(o==null?void 0:o.edgeOperation)==="split",p=(o==null?void 0:o.shapeOperation)==="move",[r,c,n]=await Promise.all([this._requireModule(R(()=>import("./Reshape-4KsmODae.js"),__vite__mapDeps([223,1,2,54,55,7,20,21,56,57,58,59,60,61,62,37,95,53,18,96,97,98,99,50,51,11,100,6,8,66,120,10,12,121,9,3,4,13,14,15,16,17,19,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,38,39,40,41,42,43,44,45,46,47,48,49,52,63,64,65,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,5,94,122,123,124,125,126,127,128,129,130,131,132,224,193,149,150,151,194,195,156,205,153,154,190,157,220,114,152,155,192,222,101,102,103,104,105,106,107]))),ae(),F()]);return S(r)?r:new r.module.default({enableMidpoints:s,enableMovement:p,graphic:e[0],highlightName:i==null?void 0:i.name,highlightsEnabled:!!(i!=null&&i.enabled),layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:n,view:a,callbacks:{onReshapeStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onReshape:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onReshapeStop:({mover:y,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:y,type:d},type:"update"}),onMoveStart:({dx:y,dy:d,mover:u,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:y,dy:d,mover:u,type:m},type:"update"}),onMove:({dx:y,dy:d,mover:u,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:y,dy:d,mover:u,type:m},type:"update"}),onMoveStop:({dx:y,dy:d,mover:u,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:y,dy:d,mover:u,type:m},type:"update"}),onVertexAdd:({added:y,type:d,vertices:u})=>{const m=y.map(v=>Ie(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:m,vertices:u,type:d},type:"update"})},onVertexRemove:({removed:y,type:d,vertices:u})=>{const m=y.map(v=>Ie(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:m,vertices:u,type:d},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:i,viewEvent:o})=>{var s;(s=o.native)!=null&&s.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))}),a.on("graphic-move-start",i=>e.addToHistory(U(i.allGraphics)))];case"box":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory(U(i.graphics))),a.on("rotate-start",i=>e.addToHistory(U(i.graphics))),a.on("scale-start",i=>e.addToHistory(U(i.graphics)))];case"reshape":return[a.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),a.on("move-start",i=>e.addToHistory(U([i.mover]))),a.on("reshape-start",i=>e.addToHistory(U([i.graphic]))),a.on("vertex-add",i=>e.addToHistory(U([i.oldGraphic]))),a.on("vertex-remove",i=>e.addToHistory(U([i.oldGraphic])))];case"move-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),a.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[a.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),a.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),a.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),a.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),a.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),a.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),a.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),a.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),a.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),a.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[a.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),a.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),a.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,a){var s;const{graphic:i,viewEvent:o}=a;return(s=o.native)!=null&&s.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){var o;this._operationHandle=e;const a=(o=this.view)==null?void 0:o.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const s=this.updateGraphics.toArray(),p=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:s,state:"complete",aborted:e.cancelled,tool:p,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,a){const i=Ue(t),o=await t.defer(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const i=!!a.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===w.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===w.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===w.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&w.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){var i;if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,a=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||a.length===1&&((i=a[0].geometry)==null?void 0:i.type)==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e,t;this._internalGraphicsLayer&&((t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=q(this._internalGraphicsLayer))}_isComponentGraphic(e){var a;const{activeComponent:t}=this;return!(!e||t==null)&&(((a=e.attributes)==null?void 0:a.esriSketchTool)||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,a){Ke.getLogger(this).error(new bt(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return $e(()=>!this.updating)}_disablePopupEnabled(e){var t;return((t=this.view)==null?void 0:t.type)!=="3d"||this.updateOnGraphicClick||((e==null?void 0:e.toggleToolOnClick)??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(ve(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Et($e(()=>e==null?void 0:e.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",We("view"))}_logMissingLayer(){this._logError(_i,We("layer"))}};l([h()],f.prototype,"_defaultSnappingManager",void 0),l([h()],f.prototype,"updating",null),l([h({readOnly:!0})],f.prototype,"_updatingHandles",void 0),l([h()],f.prototype,"_operationHandle",void 0),l([h({readOnly:!0})],f.prototype,"activeTool",null),l([h({readOnly:!0})],f.prototype,"activeCreateToolDrawMode",null),l([h()],f.prototype,"activeTooltip",null),l([h({types:Z})],f.prototype,"activeFillSymbol",void 0),l([h()],f.prototype,"activeLineSymbol",void 0),l([h()],f.prototype,"activeVertexSymbol",void 0),l([h()],f.prototype,"allowDeleteKey",void 0),l([h({readOnly:!0})],f.prototype,"createGraphic",null),l([h()],f.prototype,"defaultCreateOptions",null),l([h()],f.prototype,"defaultUpdateOptions",null),l([h({type:sa,nonNullable:!0})],f.prototype,"labelOptions",null),l([h()],f.prototype,"layer",void 0),l([h({types:Z})],f.prototype,"pointSymbol",void 0),l([h({types:Z})],f.prototype,"polygonSymbol",void 0),l([h({types:Z})],f.prototype,"polylineSymbol",void 0),l([h()],f.prototype,"meshSymbol",void 0),l([h({type:T,nonNullable:!0})],f.prototype,"snappingOptions",null),l([h()],f.prototype,"snappingManager",null),l([h({readOnly:!0})],f.prototype,"state",null),l([h({type:ra,nonNullable:!0})],f.prototype,"tooltipOptions",null),l([h({readOnly:!0})],f.prototype,"updateGraphics",void 0),l([h()],f.prototype,"updateOnGraphicClick",void 0),l([h()],f.prototype,"creationMode",void 0),l([h({type:na,nonNullable:!0})],f.prototype,"valueOptions",null),l([h({types:Z})],f.prototype,"vertexSymbol",void 0),l([h({value:null})],f.prototype,"view",null),l([h({constructOnly:!0,type:ot})],f.prototype,"sketchOptions",void 0),f=l([N("esri.widgets.Sketch.SketchViewModel")],f);const _i="sketch:missing-property",We=e=>`Property '${e}' is missing on SketchViewModel.`;function bi(e){return e==="polygon"||e==="rectangle"||e==="circle"}function ie(e,t){ct("undo",e.history.undo,e.history.redo,t)}function oe(e,t){ct("redo",e.history.redo,e.history.undo,t)}function ct(e,t,a,i){const o=t.pop();if(!o)return;const s=o.updates,p=[];i.forEach((r,c)=>{const n=s[c];n!=null&&("geometry"in n&&n.geometry!=null&&(p.push({geometry:r.geometry}),r.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(p.push({symbol:r.symbol}),r.symbol=n.symbol),"undo"in n&&(p.push(n),n[e](r)))}),a.push({updates:p})}function ze(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function U(e){return{updates:e.map(({geometry:t})=>(t==null?void 0:t.type)==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function se(e,t){var a;(a=e.tools)==null||a.remove(t),t.destroyed||t.destroy()}function S(e){return"requireError"in e&&e.requireError==="aborted"}function re(e,t){e.networkFeature=t}function Ei(e){const t=B(e.graphic);return{...e,networkFeature:t}}function wi(e){const t=e.graphics.map(a=>B(a));return{...e,networkFeatures:t}}function B(e){return e.networkFeature}function Si(e){return(e==null?void 0:e.type)==="point"||(e==null?void 0:e.type)==="polyline"||(e==null?void 0:e.type)==="polygon"}let x=class extends ye{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new Je({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new Qe,this.enabled=!0,this._handleSketchViewModelEvents=async t=>{var a,i;switch(t.type){case"update":switch(t.state){case"active":case"complete":for(const o of t.graphics)B(o).geometry=Si(o.geometry)?o.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const o of t.graphics){const s=B(o);this._removeNetworkFeature(s)}break;case"create":if(t.graphic&&t.state==="complete"&&this._createMode){const o=(a=t.graphic.geometry)==null?void 0:a.clone(),s=(i=t.graphic.symbol)==null?void 0:i.clone();if(!o)break;switch(this._createMode){case"stop":{if(o.type!=="point")break;const{stops:p}=this.layer;if(p.length>0&&p.every(({geometry:c})=>!c)){p.at(0).geometry=o;break}if(p.length>1&&p.filter((c,n)=>n!==0).every(({geometry:c})=>!c)){p.at(1).geometry=o;break}const r=new Mt({geometry:o});p.add(r),re(t.graphic,r);break}case"point-barrier":{if(o.type!=="point")break;const p=new Gt({geometry:o,symbol:s});this.layer.pointBarriers.add(p),re(t.graphic,p);break}case"polyline-barrier":{if(o.type!=="polyline")break;const p=new Ot({geometry:o,symbol:s});this.layer.polylineBarriers.add(p),re(t.graphic,p);break}case"polygon-barrier":{if(o.type!=="polygon")break;const p=new Tt({geometry:o,symbol:s});this.layer.polygonBarriers.add(p),re(t.graphic,p);break}}}}(await this.view.whenLayerView(this.layer)).emit(t.type,t.type==="create"?Ei(t):wi(t))}}initialize(){this._sketchViewModel=new f({layer:this._graphicsLayer,view:this.view}),this.addHandles([V(()=>this.enabled,e=>{e?this._activate():this._deactivate()},St),V(()=>{const{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:a,polygonBarriers:i}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),wt(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=q(this._graphicsLayer),this._sketchViewModel=q(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>B(e))}get updating(){return this._updatingHandles.updating}create(e){var t;switch(this._createMode=e,e){case"stop":(t=this.layer.defaultSymbols.stops)!=null&&t.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find(a=>B(a)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){var e;this._sketchViewModel.cancel(),(e=this.view.map)==null||e.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(t=>t.toArray().map(a=>{const i=a.toGraphic();return i.networkFeature=a,i}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};l([h()],x.prototype,"enabled",void 0),l([h({constructOnly:!0})],x.prototype,"layer",void 0),l([h({readOnly:!0})],x.prototype,"selectedNetworkFeatures",null),l([h()],x.prototype,"updating",null),l([h({constructOnly:!0})],x.prototype,"view",void 0),x=l([N("esri.views.2d.layers.support.RouteLayerInteraction")],x);const no=Object.freeze(Object.defineProperty({__proto__:null,get RouteLayerInteraction(){return x}},Symbol.toStringTag,{value:"Module"}));export{_ as P,no as R,pe as a,La as b,Ua as c,Na as d,zi as e,Fa as f,Va as g,Aa as h,ja as i,Wi as l,rt as n,he as o,de as p,xa as r,Ba as s,je as t};
