const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-BZ-ys-cY.js","assets/Identifiable-B58w9FD1.js","assets/index-VFfT8Aji.js","assets/normalizeUtils-DiYDtdl8.js","assets/normalizeUtilsCommon-BcGwSELE.js","assets/jsonUtils-rvWrjUVI.js","assets/utils-DM3VuI_N.js","assets/utils-Kw6dbpdX.js","assets/Field-BoWr0HZE.js","assets/fieldType-CgljAswg.js","assets/networkEnums-BDHMASSX.js","assets/FeatureSet-DrLo5FjM.js","assets/Graphic-sBrqQAPW.js","assets/PopupTemplate-D_WeQBNh.js","assets/fieldUtils-5LubkA3t.js","assets/typeUtils-BD6Rtzmx.js","assets/createFeatureId-BiB9j2WD.js","assets/typeUtils-Du36Z1Jr.js","assets/SimpleMarkerSymbol-B18xir4G.js","assets/screenUtils-aQeO9QTD.js","assets/aaBoundingBox-CGMzNzJN.js","assets/TextSymbol-C7i9ol-5.js","assets/PictureMarkerSymbol-D6pzvUP4.js","assets/GPMessage-COeWYNqA.js","assets/GraphQueryStreaming-C2UEcbT-.js"])))=>i.map(i=>d[i]);
import{_ as K}from"./index-VFfT8Aji.js";import{ax as k,a4 as P,ay as O,ao as V,al as T,cK as J}from"./Identifiable-B58w9FD1.js";import{t as M}from"./arcade-sqyTSvho.js";import{a as W,p as b,x as Q,q as D,j as A,i as B,y as E,z as C,A as L,E as z,H as q}from"./aiServices-D3YhcND9.js";import{a as l,r as u}from"./enum-CyvfDIjS.js";import{l as H}from"./portalUtils-D3mPxVh9.js";import{k as U,K as X,O as Y}from"./projectionUtils-DsK_8mH5.js";import Z from"./PortalItem-DLsR4Y2a.js";import{p as $,n as tt}from"./project-zdOedybu.js";import{s as rt,p as et,e as nt,i as at,a as it}from"./GraphQueryStreaming-C2UEcbT-.js";import{l as y,o as x,i as F,m as ot}from"./fieldUtils-5LubkA3t.js";import"./TimeOnly-CBUwkOTd.js";import"./UnknownTimeZone-BdyuEDG6.js";import"./jsonUtils-rvWrjUVI.js";import"./featureConversionUtils-De1fR0uF.js";import"./aaBoundingBox-CGMzNzJN.js";import"./OptimizedFeature-DFf7-Rrh.js";import"./memoryEstimations-ugfznLe2.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./createFeatureId-BiB9j2WD.js";import"./FieldsIndex-B99JmYLE.js";import"./timeZoneUtils-DlgpSZrP.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-f6vIbVtc.js";import"./Field-BoWr0HZE.js";import"./fieldType-CgljAswg.js";import"./WhereClause-B1FQrEXk.js";import"./unitConversion-N6CiRx2G.js";import"./number-DNm3QzCU.js";import"./uuid-Cl5lrJ4c.js";import"./commonProperties-DHiB1uzW.js";import"./utils-DM3VuI_N.js";import"./utils-Kw6dbpdX.js";let f=null;async function st(t){const r=V.geometryServiceUrl??"";if(!r){U()||await X();for(const e of t)e.container[e.indexer]=Y(e.container[e.indexer],T.WGS84);return}const n=t.map(e=>e.container[e.indexer]),i=new $({geometries:n,outSpatialReference:T.WGS84}),s=await tt(r,i);for(let e=0;e<s.length;e++){const a=t[e];a.container[a.indexer]=s[e]}}async function G(t,r){const n=new Z({portal:t,id:r});return await n.load(),f===null&&(f=await K(()=>import("./knowledgeGraphService-BZ-ys-cY.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),await f.fetchKnowledgeGraph(n.url)}function R(t,r,n,i,s){if(t===null)return null;if(y(t)||F(t))return t;if(E(t)||E(t))return t.toJSDate();if(C(t))return t.toStorageFormat();if(L(t))return t.toStorageString();if(z(t)){const e={};for(const a of t.keys())e[a]=R(t.field(a),r,n,i,s),e[a]instanceof P&&s.push({container:e,indexer:a});return e}if(x(t)){const e=t.map(a=>R(a,r,n,i,s));for(let a=0;a<e.length;a++)e[a]instanceof P&&s.push({container:e,indexer:a});return e}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?O(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return J(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new l(r,u.WrongSpatialReference,null)}function v(t,r){if(!t)return null;const n={};for(const i in t)n[i]=h(t[i],r);return n}function h(t,r){return t===null?null:x(t)?t.map(n=>h(n,r)):t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,r)}:t instanceof nt?{graphType:"object",properties:v(t.properties,r)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,r)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(n=>h(n,r)):null}:q(t)?pt(t,r):y(t)||F(t)||ot(t)?t:null}function Mt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,n){return t.standardFunctionAsync(r,n,(i,s,e)=>{var m,d;if(W(e,2,2,r,n),e[0]===null)throw new l(r,u.PortalRequired,n);if(e[0]instanceof M){const c=b(e[1]);let g;return g=(m=r.services)!=null&&m.portal?r.services.portal:k.getDefault(),G(H(e[0],g),c)}if(y(e[0])===!1)throw new l(r,u.InvalidParameter,n);const a=b(e[0]);return G(((d=r.services)==null?void 0:d.portal)??k.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,n){return t.standardFunctionAsync(r,n,async(i,s,e)=>{var I;W(e,2,4,r,n);const a=e[0];if(!Q(a))throw new l(r,u.InvalidParameter,n);const m=e[1];if(!y(m))throw new l(r,u.InvalidParameter,n);f===null&&(f=await K(()=>import("./knowledgeGraphService-BZ-ys-cY.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])));let d=null;const c=D(e[2],null);if(!(c instanceof A||c===null))throw new l(r,u.InvalidParameter,n);if(c){let o=[];d=R(c,!0,!1,r,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await st(o)}const g=D(e[3],!1),_=new rt({openCypherQuery:m,bindParameters:d,provenanceBehavior:g?"include":"exclude"});(((I=a==null?void 0:a.serviceDefinition)==null?void 0:I.currentVersion)??11.3)>11.2&&(_.outputSpatialReference=r.spatialReference);const N=(await f.executeQueryStreaming(a,_)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:o,value:p}=await N.read();if(o)break;if(x(p))for(const w of p)S.push(h(w,r));else{const w=[];for(const j of p)w.push(h(p[j],r));S.push(w)}}}catch(o){throw o}return A.convertJsonToArcade(S,B(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Mt as registerFunctions};
