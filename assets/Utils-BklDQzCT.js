import{dX as k,i as B,s as F}from"./Identifiable-B58w9FD1.js";import{O as h,X as E}from"./enums-UBzvFP7O.js";import{L as R}from"./definitions-CASyCajO.js";import{L as v}from"./enums-oVqQqnoy.js";import{r as H,n as O}from"./vec2f32-CaVKkSa6.js";import{s as z}from"./getDataTypeBytes-D2DiHx_d.js";import{t as X}from"./VertexElementDescriptor-BLyltQyJ.js";var l;let x=(l=class{constructor(t,r,n,i,s,a,o){this.instanceId=t,this.textureKey=r,this.indexStart=n,this.indexCount=i,this.vertexStart=s,this.vertexCount=a,this.overlaps=o}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new l(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,r,n,i,s,a,o,u){t.push(r),t.push(n),t.push(i),t.push(s),t.push(a),t.push(o),t.push(u)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const r=t.readInt32(),n=t.readInt32(),i=t.readInt32(),s=t.readInt32(),a=t.readInt32(),o=t.readInt32(),u=t.readInt32();return new l(r,n,i,s,a,o,u)}},l.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT,l);function N(e,t){if(t!==null){e.push(t.length);for(const r of t)r.serialize(e);return e}e.push(0)}function $(e,t,r){const n=e.readInt32(),i=new Array(n);for(let s=0;s<i.length;s++)i[s]=t.deserialize(e,r);return i}var d;let it=(d=class{constructor(t,r){this.id=t,this.sortKey=r,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),N(t,this.records),t}static deserialize(t){const r=t.readInt32(),n=t.readF32(),i=new d(r,n);return i.records=$(t,x)??[],i}},d.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+x.byteSizeHint,d),D=class T{constructor(t,r,n,i){this.transformedX=0,this.transformedY=0,this.center=H(t,r),this.centerT=O(),this.halfWidth=n/2,this.halfHeight=i/2,this.width=n,this.height=i}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new T(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,r=4){const n=Math.abs(t.centerT[0]-this.centerT[0]),i=Math.abs(t.centerT[1]-this.centerT[1]),s=(t.halfWidth+this.halfWidth+r)/n,a=(t.halfHeight+this.halfHeight+r)/i,o=Math.min(s,a);return Math.log2(o)}extend(t){const r=Math.min(this.xmin,t.xmin),n=Math.min(this.ymin,t.ymin),i=Math.max(this.xmax,t.xmax)-r,s=Math.max(this.ymax,t.ymax)-n,a=r+i/2,o=n+s/2;this.width=i,this.height=s,this.halfWidth=i/2,this.halfHeight=s/2,this.x=a,this.y=o}static deserialize(t){const r=t.readF32(),n=t.readF32(),i=t.readInt32(),s=t.readInt32();return new T(r,n,i,s)}};const M=new Float32Array(1),P=new Uint32Array(M.buffer);function G(e){return M[0]=e,P[0]}function st(e){return P[0]=e,M[0]}function at(e,t){return 65535&e|t<<16}function w(e){const t=G(e),r=t>>>31;let n=t>>>23&255,i=8388607&t;return n-=127,n>15?r<<15|31744:n<-25?0:(n<-14&&(i+=8388608,i/=2**(-14-n),n=-15),n+=15,i/=8192,i=V(i,1023),r<<15|n<<10|i)}function V(e,t){const r=Math.floor(e),n=e-r;return r<t&&(n>.5||n===.5&&r%2==1)?r+1:r}function b(e){let t=e>>>15,r=e>>10&31,n=1023&e;return t=t?-1:1,r-=15,n/=1024,r>-15?n+=1:r=-14,t*2**r*n}function ot(e){const t=e.map(({name:r,count:n,type:i})=>`${r}.${n}.${i}`).join(",");return k(t)}function f(e,t,r,n,i,s,a){if(e.primitiveName===t){let o=n==null?void 0:n.readWithDefault(i,s,e[r]&&a);return e.type==="text"&&(o=o.toString()),void(e[r]=o)}if("type"in e&&e.type!=null){if(e.effects)for(const o of e.effects)f(o,t,r,n,i,s,a);switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.symbolLayers)for(const o of e.symbolLayers)f(o,t,r,n,i,s,a);break;case"CIMTextSymbol":e.symbol&&f(e.symbol,t,r,n,i,s,a);break;case"CIMHatchFill":e.lineSymbol&&f(e.lineSymbol,t,r,n,i,s,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(e.markerPlacement&&f(e.markerPlacement,t,r,n,i,s,a),e.type==="CIMVectorMarker"&&e.markerGraphics)for(const o of e.markerGraphics)f(o,t,r,n,i,s,a),f(o.symbol,t,r,n,i,s,a)}}}const W=400;function ht(e){const t=Math.max(1.25*e.width,20);return e.effects!=null&&e.effects.length>0?W:t}function ct(e,t,r,n){const i=r.packPrecisionFactor??1;switch(r.type){case h.BYTE:if(r.count===1)e.setInt8(n+r.offset,t*i);else for(let s=0;s<r.count;s++){const a=s*Int8Array.BYTES_PER_ELEMENT;e.setInt8(n+r.offset+a,t[s]*i)}break;case h.UNSIGNED_BYTE:if(r.count===1)e.setUint8(n+r.offset,t*i);else for(let s=0;s<r.count;s++){const a=s*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(n+r.offset+a,t[s]*i)}break;case h.SHORT:if(r.count===1)e.setInt16(n+r.offset,t*i,!0);else for(let s=0;s<r.count;s++){const a=s*Int16Array.BYTES_PER_ELEMENT;e.setInt16(n+r.offset+a,t[s]*i,!0)}break;case h.UNSIGNED_SHORT:if(r.count===1)e.setUint16(n+r.offset,t*i,!0);else for(let s=0;s<r.count;s++){const a=s*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+r.offset+a,t[s]*i,!0)}break;case h.INT:if(r.count===1)e.setInt32(n+r.offset,t*i,!0);else for(let s=0;s<r.count;s++){const a=s*Int32Array.BYTES_PER_ELEMENT;e.setInt32(n+r.offset+a,t[s]*i,!0)}break;case h.UNSIGNED_INT:if(r.count===1)e.setUint32(n+r.offset,t*i,!0);else for(let s=0;s<r.count;s++){const a=s*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(n+r.offset+a,t[s]*i,!0)}break;case h.FLOAT:if(r.count===1)e.setFloat32(n+r.offset,t*i,!0);else for(let s=0;s<r.count;s++){const a=s*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(n+r.offset+a,t[s]*i,!0)}break;case h.HALF_FLOAT:if(r.count===1)e.setUint16(n+r.offset,w(t*i),!0);else for(let s=0;s<r.count;s++){const a=s*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+r.offset+a,w(t[s]*i),!0)}}}function ut(e,t,r){switch(t.type){case h.BYTE:{if(t.count===1)return e.getInt8(r+t.offset);const n=[];for(let i=0;i<t.count;i++){const s=i*Int8Array.BYTES_PER_ELEMENT;n.push(e.getInt8(r+t.offset+s))}return n}case h.UNSIGNED_BYTE:{if(t.count===1)return e.getUint8(r+t.offset);const n=[];for(let i=0;i<t.count;i++){const s=i*Uint8Array.BYTES_PER_ELEMENT;n.push(e.getUint8(r+t.offset+s))}return n}case h.SHORT:{if(t.count===1)return e.getInt16(r+t.offset,!0);const n=[];for(let i=0;i<t.count;i++){const s=i*Int16Array.BYTES_PER_ELEMENT;n.push(e.getInt16(r+t.offset+s,!0))}return n}case h.UNSIGNED_SHORT:{if(t.count===1)return e.getUint16(r+t.offset,!0);const n=[];for(let i=0;i<t.count;i++){const s=i*Uint16Array.BYTES_PER_ELEMENT;n.push(e.getUint16(r+t.offset+s,!0))}return n}case h.INT:{if(t.count===1)return e.getInt32(r+t.offset,!0);const n=[];for(let i=0;i<t.count;i++){const s=i*Int32Array.BYTES_PER_ELEMENT;n.push(e.getInt32(r+t.offset+s,!0))}return n}case h.UNSIGNED_INT:{if(t.count===1)return e.getUint32(r+t.offset,!0);const n=[];for(let i=0;i<t.count;i++){const s=i*Uint32Array.BYTES_PER_ELEMENT;n.push(e.getUint32(r+t.offset+s,!0))}return n}case h.FLOAT:{if(t.count===1)return e.getFloat32(r+t.offset,!0);const n=[];for(let i=0;i<t.count;i++){const s=i*Float32Array.BYTES_PER_ELEMENT;n.push(e.getFloat32(r+t.offset+s,!0))}return n}case h.HALF_FLOAT:{if(t.count===1)return b(e.getUint16(r+t.offset,!0));const n=[];for(let i=0;i<t.count;i++){const s=i*Uint16Array.BYTES_PER_ELEMENT;n.push(b(e.getUint16(r+t.offset+s,!0)))}return n}}}const _=2;let lt=class U{constructor(t,r,n,i,s,a,o,u,m,y,c,p=[],I=0,g=0){this.displayId=t,this.labelClassId=r,this.labelIdHash=n,this.hash=i,this.anchorX=s,this.anchorY=a,this.directionX=o,this.directionY=u,this.maxScale=m,this.minScale=y,this.referenceBounds=c,this.bounds=p,this.recordStart=I,this.recordCount=g,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(t){var r;if(!this._colliders){const n=t.attributeView,i=R;let s=((r=this.referenceBounds)==null?void 0:r.size)??0;const a=t.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(a!=null){const c=a(n.getVisualVariableData(this.displayId,v.SIZE));s=isNaN(c)||c==null||c===1/0?s:c}const o=this.minScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,u=this.maxScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,m=this.directionX*(i+s/2),y=this.directionY*(i+s/2);this._colliders=this.bounds.map(c=>({labelId:this.labelIdHash,xTile:this.anchorX,yTile:this.anchorY,dxPixels:c.x-c.halfWidth+m,dyPixels:c.y-c.halfHeight+y,hard:!0,partIndex:1,width:c.width+_,height:c.height+_,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:o,maxLod:u}))}return this._colliders}get id(){return this.displayId}serialize(t){t.push(this.displayId),t.push(this.labelClassId),t.push(this.labelIdHash),t.push(this.hash),t.push(this.recordStart),t.push(this.recordCount),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),this.referenceBounds?(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)):(t.writeF32(0),t.writeF32(0),t.writeF32(0)),N(t,this.bounds)}static deserialize(t){const r=t.readInt32(),n=t.readInt32(),i=t.readInt32(),s=t.readInt32(),a=t.readInt32(),o=t.readInt32(),u=t.readF32(),m=t.readF32(),y=t.readF32(),c=t.readF32(),p=t.readF32(),I=t.readF32(),g=t.readF32(),L=t.readF32(),Y=t.readF32(),C=$(t,D)??[];return new U(r,n,i,s,u,m,y,c,p,I,{size:g,offsetX:L,offsetY:Y},C,a,o)}};const A=()=>B.getLogger("esri.views.2d.engine.webgl.Utils");function ft(e){switch(e){case E.UNSIGNED_BYTE:return 1;case E.UNSIGNED_SHORT_4_4_4_4:return 2;case E.FLOAT:return 4;default:return void A().error(new F("webgl-utils",`Unable to handle type ${e}`))}}function dt(e){switch(e){case E.UNSIGNED_BYTE:return Uint8Array;case E.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case E.FLOAT:return Float32Array;default:return void A().error(new F("webgl-utils",`Unable to handle type ${e}`))}}function K(e){const t=new Map;for(const r in e){const n=e[r];let i=0;t.set(r,n.map(s=>{const a=new X(s.name,s.count,s.type,i,0,s.normalized||!1);return i+=s.count*z(s.type),a})),t.get(r).forEach(s=>s.stride=i)}return t}const Z=e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t},j=e=>{const t={};return e.forEach((r,n)=>t[n]=r!=null&&r.length?r[0].stride:0),t},S=new Map,Et=(e,t)=>{if(!S.has(e)){const r=K(t),n={strides:j(r),bufferLayouts:r,attributes:Z(t)};S.set(e,n)}return S.get(e)},mt=e=>e.includes("data:image/svg+xml");function yt(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}function pt(e){if(e==null)return"";const{type:t}=e;switch(t){case"CIMMarkerPlacementAlongLineRandomSize":return`${t}-${e.seed}-${e.randomization}`;case"CIMMarkerPlacementAlongLineVariableSize":return`${t}-${e.maxRandomOffset}-${e.numberOfSizes}-${e.seed}-${e.variationMethod}`;case"CIMMarkerPlacementAtExtremities":return`${t}-${e.extremityPlacement}-${e.offsetAlongLine}`;case"CIMMarkerPlacementAtRatioPositions":return`${t}-${e.beginPosition}-${e.endPosition}-${e.flipFirst}-${JSON.stringify(e.positionArray)}`;case"CIMMarkerPlacementAtMeasuredUnits":return`${t}-${e.interval}-${e.skipMarkerRate}-${e.placeAtExtremities}`;case"CIMMarkerPlacementInsidePolygon":return`${t}-${e.stepX}-${e.stepY}-${e.randomness}-${e.gridType}-${e.seed}-${e.shiftOddRows}`;case"CIMMarkerPlacementOnLine":return`${t}-${e.relativeTo}-${e.startPointOffset}`;case"CIMMarkerPlacementOnVertices":return`${t}-${e.placeOnControlPoints}-${e.placeOnEndPoints}-${e.placeOnRegularVertices}`;case"CIMMarkerPlacementPolygonCenter":return`${t}-${e.method}`;default:return`${t}`}}export{Et as $,lt as a,D as b,x as c,G as d,ut as e,at as f,ct as g,st as h,dt as i,ht as j,yt as k,mt as l,$ as n,ft as o,pt as p,f as r,it as s,ot as t};
