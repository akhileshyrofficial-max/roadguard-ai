import{c as q,a as w}from"./devEnvironmentUtils-CnNDiFMM.js";import{ax as D,I as y,s as c,cq as S,d9 as $}from"./Identifiable-B58w9FD1.js";import{u as v}from"./jsonUtils-BhRkbivh.js";import{S as A,h as N,l as U}from"./typeUtils-Du36Z1Jr.js";import{p as F,m as O,i as C,y as M,h as R}from"./styleUtils-CnCv1b7N.js";import"./index-VFfT8Aji.js";import"./layerUtils-CAMu1s-2.js";import"./PictureMarkerSymbol-D6pzvUP4.js";import"./screenUtils-aQeO9QTD.js";import"./SimpleMarkerSymbol-B18xir4G.js";import"./TextSymbol-C7i9ol-5.js";import"./defaults3D-DzIVO-Cs.js";import"./defaults-CXADZSqg.js";import"./defaultsJSON-GKolV7NZ.js";import"./fieldUtils-5LubkA3t.js";import"./aaBoundingBox-CGMzNzJN.js";const W=["web-gltf","web","cim"];function rt(e,t,o){const l=e.name;return l==null?Promise.reject(new c("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName==="Esri2DPointSymbolsStyle"?B(l,t,o):C(e,t,o).then(r=>z(r,l,t,M,o))}function k(e,t){return t.items.find(o=>o.name===e)}async function z(e,t,o,l,r){var h,g;const n=(o==null?void 0:o.portal)!=null?o.portal:D.getDefault(),m={portal:n,url:y(e.baseUrl)},s=k(t,e.data);if(!s)throw new c("symbolstyleutils:symbol-name-not-found",`The symbol name '${t}' could not be found`,{symbolName:t});const u=(r==null?void 0:r.acceptedFormats)??W,b=l(s,u);if(!b)throw new c("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${t}' does not have an accepted format (one of ${u})`,{symbolName:t});const{url:P,format:T}=b;let i=S(P,m),p=((h=s.thumbnail)==null?void 0:h.href)??null;const f=(g=s.thumbnail)==null?void 0:g.imageData;q()&&(i=w(i)??"",p=w(p));const x={portal:n,url:y($(i)),origin:"portal-item"};return F(i,r).then(d=>{const E=T==="cim"?O(d.data):d.data,a=v(E,x);if(a&&A(a)){if(p){const I=S(p,m);a.thumbnail=new N({url:I})}else f&&(a.thumbnail=new N({url:`data:image/png;base64,${f}`}));e.styleUrl?a.styleOrigin=new U({portal:o.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(a.styleOrigin=new U({portal:o.portal,styleName:e.styleName,name:t}))}return a})}function B(e,t,o){const l=R.replaceAll(/\{SymbolName\}/gi,e),r=t.portal!=null?t.portal:D.getDefault();return F(l,o).then(n=>{const m=O(n.data);return v(m,{portal:r,url:y($(l)),origin:"portal-item"})})}export{z as fetchSymbolFromStyle,k as getStyleItemFromStyle,rt as resolveWebStyleSymbol};
