import{f as l}from"./utils-C73sopP7.js";import{I as f,H as c,Q as y,ct as s,a as S}from"./Identifiable-_3rFZ1o6.js";import{v as R}from"./jsonUtils-Cc67rW5Z.js";import{R as g}from"./normalizeUtils-BS0bJnzn.js";import{t as d}from"./query-BK4ukVuP.js";import{i as x}from"./AttributeBinsFeatureSet-CHA21y0Q.js";import J from"./AttributeBinsQuery-30UZm1jY.js";import"./index-BEHHhRxI.js";import"./normalizeUtilsCommon-Ca72SEzL.js";import"./utils-UVgDzRJn.js";import"./pbfQueryUtils-G12Ca3sG.js";import"./pbf-CS5_6Vtc.js";import"./memoryEstimations-BG_NSMOj.js";import"./OptimizedFeature-C57xHwXW.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-yLGROW-s.js";import"./projectionUtils-BdqPecQc.js";import"./Graphic-q_7OAYHf.js";import"./PopupTemplate-B09IYibB.js";import"./fieldUtils-z3GG2R-H.js";import"./typeUtils-mxDsOnhk.js";import"./createFeatureId-BiB9j2WD.js";import"./typeUtils-Buir9u-w.js";import"./SimpleMarkerSymbol-Drowg4jp.js";import"./screenUtils-aQeO9QTD.js";import"./aaBoundingBox-DNlIzH5i.js";import"./TextSymbol-keZwKiPd.js";import"./PictureMarkerSymbol-DlgeV3xL.js";import"./FeatureSet-CZLo56w_.js";import"./Field-Bopg3Spw.js";import"./fieldType-Pks4G8In.js";import"./queryUtils-Cag0ceeo.js";import"./json-Wa8cmqdu.js";import"./FixedIntervalBinParameters-CqHG-zwl.js";import"./NormalizationBinParametersMixin-DdJue4AE.js";import"./Query-Dp8boimB.js";import"./Layer--GugXUPW.js";import"./timeZoneUtils-Cef7SfoB.js";function N(r){const i=r.geometry,e=r.toJSON(),t=e;let m,o,n;if(i!=null&&(o=i.spatialReference,n=s(o),t.geometryType=R(i),t.geometry=JSON.stringify(i),t.inSR=n),e.outSR?(t.outSR=s(e.outSR),m=r.outSpatialReference):i&&(t.outSR=t.inSR,m=o),t.bin&&(t.bin=JSON.stringify(t.bin)),t.quantizationParameters&&(t.quantizationParameters=JSON.stringify(t.quantizationParameters)),t.outStatistics&&(t.outStatistics=JSON.stringify(t.outStatistics)),t.outTimeReference&&(t.outTimeReference=JSON.stringify(t.outTimeReference)),e.timeExtent){const a=e.timeExtent,{start:p,end:u}=a;p==null&&u==null||(t.time=p===u?p:`${p??"null"},${u??"null"}`),delete e.timeExtent}return r.defaultSpatialReference&&S(o,m)&&(t.defaultSR=t.inSR,delete t.inSR,delete t.outSR),t}async function O(r,i,e){return i.timeExtent!=null&&i.timeExtent.isEmpty?{data:{features:[]}}:await q(r,i,e)}async function q(r,i,e={}){const t=typeof r=="string"?f(r):r,m=i.geometry?[i.geometry]:[],o=await g(m,null,{signal:e.signal}),n=o==null?void 0:o[0];n!=null&&((i=i.clone()).geometry=n);const a=d({...t.query,f:"json",...N(i)});return c(y(t.path,"queryBins"),{...e,query:{...a,...e.query}})}async function at(r,i,e){const{data:t}=await O(l(r),J.from(i),e);return x.fromJSON(t)}export{at as executeAttributeBinsQuery};
